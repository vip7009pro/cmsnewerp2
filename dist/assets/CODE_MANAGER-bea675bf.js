import{r as s,k as H,j as t,aj as V,I as a,b3 as F,ak as Y,al as K,by as z,aF as q,ba as J,bz as $,bA as j,S as i,bv as Z,ad as S,bo as ee}from"./index-4ab6dde0.js";import{D as te,G as le,b as ne}from"./DataGrid-b5e0acb2.js";import{G as oe,a as re,b as ie}from"./GridToolbarFilterButton-ec6062d3.js";import"./TextField-db9fe3d0.js";import"./MenuItem-8199bc03.js";import"./Typography-b6d023f3.js";const ge=()=>{s.useState(null);const[o,u]=s.useState([]),[b,E]=s.useState({trapo:!0,thempohangloat:!1,them1po:!1,them1invoice:!1,testinvoicetable:!1}),l=H(e=>e.totalSlice.userData),[P,T]=s.useState(!1),[w,L]=s.useState(""),[d,de]=s.useState(!1),[se,p]=s.useTransition();let _=[{field:"id",headerName:"ID",width:70,editable:d},{field:"G_CODE",headerName:"G_CODE",width:80,editable:d},{field:"G_NAME",headerName:"G_NAME",flex:1,minWidth:250,editable:d},{field:"G_NAME_KD",headerName:"G_NAME_KD",width:120,editable:d},{field:"PROD_TYPE",headerName:"PROD_TYPE",width:80,editable:d},{field:"PROD_LAST_PRICE",headerName:"PRICE",width:80,editable:d},{field:"PD",headerName:"PD",width:80,editable:d},{field:"CAVITY",headerName:"CAVITY",width:80,editable:d},{field:"PACKING_QTY",headerName:"PACKING_QTY",width:80,editable:d},{field:"G_WIDTH",headerName:"G_WIDTH",width:80,editable:d},{field:"G_LENGTH",headerName:"G_LENGTH",width:80,editable:d},{field:"PROD_PROJECT",headerName:"PROD_PROJECT",width:120,editable:d},{field:"PROD_MODEL",headerName:"PROD_MODEL",width:120,editable:d},{field:"M_NAME_FULLBOM",headerName:"FULLBOM",flex:1,minWidth:150,editable:d},{field:"BANVE",headerName:"BANVE",width:260,renderCell:e=>{let n=null;const r=async g=>{(l==null?void 0:l.MAINDEPTNAME)==="KD"?ee(n,e.row.G_CODE+".pdf","banve").then(f=>{f.data.tk_status!=="NG"?S("update_banve_value",{G_CODE:e.row.G_CODE,banvevalue:"Y"}).then(c=>{if(c.data.tk_status!=="NG"){i.fire("Thông báo","Upload bản vẽ thành công","success");let Q=N.map((O,he)=>O.G_CODE===e.row.G_CODE?{...O,BANVE:"Y"}:O);C(Q)}else i.fire("Thông báo","Upload bản vẽ thất bại","error")}).catch(c=>{console.log(c)}):i.fire("Thông báo","Upload file thất bại:"+f.data.message,"error")}).catch(f=>{console.log(f)}):i.fire("Thông báo","Chỉ bộ phận kinh doanh upload được bản vẽ","error")};let h="/banve/"+e.row.G_CODE+".pdf";return e.row.BANVE!=="N"&&e.row.BANVE!==null?t.jsx("span",{style:{color:"gray"},children:t.jsx("a",{target:"_blank",rel:"noopener noreferrer",href:h,children:"LINK"})}):t.jsxs("div",{className:"uploadfile",children:[t.jsxs(a,{className:"buttonIcon",onClick:r,children:[t.jsx(F,{color:"yellow",size:25}),"Upload"]}),t.jsx("input",{accept:".pdf",type:"file",onChange:g=>{n=g.target.files[0],console.log(n)}})]})},editable:d},{field:"NO_INSPECTION",headerName:"KT NGOAI QUAN",width:120,renderCell:e=>e.row.NO_INSPECTION!=="Y"?t.jsx("span",{style:{color:"green"},children:"Kiểm tra"}):t.jsx("span",{style:{color:"red"},children:"Không kiểm tra"}),editable:d},{field:"USE_YN",headerName:"SỬ DỤNG",width:80,renderCell:e=>e.row.USE_YN!=="Y"?t.jsx("span",{style:{color:"red"},children:"KHÓA"}):t.jsx("span",{style:{color:"green"},children:"MỞ"}),editable:!0},{field:"PDBV",headerName:"PD BANVE",width:80,renderCell:e=>e.row.PDBV==="P"||e.row.PDBV==="R"||e.row.PDBV===null?t.jsx("span",{style:{color:"red"},children:t.jsx("b",{children:"PENDING"})}):t.jsx("span",{style:{color:"green"},children:t.jsx("b",{children:"APPROVED"})})},{field:"TENCODE",headerName:"TENCODE",flex:1,minWidth:250,editable:d,renderCell:e=>t.jsx("span",{style:{color:"black"},children:e.row.G_NAME})},{field:"PROD_DIECUT_STEP",headerName:"BC DIECUT",width:120,renderCell:e=>e.row.PROD_DIECUT_STEP===null?t.jsx("span",{style:{backgroundColor:"red",fontWeight:"bold"},children:"NG"}):t.jsx("span",{style:{fontWeight:"bold"},children:e.row.PROD_DIECUT_STEP})},{field:"PROD_PRINT_TIMES",headerName:"SO LAN IN",width:120,renderCell:e=>e.row.PROD_PRINT_TIMES===null?t.jsx("span",{style:{backgroundColor:"red",fontWeight:"bold"},children:"NG"}):t.jsx("span",{style:{fontWeight:"bold"},children:e.row.PROD_PRINT_TIMES})},{field:"FACTORY",headerName:"FACTORY",width:100,renderCell:e=>e.row.FACTORY===null?t.jsx("span",{style:{backgroundColor:"red",fontWeight:"bold"},children:"NG"}):t.jsx("span",{style:{fontWeight:"bold"},children:e.row.FACTORY})},{field:"EQ1",headerName:"EQ1",width:80,renderCell:e=>e.row.EQ1===null?t.jsx("span",{style:{backgroundColor:"red",fontWeight:"bold"},children:"NG"}):t.jsx("span",{style:{fontWeight:"bold"},children:e.row.EQ1})},{field:"EQ2",headerName:"EQ2",width:80,renderCell:e=>e.row.EQ2===null?t.jsx("span",{style:{backgroundColor:"red",fontWeight:"bold"},children:"NG"}):t.jsx("span",{style:{fontWeight:"bold"},children:e.row.EQ2})},{field:"Setting1",headerName:"Setting1",width:100,renderCell:e=>e.row.Setting1===null?t.jsx("span",{style:{backgroundColor:"red",fontWeight:"bold"},children:"NG"}):t.jsx("span",{style:{fontWeight:"bold"},children:e.row.Setting1})},{field:"Setting2",headerName:"Setting2",width:100,renderCell:e=>e.row.Setting2===null?t.jsx("span",{style:{backgroundColor:"red",fontWeight:"bold"},children:"NG"}):t.jsx("span",{style:{fontWeight:"bold"},children:e.row.Setting2})},{field:"UPH1",headerName:"UPH1",width:80,renderCell:e=>e.row.UPH1===null?t.jsx("span",{style:{backgroundColor:"red",fontWeight:"bold"},children:"NG"}):t.jsx("span",{style:{fontWeight:"bold"},children:e.row.UPH1})},{field:"UPH2",headerName:"UPH2",width:80,renderCell:e=>e.row.UPH2===null?t.jsx("span",{style:{backgroundColor:"red",fontWeight:"bold"},children:"NG"}):t.jsx("span",{style:{fontWeight:"bold"},children:e.row.UPH2})},{field:"Step1",headerName:"Step1",width:80,renderCell:e=>e.row.Step1===null?t.jsx("span",{style:{backgroundColor:"red",fontWeight:"bold"},children:"NG"}):t.jsx("span",{style:{fontWeight:"bold"},children:e.row.Step1})},{field:"Step2",headerName:"Step2",width:80,renderCell:e=>e.row.Step2===null?t.jsx("span",{style:{backgroundColor:"red",fontWeight:"bold"},children:"NG"}):t.jsx("span",{style:{fontWeight:"bold"},children:e.row.Step2})},{field:"LOSS_SX1",headerName:"LOSS_SX1(%)",width:100,renderCell:e=>e.row.LOSS_SX1===null?t.jsx("span",{style:{backgroundColor:"red",fontWeight:"bold"},children:"NG"}):t.jsx("span",{style:{fontWeight:"bold"},children:e.row.LOSS_SX1})},{field:"LOSS_SX2",headerName:"LOSS_SX2(%)",width:100,renderCell:e=>e.row.LOSS_SX2===null?t.jsx("span",{style:{backgroundColor:"red",fontWeight:"bold"},children:"NG"}):t.jsx("span",{style:{fontWeight:"bold"},children:e.row.LOSS_SX2})},{field:"LOSS_SETTING1",headerName:"LOSS_SETTING1(m)",width:130,renderCell:e=>e.row.LOSS_SETTING1===null?t.jsx("span",{style:{backgroundColor:"red",fontWeight:"bold"},children:"NG"}):t.jsx("span",{style:{fontWeight:"bold"},children:e.row.LOSS_SETTING1})},{field:"LOSS_SETTING2",headerName:"LOSS_SETTING2(m)",width:130,renderCell:e=>e.row.LOSS_SETTING2===null?t.jsx("span",{style:{backgroundColor:"red",fontWeight:"bold"},children:"NG"}):t.jsx("span",{style:{fontWeight:"bold"},children:e.row.LOSS_SETTING2})},{field:"LOSS_ST_SX1",headerName:"LOSS_SETTING_SX1(m)",width:130,renderCell:e=>e.row.LOSS_ST_SX1===null?t.jsx("span",{style:{backgroundColor:"red",fontWeight:"bold"},children:"NG"}):t.jsx("span",{style:{fontWeight:"bold"},children:e.row.LOSS_ST_SX1})},{field:"LOSS_ST_SX2",headerName:"LOSS_SETTING_SX2(m)",width:130,renderCell:e=>e.row.LOSS_ST_SX2===null?t.jsx("span",{style:{backgroundColor:"red",fontWeight:"bold"},children:"NG"}):t.jsx("span",{style:{fontWeight:"bold"},children:e.row.LOSS_ST_SX2})},{field:"NOTE",headerName:"NOTE",width:150}];const[N,C]=s.useState([]),[x,y]=s.useState(_),[I,A]=s.useState([]),[ae,k]=s.useState(_);function D(){return t.jsxs(le,{children:[t.jsx(oe,{}),t.jsx(re,{}),t.jsx(ie,{}),t.jsxs(a,{className:"buttonIcon",onClick:()=>{Y(N,"Code Info Table")},children:[t.jsx(K,{color:"green",size:25}),"SAVE"]}),t.jsxs(a,{className:"buttonIcon",onClick:()=>{m("N")},children:[t.jsx(z,{color:"blue",size:25}),"SET NGOAI QUAN"]}),t.jsxs(a,{className:"buttonIcon",onClick:()=>{m("Y")},children:[t.jsx(q,{color:"green",size:25}),"SET K NGOAI QUAN"]}),t.jsxs(a,{className:"buttonIcon",onClick:()=>{M("N")},children:[t.jsx(J,{color:"green",size:25}),"RESET BẢN VẼ"]}),t.jsxs(a,{className:"buttonIcon",onClick:()=>{v("Y")},children:[t.jsx($,{color:"red",size:25}),"PDUYET BẢN VẼ"]}),t.jsxs(a,{className:"buttonIcon",onClick:()=>{W()},children:[t.jsx(j,{color:"blue",size:25}),"Update TT QLSX"]}),t.jsxs(a,{className:"buttonIcon",onClick:()=>{y(x.map((e,n)=>({...e,editable:!e.editable}))),i.fire("Thông báo","Bật/Tắt chế độ sửa","success")},children:[t.jsx(Z,{color:"yellow",size:25}),"Bật tắt sửa"]}),t.jsx(ne,{}),t.jsxs(a,{className:"buttonIcon",onClick:()=>{X()},children:[t.jsx(j,{color:"blue",size:25}),"Update LOSS SX"]})]})}const M=async e=>{if(o.length>=1)if((l==null?void 0:l.EMPL_NO)==="NBT1901"||(l==null?void 0:l.EMPL_NO)==="VTT1901"||(l==null?void 0:l.EMPL_NO)==="NHU1903"||(l==null?void 0:l.EMPL_NO)==="LVT1906"){for(let n=0;n<o.length;n++)await S("resetbanve",{G_CODE:o[n].G_CODE,VALUE:e}).then(r=>{console.log(r.data.tk_status),r.data.tk_status}).catch(r=>{console.log(r)});i.fire("Thông báo","RESET BAN VE THÀNH CÔNG","success")}else i.fire("Thông báo","Không đủ quyền hạn!","error");else i.fire("Thông báo","Chọn ít nhất 1 G_CODE để SET !","error")},v=async e=>{if(o.length>=1)if(((l==null?void 0:l.SUBDEPTNAME)==="PQC1"||(l==null?void 0:l.SUBDEPTNAME)==="PQC3")&&((l==null?void 0:l.JOB_NAME)==="Sub Leader"||(l==null?void 0:l.JOB_NAME)==="Leader")){for(let n=0;n<o.length;n++)await S("pdbanve",{G_CODE:o[n].G_CODE,VALUE:e}).then(r=>{console.log(r.data.tk_status),r.data.tk_status}).catch(r=>{console.log(r)});i.fire("Thông báo","Phê duyệt Bản Vẽ THÀNH CÔNG","success")}else i.fire("Thông báo","Không đủ quyền hạn!","error");else i.fire("Thông báo","Chọn ít nhất 1 G_CODE để Phê Duyệt !","error")},G=()=>{T(!0),k(_),S("codeinfo",{G_NAME:w}).then(e=>{if(e.data.tk_status!=="NG"){const n=e.data.data.map((r,h)=>({...r,id:h}));C(n),T(!1),i.fire("Thông báo","Đã load "+e.data.data.length+" dòng","success")}else i.fire("Thông báo","Nội dung: "+e.data.message,"error"),T(!1)}).catch(e=>{console.log(e)})},R=e=>{e===1?E({...b,trapo:!0,thempohangloat:!1,them1po:!1,them1invoice:!1,testinvoicetable:!1}):e===2?E({...b,trapo:!1,thempohangloat:!0,them1po:!1,them1invoice:!1,testinvoicetable:!1}):e===3&&E({...b,trapo:!1,thempohangloat:!1,them1po:!1,them1invoice:!1,testinvoicetable:!0})},U=e=>{const n=new Set(e);let r=N.filter(h=>n.has(h.id));r.length>0?u(r):u([])},m=async e=>{if(o.length>=1)if((l==null?void 0:l.EMPL_NO)==="VTT1901"||(l==null?void 0:l.EMPL_NO)==="NHU1903"||(l==null?void 0:l.EMPL_NO)==="LVT1906"){for(let n=0;n<o.length;n++)await S("setngoaiquan",{G_CODE:o[n].G_CODE,VALUE:e}).then(r=>{console.log(r.data.tk_status),r.data.tk_status}).catch(r=>{console.log(r)});i.fire("Thông báo","SET TRẠNG KIỂM TRA NGOẠI QUAN THÀNH CÔNG","success")}else i.fire("Thông báo","Không đủ quyền hạn!","error");else i.fire("Thông báo","Chọn ít nhất 1 G_CODE để SET !","error")},W=async()=>{if(o.length>=1)if((l==null?void 0:l.EMPL_NO)==="NHU1903"||(l==null?void 0:l.MAINDEPTNAME)==="QLSX"){let e="0";for(let n=0;n<o.length;n++)await S("saveQLSX",{G_CODE:o[n].G_CODE,PROD_DIECUT_STEP:o[n].PROD_DIECUT_STEP,PROD_PRINT_TIMES:o[n].PROD_PRINT_TIMES,FACTORY:o[n].FACTORY,EQ1:o[n].EQ1,EQ2:o[n].EQ2,Setting1:o[n].Setting1,Setting2:o[n].Setting2,UPH1:o[n].UPH1,UPH2:o[n].UPH2,Step1:o[n].Step1,Step2:o[n].Step2,LOSS_SX1:o[n].LOSS_SX1,LOSS_SX2:o[n].LOSS_SX2,LOSS_SETTING1:o[n].LOSS_SETTING1,LOSS_SETTING2:o[n].LOSS_SETTING2,NOTE:o[n].NOTE}).then(r=>{console.log(r.data.tk_status),r.data.tk_status!=="NG"||(e="1")}).catch(r=>{console.log(r)});e==="1"?i.fire("Thông báo","Lưu thất bại, không được để trống đỏ ô nào","error"):(i.fire("Thông báo","Lưu thành công","success"),u([]))}else i.fire("Thông báo","Không đủ quyền hạn!","error");else i.fire("Thông báo","Chọn ít nhất 1 G_CODE để SET !","error")},X=async()=>{if(o.length>=1)if((l==null?void 0:l.EMPL_NO)==="NHU1903"||(l==null?void 0:l.EMPL_NO)==="DTL1906"||(l==null?void 0:l.EMPL_NO)==="LVQ0103"){let e="0";for(let n=0;n<o.length;n++)await S("saveLOSS_SETTING_SX",{G_CODE:o[n].G_CODE,LOSS_ST_SX1:o[n].LOSS_ST_SX1,LOSS_ST_SX2:o[n].LOSS_ST_SX2}).then(r=>{console.log(r.data.tk_status),r.data.tk_status!=="NG"||(e="1")}).catch(r=>{console.log(r)});e==="1"?i.fire("Thông báo","Lưu thất bại, không được để trống đỏ ô nào","error"):(i.fire("Thông báo","Lưu thành công","success"),u([]))}else i.fire("Thông báo","Không đủ quyền hạn!","error");else i.fire("Thông báo","Chọn ít nhất 1 G_CODE để SET !","error")},B=e=>{e.key==="Enter"&&G()};return s.useEffect(()=>{},[]),t.jsxs("div",{className:"codemanager",children:[t.jsx("div",{className:"mininavbar",children:t.jsx("div",{className:"mininavitem",onClick:()=>R(1),children:t.jsx("span",{className:"mininavtext",children:"Thông tin sản phẩm"})})}),b.trapo&&t.jsxs("div",{className:"tracuuFcst",children:[t.jsx("div",{className:"tracuuFcstform",children:t.jsx("div",{className:"forminput",children:t.jsxs("div",{className:"forminputcolumn",children:[t.jsxs("label",{children:[t.jsx("b",{children:"Code:"})," ",t.jsx("input",{type:"text",placeholder:"Nhập code vào đây",value:w,onChange:e=>L(e.target.value),onKeyDown:e=>{B(e)}})]}),t.jsx("button",{className:"traxuatkiembutton",onClick:()=>{G()},children:"Tìm code"})]})})}),t.jsx("div",{className:"tracuuFcstTable",children:t.jsx(te,{components:{Toolbar:D,LoadingOverlay:V},sx:{fontSize:"0.7rem"},loading:P,rowHeight:30,rows:N,columns:x,checkboxSelection:!0,onSelectionModelChange:e=>{U(e)},rowsPerPageOptions:[5,10,50,100,500,1e3,5e3,1e4,1e5],editMode:"cell",onCellEditCommit:(e,n,r)=>{let h=I;h.push(e),A(h);const g=e.field,f=N.map(c=>c.id===e.id?{...c,[g]:e.value}:c);p(()=>{C(f)})}})})]})]})};export{ge as default};
