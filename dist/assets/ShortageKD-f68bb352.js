import{r as i,k as Ee,ai as _,j as t,aT as x,aj as k,I as H,aV as pe,ak as M,al as be,aW as je,aX as Ae,aY as we,S as c,ad as D}from"./index-4ab6dde0.js";import{D as K,G as Y,b as R}from"./DataGrid-b5e0acb2.js";import{G as B,a as W,b as V}from"./GridToolbarFilterButton-ec6062d3.js";import"./TextField-db9fe3d0.js";import"./MenuItem-8199bc03.js";import"./Typography-b6d023f3.js";const ke=()=>{const[d,S]=i.useState({trapo:!0,thempohangloat:!1,them1po:!1,them1invoice:!1,testinvoicetable:!1}),r=Ee(e=>e.totalSlice.userData),[n,g]=i.useState([]),[m,u]=i.useState(!1),[ve,F]=i.useState([]),[E,X]=i.useState(_().format("YYYY-MM-DD")),[p,z]=i.useState(_().format("YYYY-MM-DD")),[b,Q]=i.useState(""),[j,J]=i.useState(""),[A,$]=i.useState(""),[w,q]=i.useState(""),[v,Z]=i.useState(""),[P,ee]=i.useState(""),[C,te]=i.useState(!0);i.useState(!0);const[ae,le]=i.useState(""),[oe,ne]=i.useState(""),[re,se]=i.useState(""),[ie,ce]=i.useState("");i.useState([]);const[N,de]=i.useState([]);i.useState([]);const[T,U]=i.useState([]),he=[{field:"ST_ID",headerName:"ST_ID",width:50},{field:"PLAN_DATE",headerName:"PLAN_DATE",width:100},{field:"CUST_NAME_KD",headerName:"KHACH",width:100},{field:"G_CODE",headerName:"G_CODE",width:80},{field:"G_NAME",headerName:"G_NAME",width:180},{field:"PO_BALANCE",headerName:"TON PO",width:80,renderCell:e=>t.jsx("span",{style:{color:"red",fontWeight:"bold"},children:e.row.PO_BALANCE.toLocaleString("en-US")})},{field:"TON_TP",headerName:"TON_TP",width:80,renderCell:e=>t.jsx("span",{style:{color:"blue",fontWeight:"bold"},children:e.row.TON_TP.toLocaleString("en-US")})},{field:"BTP",headerName:"BTP",width:80,renderCell:e=>t.jsx("span",{style:{color:"blue",fontWeight:"bold"},children:e.row.BTP.toLocaleString("en-US")})},{field:"TONG_TON_KIEM",headerName:"T_KIEM",width:80,renderCell:e=>t.jsx("span",{style:{color:"blue",fontWeight:"bold"},children:e.row.TONG_TON_KIEM.toLocaleString("en-US")})},{field:"D1_9H",headerName:"D1_9H",width:80,renderCell:e=>t.jsx("span",{style:{color:"green",fontWeight:"bold"},children:e.row.D1_9H.toLocaleString("en-US")})},{field:"D1_13H",headerName:"D1_13H",width:80,renderCell:e=>t.jsx("span",{style:{color:"green",fontWeight:"bold"},children:e.row.D1_9H.toLocaleString("en-US")})},{field:"D1_19H",headerName:"D1_19H",width:80,renderCell:e=>t.jsx("span",{style:{color:"green",fontWeight:"bold"},children:e.row.D1_9H.toLocaleString("en-US")})},{field:"D1_21H",headerName:"D1_21H",width:80,renderCell:e=>t.jsx("span",{style:{color:"green",fontWeight:"bold"},children:e.row.D1_9H.toLocaleString("en-US")})},{field:"D1_23H",headerName:"D1_23H",width:80,renderCell:e=>t.jsx("span",{style:{color:"green",fontWeight:"bold"},children:e.row.D1_9H.toLocaleString("en-US")})},{field:"D2_9H",headerName:"D2_9H",width:80,renderCell:e=>t.jsx("span",{style:{color:"blue",fontWeight:"bold"},children:e.row.D1_9H.toLocaleString("en-US")})},{field:"D2_13H",headerName:"D2_13H",width:80,renderCell:e=>t.jsx("span",{style:{color:"blue",fontWeight:"bold"},children:e.row.D1_9H.toLocaleString("en-US")})},{field:"D2_21H",headerName:"D2_21H",width:80,renderCell:e=>t.jsx("span",{style:{color:"blue",fontWeight:"bold"},children:e.row.D1_9H.toLocaleString("en-US")})},{field:"D3_SANG",headerName:"D3_SANG",width:80,renderCell:e=>t.jsx("span",{style:{color:"black",fontWeight:"bold"},children:e.row.D1_9H.toLocaleString("en-US")})},{field:"D3_CHIEU",headerName:"D3_CHIEU",width:80,renderCell:e=>t.jsx("span",{style:{color:"black",fontWeight:"bold"},children:e.row.D1_9H.toLocaleString("en-US")})},{field:"D4_SANG",headerName:"D4_SANG",width:80,renderCell:e=>t.jsx("span",{style:{color:"black",fontWeight:"bold"},children:e.row.D1_9H.toLocaleString("en-US")})},{field:"D4_CHIEU",headerName:"D4_CHIEU",width:80,renderCell:e=>t.jsx("span",{style:{color:"black",fontWeight:"bold"},children:e.row.D1_9H.toLocaleString("en-US")})},{field:"TODAY_TOTAL",headerName:"TODAY_TOTAL",width:120,renderCell:e=>t.jsx("span",{style:{color:"#b63dfc",fontWeight:"bold"},children:e.row.TODAY_TOTAL.toLocaleString("en-US")})},{field:"TODAY_THIEU",headerName:"TODAY_THIEU",width:120,renderCell:e=>t.jsx("span",{style:{color:"#f21400",fontWeight:"bold"},children:e.row.TODAY_THIEU.toLocaleString("en-US")})},{field:"PRIORITY",headerName:"PRIORITY",width:100}],_e=[{field:"G_CODE",headerName:"G_CODE",width:100},{field:"CUST_CD",headerName:"CUST_CD",width:100},{field:"EMPL_NO",headerName:"EMPL_NO",width:100},{field:"PLAN_DATE",headerName:"PLAN_DATE",width:100},{field:"D1_9H",headerName:"D1_9H",width:100},{field:"D1_13H",headerName:"D1_13H",width:100},{field:"D1_19H",headerName:"D1_19H",width:100},{field:"D1_21H",headerName:"D1_21H",width:100},{field:"D1_23H",headerName:"D1_23H",width:100},{field:"D2_9H",headerName:"D2_9H",width:100},{field:"D2_13H",headerName:"D2_13H",width:100},{field:"D2_21H",headerName:"D2_21H",width:100},{field:"D3_SANG",headerName:"D3_SANG",width:100},{field:"D3_CHIEU",headerName:"D3_CHIEU",width:100},{field:"D4_SANG",headerName:"D4_SANG",width:100},{field:"D4_CHIEU",headerName:"D4_CHIEU",width:100},{field:"PRIORITY",headerName:"PRIORITY",width:100},{field:"CHECKSTATUS",headerName:"CHECKSTATUS",width:100}];function De(){return t.jsxs(Y,{children:[t.jsx(B,{}),t.jsx(W,{}),t.jsx(V,{}),t.jsx("button",{className:"saveexcelbutton",onClick:()=>{M(n,"Uploaded Plan")},children:"Save Excel"}),t.jsx(R,{})]})}function ue(){return t.jsxs(Y,{children:[t.jsx(B,{}),t.jsx(W,{}),t.jsx(V,{}),t.jsxs(H,{className:"buttonIcon",onClick:()=>{M(N,"Shortage Table")},children:[t.jsx(be,{color:"green",size:25}),"SAVE"]}),t.jsxs(H,{className:"buttonIcon",onClick:()=>{x(r==null?void 0:r.EMPL_NO,r==null?void 0:r.MAINDEPTNAME,["KD"],He)},children:[t.jsx(je,{color:"red",size:25}),"XÓA PLAN"]}),t.jsx(R,{})]})}const fe=e=>{if(e.preventDefault(),e.target.files){const a=new FileReader;a.onload=o=>{const h=o.target.result,f=Ae(h,{type:"array"}),s=f.SheetNames[0],me=f.Sheets[s],L=we.sheet_to_json(me);let y=Object.keys(L[0]).map((l,I)=>({field:l,headerName:l,width:150}));y.push({field:"CHECKSTATUS",headerName:"CHECKSTATUS",width:350}),F(y),g(L.map((l,I)=>({...l,id:I,CHECKSTATUS:"Waiting",D1_9H:l.D1_9H===void 0||l.D1_9H===""?0:l.D1_9H,D1_13H:l.D1_13H===void 0||l.D1_13H===""?0:l.D1_13H,D1_19H:l.D1_19H===void 0||l.D1_19H===""?0:l.D1_19H,D1_21H:l.D1_21H===void 0||l.D1_21H===""?0:l.D1_21H,D1_23H:l.D1_23H===void 0||l.D1_23H===""?0:l.D1_23H,D1_OTHER:l.D1_OTHER===void 0||l.D1_OTHER===""?0:l.D1_OTHER,D2_9H:l.D2_9H===void 0||l.D2_9H===""?0:l.D2_9H,D2_13H:l.D2_13H===void 0||l.D2_13H===""?0:l.D2_13H,D2_21H:l.D2_21H===void 0||l.D2_21H===""?0:l.D2_21H,D3_SANG:l.D3_SANG===void 0||l.D3_SANG===""?0:l.D3_SANG,D3_CHIEU:l.D3_CHIEU===void 0||l.D3_CHIEU===""?0:l.D3_CHIEU,D4_SANG:l.D4_SANG===void 0||l.D4_SANG===""?0:l.D4_SANG,D4_CHIEU:l.D4_CHIEU===void 0||l.D4_CHIEU===""?0:l.D4_CHIEU,PLAN_DATE:_.utc(l.PLAN_DATE).format("YYYY-MM-DD")})))},a.readAsArrayBuffer(e.target.files[0])}},Se=async()=>{u(!0);let e=n;for(let a=0;a<n.length;a++){let o=0;await D("checkShortageExist",{G_CODE:n[a].G_CODE,CUST_CD:n[a].CUST_CD,PLAN_DATE:n[a].PLAN_DATE}).then(s=>{s.data.tk_status!=="NG"&&(o=1)}).catch(s=>{console.log(s)});let h=_(),f=_(n[a].PLAN_DATE);h<f&&(o=2),await D("checkGCodeVer",{G_CODE:n[a].G_CODE}).then(s=>{s.data.tk_status!=="NG"?s.data.data[0].USE_YN==="Y"||(o=3):o=4}).catch(s=>{console.log(s)}),o===0?e[a].CHECKSTATUS="OK":o===1?e[a].CHECKSTATUS="NG:Plan đã tồn tại":o===2?e[a].CHECKSTATUS="NG: Ngày Plan không được sau ngày hôm nay":o===3?e[a].CHECKSTATUS="NG: Ver này đã bị khóa":o===4?e[a].CHECKSTATUS="NG: Không có code CMS này":o===5&&(e[a].CHECKSTATUS="NG: Giao hàng nhiều hơn PO")}u(!1),c.fire("Thông báo","Đã hoàn thành check Plan hàng loạt","success"),console.log(e),g(e)},ge=async()=>{u(!0);let e=n;for(let a=0;a<n.length;a++){let o=0;await D("checkShortageExist",{G_CODE:n[a].G_CODE,CUST_CD:n[a].CUST_CD,PLAN_DATE:n[a].PLAN_DATE}).then(s=>{s.data.tk_status!=="NG"&&(o=1)}).catch(s=>{console.log(s)});let h=_(),f=_(n[a].PLAN_DATE);h<f&&(o=2),await D("checkGCodeVer",{G_CODE:n[a].G_CODE}).then(s=>{s.data.tk_status!=="NG"?s.data.data[0].USE_YN==="Y"||(o=3):o=4}).catch(s=>{console.log(s)}),o===0?await D("insert_shortage",{REMARK:n[a].REMARK,G_CODE:n[a].G_CODE,CUST_CD:n[a].CUST_CD,PLAN_DATE:n[a].PLAN_DATE,EMPL_NO:r==null?void 0:r.EMPL_NO,D1_9H:n[a].D1_9H,D1_13H:n[a].D1_13H,D1_19H:n[a].D1_19H,D1_21H:n[a].D1_21H,D1_23H:n[a].D1_23H,D1_OTHER:n[a].D1_OTHER,D2_9H:n[a].D2_9H,D2_13H:n[a].D2_13H,D2_21H:n[a].D2_21H,D3_SANG:n[a].D3_SANG,D3_CHIEU:n[a].D3_CHIEU,D4_SANG:n[a].D4_SANG,D4_CHIEU:n[a].D4_CHIEU,PRIORITY:n[a].PRIORITY,INS_EMPL:r==null?void 0:r.EMPL_NO,UPD_EMPL:r==null?void 0:r.EMPL_NO}).then(s=>{console.log(s.data.tk_status),s.data.tk_status!=="NG"?e[a].CHECKSTATUS="OK":(o=5,e[a].CHECKSTATUS="NG: Lỗi SQL: "+s.data.message)}).catch(s=>{console.log(s)}):o===1?e[a].CHECKSTATUS="NG:Plan đã tồn tại":o===2?e[a].CHECKSTATUS="NG: Ngày Plan không được sau ngày hôm nay":o===3?e[a].CHECKSTATUS="NG: Ver này đã bị khóa":o===4?e[a].CHECKSTATUS="NG: Không có code CMS này":o===5&&(e[a].CHECKSTATUS="NG: Giao hàng nhiều hơn PO")}u(!1),c.fire("Thông báo","Đã hoàn thành check Plan hàng loạt","success"),g(e)},Ce=()=>{c.fire({title:"Chắc chắn muốn thêm Plan hàng loạt ?",text:"Thêm rồi mà sai, sửa là hơi vất đấy",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Vẫn thêm!"}).then(e=>{e.isConfirmed&&(c.fire("Tiến hành thêm","Đang thêm Plan hàng loạt","success"),ge())})},Ne=()=>{c.fire({title:"Chắc chắn muốn check Plan hàng loạt ?",text:"Sẽ bắt đầu check Plan hàng loạt",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Vẫn check!"}).then(e=>{e.isConfirmed&&(c.fire("Tiến hành check","Đang check Plan hàng loạt","success"),Se())})},O=e=>{e===1?S({...d,trapo:!0,thempohangloat:!1,them1po:!1,them1invoice:!1,testinvoicetable:!1}):e===2?S({...d,trapo:!1,thempohangloat:!0,them1po:!1,them1invoice:!1,testinvoicetable:!1}):e===3&&S({...d,trapo:!1,thempohangloat:!1,them1po:!1,them1invoice:!1,testinvoicetable:!0})},Te=e=>{const a=new Set(e);let o=N.filter(h=>a.has(h.ST_ID));o.length>0?U(o):U([])},xe=async()=>{if(T.length>=1){let e=!1;for(let a=0;a<T.length;a++)await D("delete_shortage",{ST_ID:T[a].ST_ID}).then(o=>{console.log(o.data.tk_status),o.data.tk_status!=="NG"||(e=!0)}).catch(o=>{console.log(o)});e?c.fire("Thông báo","Có lỗi SQL!","error"):(c.fire("Thông báo","Xóa Plan thành công (chỉ Plan của người đăng nhập)!","success"),G())}else c.fire("Thông báo","Chọn ít nhất 1 Plan để xóa !","error")},He=()=>{c.fire({title:"Chắc chắn muốn xóa Plan đã chọn ?",text:"Sẽ chỉ xóa Plan do bạn up lên",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Vẫn Xóa!"}).then(e=>{e.isConfirmed&&(c.fire("Tiến hành Xóa","Đang Xóa Plan hàng loạt","success"),x(r==null?void 0:r.EMPL_NO,r==null?void 0:r.MAINDEPTNAME,["KD"],xe))})},G=()=>{D("traShortageKD",{ALLTIME:C,FROM_DATE:E,TO_DATE:p,CUST_NAME:w,G_CODE:j,G_NAME:b,PROD_TYPE:v,EMPL_NAME:A,ST_ID:P}).then(e=>{if(e.data.tk_status!=="NG"){const a=e.data.data.map((o,h)=>({...o,PLAN_DATE:_.utc(o.PLAN_DATE).format("YYYY-MM-DD")}));de(a),u(!1),c.fire("Thông báo","Đã load "+e.data.data.length+" dòng","success")}else c.fire("Thông báo","Nội dung: "+e.data.message,"error"),u(!1)}).catch(e=>{console.log(e)})};return i.useEffect(()=>{},[]),t.jsxs("div",{className:"shortage",children:[t.jsxs("div",{className:"mininavbar",children:[t.jsx("div",{className:"mininavitem",onClick:()=>O(1),style:{backgroundColor:d.trapo===!0?"#02c712":"#abc9ae",color:(d.trapo===!0,"yellow")},children:t.jsx("span",{className:"mininavtext",children:"Tra Shortage"})}),t.jsx("div",{className:"mininavitem",onClick:()=>x(r==null?void 0:r.EMPL_NO,r==null?void 0:r.MAINDEPTNAME,["KD"],()=>{O(2)}),style:{backgroundColor:d.thempohangloat===!0?"#02c712":"#abc9ae",color:(d.thempohangloat===!0,"yellow")},children:t.jsx("span",{className:"mininavtext",children:"Thêm Shortage"})})]}),d.thempohangloat&&t.jsx("div",{className:"newplan",children:t.jsxs("div",{className:"batchnewplan",children:[t.jsx("h3",{children:"Thêm Shortage Hàng Loạt"}),t.jsxs("form",{className:"formupload",children:[t.jsxs("label",{htmlFor:"upload",children:[t.jsx("b",{children:"Chọn file Excel: "}),t.jsx("input",{className:"selectfilebutton",type:"file",name:"upload",id:"upload",onChange:e=>{fe(e)}})]}),t.jsx("div",{className:"checkpobutton",onClick:e=>{e.preventDefault(),Ne()},children:"Check"}),t.jsx("div",{className:"uppobutton",onClick:e=>{e.preventDefault(),Ce()},children:"Up Shortage"})]}),t.jsx("div",{className:"insertPlanTable",children:t.jsx(K,{sx:{fontSize:"0.7rem"},components:{Toolbar:De,LoadingOverlay:k},loading:m,rowHeight:35,rows:n,columns:_e,rowsPerPageOptions:[5,10,50,100,500,1e3,5e3,1e4,1e5],editMode:"row"})})]})}),d.trapo&&t.jsxs("div",{className:"tracuuPlan",children:[t.jsxs("div",{className:"tracuuPlanform",children:[t.jsxs("div",{className:"forminput",children:[t.jsxs("div",{className:"forminputcolumn",children:[t.jsxs("label",{children:[t.jsx("b",{children:"Từ ngày:"}),t.jsx("input",{type:"date",value:E.slice(0,10),onChange:e=>X(e.target.value)})]}),t.jsxs("label",{children:[t.jsx("b",{children:"Tới ngày:"})," ",t.jsx("input",{type:"date",value:p.slice(0,10),onChange:e=>z(e.target.value)})]})]}),t.jsxs("div",{className:"forminputcolumn",children:[t.jsxs("label",{children:[t.jsx("b",{children:"Code KD:"})," ",t.jsx("input",{type:"text",placeholder:"GH63-xxxxxx",value:b,onChange:e=>Q(e.target.value)})]}),t.jsxs("label",{children:[t.jsx("b",{children:"Code CMS:"})," ",t.jsx("input",{type:"text",placeholder:"7C123xxx",value:j,onChange:e=>J(e.target.value)})]})]}),t.jsxs("div",{className:"forminputcolumn",children:[t.jsxs("label",{children:[t.jsx("b",{children:"Tên nhân viên:"})," ",t.jsx("input",{type:"text",placeholder:"Trang",value:A,onChange:e=>$(e.target.value)})]}),t.jsxs("label",{children:[t.jsx("b",{children:"Khách:"})," ",t.jsx("input",{type:"text",placeholder:"SEVT",value:w,onChange:e=>q(e.target.value)})]})]}),t.jsxs("div",{className:"forminputcolumn",children:[t.jsxs("label",{children:[t.jsx("b",{children:"Loại sản phẩm:"})," ",t.jsx("input",{type:"text",placeholder:"TSP",value:v,onChange:e=>Z(e.target.value)})]}),t.jsxs("label",{children:[t.jsx("b",{children:"ID:"})," ",t.jsx("input",{type:"text",placeholder:"12345",value:P,onChange:e=>ee(e.target.value)})]})]}),t.jsxs("div",{className:"forminputcolumn",children:[t.jsxs("label",{children:[t.jsx("b",{children:"PO NO:"})," ",t.jsx("input",{type:"text",placeholder:"123abc",value:ae,onChange:e=>le(e.target.value)})]}),t.jsxs("label",{children:[t.jsx("b",{children:"Vật liệu:"})," ",t.jsx("input",{type:"text",placeholder:"SJ-203020HC",value:oe,onChange:e=>ne(e.target.value)})]})]}),t.jsxs("div",{className:"forminputcolumn",children:[t.jsxs("label",{children:[t.jsx("b",{children:"Over/OK:"})," ",t.jsx("input",{type:"text",placeholder:"OVER",value:re,onChange:e=>se(e.target.value)})]}),t.jsxs("label",{children:[t.jsx("b",{children:"Invoice No:"})," ",t.jsx("input",{type:"text",placeholder:"số invoice",value:ie,onChange:e=>ce(e.target.value)})]})]})]}),t.jsxs("div",{className:"formbutton",children:[t.jsxs("label",{children:[t.jsx("b",{children:"All Time:"}),t.jsx("input",{type:"checkbox",name:"alltimecheckbox",defaultChecked:C,onChange:()=>te(!C)})]}),t.jsxs(H,{className:"buttonIcon",onClick:()=>{G()},children:[t.jsx(pe,{color:"green",size:30}),"Search"]})]})]}),t.jsx("div",{className:"tracuuPlanTable",children:t.jsx(K,{components:{Toolbar:ue,LoadingOverlay:k},sx:{fontSize:"0.7rem"},loading:m,rowHeight:30,rows:N,columns:he,rowsPerPageOptions:[5,10,50,100,500,1e3,5e3,1e4,1e5],editMode:"row",getRowId:e=>e.ST_ID,checkboxSelection:!0,disableSelectionOnClick:!0,onSelectionModelChange:e=>{Te(e)}})})]})]})};export{ke as default};
