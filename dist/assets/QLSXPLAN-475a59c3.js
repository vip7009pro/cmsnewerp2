import{j as e,r as d,k as ft,ai as q,ad as x,m as Fl,I as b,b1 as Il,b2 as Ct,aV as Ml,aj as me,S as h,b3 as Rl,ak as Ue,al as ye,b4 as Yl,b5 as Je,b6 as $t,aT as xe,b7 as Dt,aQ as Jt,b8 as Wl,b9 as Gl,ba as kl,bb as Vl,bc as pl,bd as Be,an as zl,be as ql,bf as $l,aF as Jl}from"./index-4ab6dde0.js";import Zl from"./DATASX2-b32c0fed.js";import{h as Ql,f as Hl}from"./index.esm-f9b137af.js";import{Y as wl,D as ml}from"./DrawComponent-e8195041.js";import{B as Ot,l as Ul}from"./index-7be2e040.js";import{G as en,P as tn}from"./PLAN_STATUS-15349232.js";import Kl from"./KHOAO-588a764a.js";import{B as _e,D as ve,G as Xe,b as Ge}from"./DataGrid-b5e0acb2.js";import ln from"./LICHSUINPUTLIEU-87af269e.js";import nn from"./EQ_STATUS-32edfeef.js";const Ht=C=>{var T;const V="#2fd5eb",f="#8ce9f5",w="white",p="black";let F=(T=C.machine_data)==null?void 0:T.filter((k,ce)=>k.PLAN_EQ===C.machine_name&&k.PLAN_FACTORY===C.factory);return e.jsxs("div",{className:"machine_component",style:{backgroundImage:`linear-gradient(to right, ${C.run_stop===1?V:w}, ${C.run_stop===1?f:p})`},onDoubleClick:C.onClick,children:[e.jsxs("div",{className:"tieude",style:{backgroundColor:`${C.eq_status==="STOP"?"red":C.eq_status==="SETTING"?"yellow":"#50f73e"}`},children:[e.jsxs("div",{className:"eqname",style:{color:`${C.eq_status==="STOP"?"white":(C.eq_status==="SETTING","black")}`},children:[C.machine_name==="ED36"?"ED36(SP01)":C.machine_name,C.eq_status==="MASS"&&e.jsx("img",{alt:"running",src:"/blink.gif",width:40,height:20}),C.eq_status==="SETTING"&&e.jsx("img",{alt:"running",src:"/setting3.gif",width:20,height:20})]}),e.jsxs("div",{className:"currentcode",style:{fontSize:12,color:`${C.eq_status==="STOP"?"white":(C.eq_status==="SETTING","black")}`},children:[C.current_plan_id,"_",C.current_g_name]})]}),e.jsx("div",{className:"machineplan",children:e.jsx("ul",{children:F==null?void 0:F.map((k,ce)=>e.jsxs("li",{style:{color:k.PLAN_ID===C.current_plan_id?"red":"black"},children:[k.G_NAME_KD," | ",k.PLAN_ID," | B",k.STEP," | ",k.PLAN_QTY," "]},ce))})})]})};const yl=({PROD_REQUEST_NO:C,PDBV:V,PLAN_ID:f,PLAN_QTY:w,PLAN_DATE:p,PLAN_EQ:F,PLAN_FACTORY:T,PLAN_LEADTIME:k,G_CODE:ce,G_NAME:Ne,G_NAME_KD:ke,STEP:I,PLAN_ORDER:ne,PROCESS_NUMBER:z})=>{var g,ie,Oe,M,y,He,H,Ze,Fe,at,We,it,et,Ke;const[Ee,ae]=d.useState(!1);ft(Q=>Q.totalSlice.userData);const[Y,Le]=d.useState([{REMK:"20220617",PROD_REQUEST_QTY:18e3,PROD_REQUEST_NO:"2FH0078",PROD_REQUEST_DATE:"20220617",G_CODE:"7A07975A",DELIVERY_DT:"20220620",CODE_55:"03",CODE_50:"02",RIV_NO:"A",M_QTY:1,M_CODE:"A0009027",CUST_NAME:"",ROLE_EA_QTY:2e3,PACK_DRT:"",PROD_PRINT_TIMES:1,G_WIDTH:28.6,G_SG_R:2,G_SG_L:2,G_R:0,G_NAME:"",G_LG:3,G_LENGTH:23,G_CODE_C:"",G_CG:4,G_C:1,G_C_R:4,PD:31.6,CODE_33:"02",M_NAME:"",WIDTH_CD:110,EMPL_NO:"",EMPL_NAME:"",CODE_03:"01",REMARK:"",TONLIEU:0,HOLDING:0,TONG_TON_LIEU:0,PROD_DIECUT_STEP:0,FACTORY:"",EQ1:"",EQ2:"",Setting1:0,Setting2:0,UPH1:0,UPH2:0,Step1:0,Step2:0,LOSS_SX1:0,LOSS_SX2:0,LOSS_SETTING1:0,LOSS_SETTING2:0,NOTE:"",PO_TYPE:"E1",PROD_MAIN_MATERIAL:"",LIEUQL_SX:0,FSC:"N"}]),[he,Ce]=d.useState([]),[ge,Z]=d.useState(!1),[de,S]=d.useState(12),K=async()=>{x("getchithidatatable",{PLAN_ID:f}).then(Q=>{Q.data.tk_status!=="NG"&&Ce(Q.data.data)}).catch(Q=>{console.log(Q)})},ee=async()=>{x("ycsx_fullinfo",{PROD_REQUEST_NO:C}).then(Q=>{if(Q.data.tk_status!=="NG"){for(let te=0;te<Q.data.data.length;te++)Q.data.data[te].PROD_MAIN_MATERIAL===Q.data.data[te].M_NAME&&Q.data.data[te].LIEUQL_SX===1&&ae(!0);Le(Q.data.data)}else Le([{REMK:"",PROD_REQUEST_QTY:0,PROD_REQUEST_NO:"",PROD_REQUEST_DATE:"",G_CODE:"",DELIVERY_DT:"",CODE_55:"03",CODE_50:"02",RIV_NO:"",M_QTY:1,M_CODE:"",CUST_NAME:"",ROLE_EA_QTY:0,PACK_DRT:"",PROD_PRINT_TIMES:0,G_WIDTH:0,G_SG_R:0,G_SG_L:0,G_R:0,G_NAME:"",G_LG:0,G_LENGTH:0,G_CODE_C:"",G_CG:0,G_C:0,G_C_R:0,PD:0,CODE_33:"02",M_NAME:"",WIDTH_CD:0,EMPL_NO:"",EMPL_NAME:"",CODE_03:"01",REMARK:"",TONLIEU:0,HOLDING:0,TONG_TON_LIEU:0,NO_INSPECTION:"N",PROD_DIECUT_STEP:0,FACTORY:"",EQ1:"",EQ2:"",Setting1:0,Setting2:0,UPH1:0,UPH2:0,Step1:0,Step2:0,LOSS_SX1:0,LOSS_SX2:0,LOSS_SETTING1:0,LOSS_SETTING2:0,NOTE:"",PO_TYPE:"E1",FSC:"N"}])}).catch(Q=>{console.log(Q)})},X=()=>!(Y[0].FACTORY===null||Y[0].EQ1===null||Y[0].EQ2===null||Y[0].Setting1===null||Y[0].Setting2===null||Y[0].UPH1===null||Y[0].UPH2===null||Y[0].Step1===null||Y[0].Step1===null||Y[0].LOSS_SX1===null||Y[0].LOSS_SX2===null||Y[0].LOSS_SETTING1===null||Y[0].LOSS_SETTING2===null),A=()=>{x("check_lieuql_sx_m140",{G_CODE:ce}).then(Q=>{Q.data.tk_status!=="NG"?Z(!0):Z(!1)}).catch(Q=>{console.log(Q)})},L=()=>{var te;let Q=(te=localStorage.getItem("maxLieu"))==null?void 0:te.toString();Q!==void 0?(console.log("temp max lieu : ",Q),S(Q)):localStorage.setItem("maxLieu","12")};return d.useEffect(()=>{L(),A(),ee(),K()},[f]),e.jsxs("div",{className:"chithicomponent",children:[e.jsx("div",{className:"qcpass",children:Y[0].PDBV==="Y"&&Ee===!0&&e.jsx("img",{alt:"qcpass",src:"/QC PASS20.png",width:440-100-10,height:400-100})}),((g=Y[0])==null?void 0:g.FSC)==="Y"&&e.jsx("div",{className:"fsc",children:e.jsx("img",{alt:"qcpass",src:"/fsc logo2.png",width:440-100-10,height:400-100})}),e.jsxs("div",{className:"tieudeycsx",children:[e.jsxs("div",{className:"leftlogobarcode",children:[e.jsx("img",{alt:"logo",src:"/logocmsvina.png",width:160,height:40}),e.jsx(Ot,{value:`${f}`,format:"CODE128",width:1,height:50,displayValue:!1,background:"#fff",lineColor:"black",margin:0}),f]}),e.jsxs("div",{className:"headertitle",children:[e.jsxs("span",{style:{fontSize:16},children:["생산 지시서 - Chỉ thị Sản Xuất(",F,"- B",I,")"]}),e.jsx("br",{}),e.jsxs("span",{style:{fontSize:12},children:["Thời điểm in CTSX: ",q().format("YYYY-MM-DD HH:mm:ss")]}),e.jsx("br",{})," ",Y[0].NO_INSPECTION==="Y"&&e.jsx("span",{style:{fontSize:18},children:"(Sản phẩm không kiểm tra ngoại quan)"})]}),e.jsx("div",{className:"soycsx",children:e.jsxs("div",{className:"ycsxbarcode",children:[e.jsx(Ot,{value:(ie=Y[0])==null?void 0:ie.PROD_REQUEST_NO,format:"CODE128",width:1,height:50,displayValue:!1,background:"#fff",lineColor:"black",margin:0}),e.jsxs("div",{className:"ycsxno",children:[Y[0].PROD_REQUEST_DATE,"-",Y[0].PROD_REQUEST_NO," "]})]})})]}),X()&&ge&&w!==0&&z!==0&&e.jsxs("div",{className:"thongtinycsx",children:[e.jsxs("div",{className:"text1",children:["1. 지시 정보 Thông tin chỉ thị (",Y[0].G_NAME," ) __ PO_TYPE: ",Y[0].PO_TYPE]}),e.jsxs("div",{className:"thongtinyeucau",children:[e.jsxs("table",{className:"ttyc1",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Hạng mục/항목"}),e.jsx("th",{children:"Thông tin/정보"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Người yêu cầu/요청자"}),e.jsx("td",{children:(Oe=Y[0])==null?void 0:Oe.EMPL_NAME})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Khách hàng/고객사"}),e.jsx("td",{children:(M=Y[0])==null?void 0:M.CUST_NAME})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Mã sản phẩm/제품코드"}),e.jsx("td",{children:(y=Y[0])==null?void 0:y.G_CODE})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Tên sản phẩm/제품명"}),e.jsx("td",{children:(He=Y[0])==null?void 0:He.G_NAME})]})]})]}),e.jsxs("table",{className:"ttyc2",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Hạng mục/항목"}),e.jsx("th",{children:"Thông tin/정보"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Số lượng yêu cầu/요청 수량"}),e.jsxs("td",{children:[(H=Y[0])==null?void 0:H.PROD_REQUEST_QTY.toLocaleString("en-US")," ","EA"]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Số lượng chỉ thị/지시 수량"}),e.jsxs("td",{children:[w==null?void 0:w.toLocaleString("en-US")," EA"]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"P/D"}),e.jsx("td",{children:(Ze=Y[0])==null?void 0:Ze.PD.toLocaleString("en-US")})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Cavity (Hàng * Cột)"}),e.jsxs("td",{children:[(Fe=Y[0])==null?void 0:Fe.G_C_R," * ",(at=Y[0])==null?void 0:at.G_C," ="," ",((We=Y[0])==null?void 0:We.G_C_R)*((it=Y[0])==null?void 0:it.G_C)]})]})]})]}),e.jsxs("table",{className:"ttyc2",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Hạng mục/항목"}),e.jsx("th",{children:"Thông tin/정보"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Nhà máy/공장"}),e.jsx("td",{children:T})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Máy/호기"}),e.jsx("td",{children:F})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Chú ý (Kdoanh)"}),e.jsx("td",{children:Y[0].REMK})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Chú ý (QLSX)"}),e.jsx("td",{children:(et=Y[0])==null?void 0:et.NOTE})]})]})]})]}),e.jsxs("div",{className:"text1",children:["3. LOSS INFO__ "," ",f," ",":  "," (Phân loại: ",Y[0].CODE_50==="01"?"GC":Y[0].CODE_50==="02"?"SK":Y[0].CODE_50==="03"?"KD":Y[0].CODE_50==="04"?"VN":Y[0].CODE_50==="05"?"SAMPLE":Y[0].CODE_50==="06"?"Vai bac 4":"ETC",")",e.jsx(Ot,{value:`${f}`,format:"CODE128",width:1.5,height:20,displayValue:!1,background:"#fff",lineColor:"black",margin:0}),"_",((Ke=Y[0])==null?void 0:Ke.FSC)==="Y"?"(FSC Mix Credit)":""]}),e.jsx("div",{className:"thongtinyeucau",children:e.jsxs("table",{className:"ttyc1",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Bóc kiểm (EA)/파괴검사"}),e.jsx("th",{children:"Lấy đồ/도구 준비"}),e.jsx("th",{children:"Máy hỏng/설비 고장"}),e.jsx("th",{children:"Dao NG/칼 불량"}),e.jsx("th",{children:"Chờ liệu/원단 대기"}),e.jsx("th",{children:"Chờ BTP/BTP 대기"}),e.jsx("th",{children:"Hết liệu/원단 떨어짐"}),e.jsx("th",{children:"Liệu NG/원단 불량"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{style:{height:"20px"}}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{})]})})]})}),e.jsxs("div",{className:"text1",children:["4. 제품 정보 Thông tin vật liệu | Liệu chính ",Y[0].PROD_MAIN_MATERIAL," | ",Ee===!0?"Đã SET":"Chưa SET"]}),e.jsxs("div",{className:"thongtinvatlieu",children:[he.length<=de&&e.jsx("div",{className:"vatlieugiua",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Mã Liệu/원단코드"}),e.jsx("th",{children:"Tên Liệu/원단명"}),e.jsx("th",{children:"Size Liệu/원단폭"}),e.jsx("th",{children:"SL chỉ thị/지시 수량"}),e.jsx("th",{children:"Thực xuất M/실제 출고 M"}),e.jsx("th",{children:"Thực xuất Roll/실제 출고 Roll"}),e.jsx("th",{children:"Ghi chú/비고"})]})}),e.jsx("tbody",{children:he.map((Q,te)=>e.jsxs("tr",{children:[e.jsx("td",{children:te}),e.jsx("td",{children:Q.M_CODE}),Q.LIEUQL_SX===1?e.jsx("td",{style:{color:"red",fontWeight:"bold",backgroundColor:"lightgreen"},children:Q.M_NAME}):e.jsx("td",{children:Q.M_NAME}),e.jsx("td",{children:Q.WIDTH_CD}),e.jsxs("td",{children:[(Q.M_MET_QTY*Q.M_QTY).toLocaleString("en-US")," M"]}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{children:Q.LIEUQL_SX})]},te))})]})}),he.length>de&&e.jsx("div",{className:"vatlieutrai",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Mã Liệu/원단코드"}),e.jsx("th",{children:"Tên Liệu/원단명"}),e.jsx("th",{children:"Size Liệu/원단폭"}),e.jsx("th",{children:"SL chỉ thị/지시 수량"}),e.jsx("th",{children:"Thực xuất M/실제 출고 M"}),e.jsx("th",{children:"Thực xuất Roll/실제 출고 Roll"}),e.jsx("th",{children:"Ghi chú/비고"})]})}),e.jsx("tbody",{children:he.map((Q,te)=>te<=de&&e.jsxs("tr",{children:[e.jsx("td",{children:te}),e.jsx("td",{children:Q.M_CODE}),Q.LIEUQL_SX===1?e.jsx("td",{style:{color:"red",fontWeight:"bold",backgroundColor:"lightgreen"},children:Q.M_NAME}):e.jsx("td",{children:Q.M_NAME}),e.jsx("td",{children:Q.WIDTH_CD}),e.jsxs("td",{children:[(Q.M_MET_QTY*Q.M_QTY).toLocaleString("en-US")," M"]}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{children:Q.LIEUQL_SX})]},te))})]})}),he.length>de&&e.jsx("div",{className:"vatlieuphai",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Mã Liệu/원단코드"}),e.jsx("th",{children:"Tên Liệu/원단명"}),e.jsx("th",{children:"Size Liệu/원단폭"}),e.jsx("th",{children:"SL chỉ thị/지시 수량"}),e.jsx("th",{children:"Thực xuất M/실제 출고 M"}),e.jsx("th",{children:"Thực xuất Roll/실제 출고 Roll"}),e.jsx("th",{children:"Ghi chú/비고"})]})}),e.jsx("tbody",{children:he.map((Q,te)=>te>de&&e.jsxs("tr",{children:[e.jsx("td",{children:te}),e.jsx("td",{children:Q.M_CODE}),Q.LIEUQL_SX===1?e.jsx("td",{style:{color:"red",fontWeight:"bold",backgroundColor:"lightgreen"},children:Q.M_NAME}):e.jsx("td",{children:Q.M_NAME}),e.jsx("td",{children:Q.WIDTH_CD}),e.jsxs("td",{children:[(Q.M_MET_QTY*Q.M_QTY).toLocaleString("en-US")," M"]}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{children:Q.LIEUQL_SX})]},te))})]})})]})]}),!X()&&e.jsx("div",{children:"Chưa đủ thông tin định mức"}),!ge&&e.jsx("div",{children:"Chưa chỉ định liệu chính, hãy lưu liệu chỉ thị để đồng bộ liệu chính lên BOM"}),w===0&&e.jsx("div",{children:"Số lượng chỉ thị không thể = 0"}),z===0&&e.jsx("div",{children:"PROCESS_NUMBER phải đặt 1 hoặc 2"})]})};const vl=({PROD_REQUEST_NO:C,PDBV:V,PLAN_ID:f,PLAN_QTY:w,PLAN_DATE:p,PLAN_EQ:F,PLAN_FACTORY:T,PLAN_LEADTIME:k,G_CODE:ce,G_NAME:Ne,G_NAME_KD:ke,STEP:I,PLAN_ORDER:ne})=>{var Ce,ge,Z,de,S,K,ee,X,A,L,g;ft(ie=>ie.totalSlice.userData);const[z,Ee]=d.useState([{REMK:"20220617",PROD_REQUEST_QTY:18e3,PROD_REQUEST_NO:"2FH0078",PROD_REQUEST_DATE:"20220617",G_CODE:"7A07975A",DELIVERY_DT:"20220620",CODE_55:"03",CODE_50:"02",RIV_NO:"A",M_QTY:1,M_CODE:"A0009027",CUST_NAME:"",ROLE_EA_QTY:2e3,PACK_DRT:"",PROD_PRINT_TIMES:1,G_WIDTH:28.6,G_SG_R:2,G_SG_L:2,G_R:0,G_NAME:"",G_LG:3,G_LENGTH:23,G_CODE_C:"",G_CG:4,G_C:1,G_C_R:4,PD:31.6,CODE_33:"02",M_NAME:"",WIDTH_CD:110,EMPL_NO:"",EMPL_NAME:"",CODE_03:"01",REMARK:"",TONLIEU:0,HOLDING:0,TONG_TON_LIEU:0}]),[ae,Y]=d.useState([]),Le=async()=>{x("getchithidatatable",{PLAN_ID:f}).then(ie=>{ie.data.tk_status!=="NG"&&Y(ie.data.data)}).catch(ie=>{console.log(ie)})},he=async()=>{x("ycsx_fullinfo",{PROD_REQUEST_NO:C}).then(ie=>{ie.data.tk_status!=="NG"?Ee(ie.data.data):Ee([{REMK:"",PROD_REQUEST_QTY:0,PROD_REQUEST_NO:"",PROD_REQUEST_DATE:"",G_CODE:"",DELIVERY_DT:"",CODE_55:"03",CODE_50:"02",RIV_NO:"",M_QTY:1,M_CODE:"",CUST_NAME:"",ROLE_EA_QTY:0,PACK_DRT:"",PROD_PRINT_TIMES:0,G_WIDTH:0,G_SG_R:0,G_SG_L:0,G_R:0,G_NAME:"",G_LG:0,G_LENGTH:0,G_CODE_C:"",G_CG:0,G_C:0,G_C_R:0,PD:0,CODE_33:"02",M_NAME:"",WIDTH_CD:0,EMPL_NO:"",EMPL_NAME:"",CODE_03:"01",REMARK:"",TONLIEU:0,HOLDING:0,TONG_TON_LIEU:0,NO_INSPECTION:"N"}])}).catch(ie=>{console.log(ie)})};return d.useEffect(()=>{he(),Le()},[f]),e.jsxs("div",{className:"ycktcomponent",children:[V==="Y"&&e.jsx("div",{className:"qcpass",children:e.jsx("img",{alt:"qcpass",src:"/QC PASS20.png",width:440-100-10,height:400-100})}),e.jsxs("div",{className:"tieudeycsx",children:[e.jsxs("div",{className:"leftlogobarcode",children:[e.jsx("img",{alt:"logo",src:"/logocmsvina.png",width:160,height:40}),e.jsx(Ot,{value:`${f}`,format:"CODE128",width:1,height:50,displayValue:!1,background:"#fff",lineColor:"black",margin:0}),f]}),e.jsxs("div",{className:"headertitle",children:["검사 요청서 - Yêu cầu kiểm tra(",F,"- B",I,")",e.jsx("br",{}),e.jsxs("span",{style:{fontSize:12},children:["Thời điểm in YCKT: ",q().format("YYYY-MM-DD HH:mm:ss")]}),e.jsx("br",{})," ",z[0].NO_INSPECTION==="Y"&&e.jsx("span",{style:{fontSize:18},children:"(Sản phẩm không kiểm tra ngoại quan)"})]}),e.jsx("div",{className:"soycsx",children:e.jsxs("div",{className:"ycsxbarcode",children:[e.jsx(Ot,{value:(Ce=z[0])==null?void 0:Ce.PROD_REQUEST_NO,format:"CODE128",width:1,height:50,displayValue:!1,background:"#fff",lineColor:"black",margin:0}),e.jsxs("div",{className:"ycsxno",children:[z[0].PROD_REQUEST_DATE,"-",z[0].PROD_REQUEST_NO," "]})]})})]}),e.jsxs("div",{className:"thongtinycsx",children:[e.jsxs("div",{className:"text1",children:["1. 지시 정보 Thông tin yêu cầu(",z[0].G_NAME," )"]}),e.jsxs("div",{className:"thongtinyeucau",children:[e.jsxs("table",{className:"ttyc1",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Hạng mục/항목"}),e.jsx("th",{children:"Thông tin/정보"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Người yêu cầu/요청자"}),e.jsx("td",{children:(ge=z[0])==null?void 0:ge.EMPL_NAME})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Khách hàng/고객사"}),e.jsx("td",{children:(Z=z[0])==null?void 0:Z.CUST_NAME})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Mã sản phẩm/제품코드"}),e.jsx("td",{children:(de=z[0])==null?void 0:de.G_CODE})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Tên sản phẩm/제품명"}),e.jsx("td",{children:(S=z[0])==null?void 0:S.G_NAME})]})]})]}),e.jsxs("table",{className:"ttyc2",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Hạng mục/항목"}),e.jsx("th",{children:"Thông tin/정보"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Số lượng yêu cầu/요청 수량"}),e.jsxs("td",{children:[(K=z[0])==null?void 0:K.PROD_REQUEST_QTY.toLocaleString("en-US")," ","EA"]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Số lượng chỉ thị/지시 수량"}),e.jsxs("td",{children:[w==null?void 0:w.toLocaleString("en-US")," EA"]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"P/D"}),e.jsx("td",{children:(ee=z[0])==null?void 0:ee.PD.toLocaleString("en-US")})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Cavity (Hàng * Cột)"}),e.jsxs("td",{children:[(X=z[0])==null?void 0:X.G_C_R," * ",(A=z[0])==null?void 0:A.G_C," ="," ",((L=z[0])==null?void 0:L.G_C_R)*((g=z[0])==null?void 0:g.G_C)]})]})]})]}),e.jsxs("table",{className:"ttyc2",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Hạng mục/항목"}),e.jsx("th",{children:"Thông tin/정보"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Nhà máy/공장"}),e.jsx("td",{children:T})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Máy/호기"}),e.jsx("td",{children:F})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Note (KD)"}),e.jsx("td",{children:z[0].REMK})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Chú ý (QLSX)"}),e.jsx("td",{})]})]})]})]}),e.jsx("div",{className:"text1",children:"2. 입고 정보 Thông tin nhập hàng"}),e.jsx("div",{className:"thongtinvatlieu",children:e.jsx("div",{className:"vatlieugiua",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Ngày giờ nhập/입고일시"}),e.jsx("th",{children:"Người giao/인수자명"}),e.jsx("th",{children:"Dán label/라벨 부착"}),e.jsx("th",{children:"Chiều cuốn/ 권취방향 확인"}),e.jsx("th",{children:"Số lượng cân /무게"}),e.jsx("th",{children:"Số lượng/수량 EA"}),e.jsx("th",{children:"Người xác nhận/확인자"})]})}),e.jsx("tbody",{children:[1,2,3,4,5,6,7,8,9,10].map((ie,Oe)=>e.jsxs("tr",{children:[e.jsx("td",{style:{height:30}}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{})]},Oe))})]})})})]})]})};const an=({PLAN_LIST:C})=>{var z,Ee,ae,Y,Le,he,Ce,ge,Z,de,S,K,ee,X;const[V,f]=d.useState(!1);let w=C.filter((A,L)=>A.STEP===0)[0];ft(A=>A.totalSlice.userData);const[p,F]=d.useState([{REMK:"20220617",PROD_REQUEST_QTY:18e3,PROD_REQUEST_NO:"2FH0078",PROD_REQUEST_DATE:"20220617",G_CODE:"7A07975A",DELIVERY_DT:"20220620",CODE_55:"03",CODE_50:"02",RIV_NO:"A",M_QTY:1,M_CODE:"A0009027",CUST_NAME:"",ROLE_EA_QTY:2e3,PACK_DRT:"",PROD_PRINT_TIMES:1,G_WIDTH:28.6,G_SG_R:2,G_SG_L:2,G_R:0,G_NAME:"",G_LG:3,G_LENGTH:23,G_CODE_C:"",G_CG:4,G_C:1,G_C_R:4,PD:31.6,CODE_33:"02",M_NAME:"",WIDTH_CD:110,EMPL_NO:"",EMPL_NAME:"",CODE_03:"01",REMARK:"",TONLIEU:0,HOLDING:0,TONG_TON_LIEU:0,PROD_DIECUT_STEP:0,FACTORY:"",EQ1:"",EQ2:"",Setting1:0,Setting2:0,UPH1:0,UPH2:0,Step1:0,Step2:0,LOSS_SX1:0,LOSS_SX2:0,LOSS_SETTING1:0,LOSS_SETTING2:0,NOTE:"",FSC:"N"}]),[T,k]=d.useState([]),[ce,Ne]=d.useState(12),ke=async()=>{x("getchithidatatable",{PLAN_ID:w.PLAN_ID}).then(A=>{A.data.tk_status!=="NG"&&k(A.data.data)}).catch(A=>{console.log(A)})},I=async()=>{x("ycsx_fullinfo",{PROD_REQUEST_NO:w.PROD_REQUEST_NO}).then(A=>{if(A.data.tk_status!=="NG"){for(let L=0;L<A.data.data.length;L++)A.data.data[L].PROD_MAIN_MATERIAL===A.data.data[L].M_NAME&&A.data.data[L].LIEUQL_SX===1&&f(!0);F(A.data.data)}else F([{REMK:"",PROD_REQUEST_QTY:0,PROD_REQUEST_NO:"",PROD_REQUEST_DATE:"",G_CODE:"",DELIVERY_DT:"",CODE_55:"03",CODE_50:"02",RIV_NO:"",M_QTY:1,M_CODE:"",CUST_NAME:"",ROLE_EA_QTY:0,PACK_DRT:"",PROD_PRINT_TIMES:0,G_WIDTH:0,G_SG_R:0,G_SG_L:0,G_R:0,G_NAME:"",G_LG:0,G_LENGTH:0,G_CODE_C:"",G_CG:0,G_C:0,G_C_R:0,PD:0,CODE_33:"02",M_NAME:"",WIDTH_CD:0,EMPL_NO:"",EMPL_NAME:"",CODE_03:"01",REMARK:"",TONLIEU:0,HOLDING:0,TONG_TON_LIEU:0,NO_INSPECTION:"N",PROD_DIECUT_STEP:0,FACTORY:"",EQ1:"",EQ2:"",Setting1:0,Setting2:0,UPH1:0,UPH2:0,Step1:0,Step2:0,LOSS_SX1:0,LOSS_SX2:0,LOSS_SETTING1:0,LOSS_SETTING2:0,NOTE:"",FSC:"N"}])}).catch(A=>{console.log(A)})},ne=()=>{var L;let A=(L=localStorage.getItem("maxLieu"))==null?void 0:L.toString();A!==void 0?(console.log("temp max lieu: ",A),Ne(A)):localStorage.setItem("maxLieu","12")};return d.useEffect(()=>{ne(),I(),ke()},[]),e.jsxs("div",{className:"chithicomponent2",children:[e.jsxs("div",{className:"tieudeycsx",children:[e.jsxs("div",{className:"leftlogobarcode",children:[p[0].PDBV==="Y"&&V===!0&&e.jsx("img",{alt:"logo",src:"/logocmsvina.png",width:160,height:40}),e.jsx(Ot,{value:w.PLAN_ID,format:"CODE128",width:1,height:50,displayValue:!1,background:"#fff",lineColor:"black",margin:0}),w.PLAN_ID]}),e.jsxs("div",{className:"headertitle",children:["생산 지시서 - Chỉ thị Sản Xuất(",w.PLAN_EQ,"- B",w.STEP,")",e.jsx("br",{}),e.jsxs("span",{style:{fontSize:12},children:["Thời điểm in CTSX: ",q().format("YYYY-MM-DD HH:mm:ss")]}),e.jsx("br",{})," ",p[0].NO_INSPECTION==="Y"&&e.jsx("span",{style:{fontSize:18},children:"(Sản phẩm không kiểm tra ngoại quan)"})]}),e.jsx("div",{className:"soycsx",children:e.jsxs("div",{className:"ycsxbarcode",children:[e.jsx(Ot,{value:(z=p[0])==null?void 0:z.PROD_REQUEST_NO,format:"CODE128",width:1,height:50,displayValue:!1,background:"#fff",lineColor:"black",margin:0}),e.jsxs("div",{className:"ycsxno",children:[p[0].PROD_REQUEST_DATE,"-",p[0].PROD_REQUEST_NO," "]})]})})]}),e.jsxs("div",{className:"thongtinycsx",children:[e.jsxs("div",{className:"text1",children:["1. 지시 정보 Thông tin chỉ thị (",p[0].G_NAME," ) __ PO_TYPE: ",p[0].PO_TYPE]}),e.jsxs("div",{className:"thongtinyeucau",children:[e.jsxs("table",{className:"ttyc1",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Hạng mục/항목"}),e.jsx("th",{children:"Thông tin/정보"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Người yêu cầu/요청자"}),e.jsx("td",{children:(Ee=p[0])==null?void 0:Ee.EMPL_NAME})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Khách hàng/고객사"}),e.jsx("td",{children:(ae=p[0])==null?void 0:ae.CUST_NAME})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Mã sản phẩm/제품코드"}),e.jsx("td",{children:(Y=p[0])==null?void 0:Y.G_CODE})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Tên sản phẩm/제품명"}),e.jsx("td",{children:(Le=p[0])==null?void 0:Le.G_NAME})]})]})]}),e.jsxs("table",{className:"ttyc2",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Hạng mục/항목"}),e.jsx("th",{children:"Thông tin/정보"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Số lượng yêu cầu/요청 수량"}),e.jsxs("td",{children:[(he=p[0])==null?void 0:he.PROD_REQUEST_QTY.toLocaleString("en-US")," ","EA"]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Số lượng chỉ thị/지시 수량"}),e.jsxs("td",{children:[(Ce=w.PLAN_QTY)==null?void 0:Ce.toLocaleString("en-US")," EA"]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"P/D"}),e.jsx("td",{children:(ge=p[0])==null?void 0:ge.PD.toLocaleString("en-US")})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Cavity (Hàng * Cột)"}),e.jsxs("td",{children:[(Z=p[0])==null?void 0:Z.G_C_R," * ",(de=p[0])==null?void 0:de.G_C," ="," ",((S=p[0])==null?void 0:S.G_C_R)*((K=p[0])==null?void 0:K.G_C)]})]})]})]}),e.jsxs("table",{className:"ttyc2",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Hạng mục/항목"}),e.jsx("th",{children:"Thông tin/정보"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Nhà máy/공장"}),e.jsx("td",{children:w.PLAN_FACTORY})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Máy/호기"}),e.jsx("td",{children:w.PLAN_EQ})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Chú ý (Kdoanh)"}),e.jsx("td",{children:p[0].REMK})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Chú ý (QLSX)"}),e.jsx("td",{children:(ee=p[0])==null?void 0:ee.NOTE})]})]})]})]}),e.jsx("div",{className:"text1",children:"2. Thông tin combo chỉ thị"}),e.jsx("div",{className:"combochithi",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"PLAN_ID"}),e.jsx("th",{children:"Barcode"}),e.jsx("th",{children:"Machine"}),e.jsx("th",{children:"Step"}),e.jsx("th",{children:"Plan QTY"})]})}),e.jsx("tbody",{children:C.map((A,L)=>e.jsxs("tr",{children:[e.jsx("td",{children:L}),A.STEP===0?e.jsx("td",{style:{color:"red",fontWeight:"bold",backgroundColor:"lightgreen"},children:A.PLAN_ID}):e.jsx("td",{children:A.PLAN_ID}),e.jsx("td",{children:e.jsx(Ot,{value:A.PLAN_ID,format:"CODE128",width:1.5,height:25,displayValue:!1,background:"#fff",lineColor:"black",margin:0})}),e.jsx("td",{children:A.PLAN_EQ}),e.jsx("td",{children:A.STEP}),e.jsx("td",{children:A.PLAN_QTY.toLocaleString("en-US")})]},L))})]})}),e.jsxs("div",{className:"text1",children:["3. LOSS INFO (Phân loại: ",p[0].CODE_50==="01"?"GC":p[0].CODE_50==="02"?"SK":p[0].CODE_50==="03"?"KD":p[0].CODE_50==="04"?"VN":p[0].CODE_50==="05"?"SAMPLE":p[0].CODE_50==="06"?"Vai bac 4":"ETC",")  _",((X=p[0])==null?void 0:X.FSC)==="Y"?"(FSC Mix Credit)":"","  "]}),e.jsx("div",{className:"thongtinyeucau",children:e.jsxs("table",{className:"ttyc1",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"PLAN_ID"}),e.jsx("th",{children:"STEP"}),e.jsx("th",{children:"Bóc kiểm (EA)/파괴검사"}),e.jsx("th",{children:"Lấy đồ/도구 준비"}),e.jsx("th",{children:"Máy hỏng/설비 고장"}),e.jsx("th",{children:"Dao NG/칼 불량"}),e.jsx("th",{children:"Chờ liệu/원단 대기"}),e.jsx("th",{children:"Chờ BTP/BTP 대기"}),e.jsx("th",{children:"Hết liệu/원단 떨어짐"}),e.jsx("th",{children:"Liệu NG/원단 불량"})]})}),e.jsx("tbody",{children:C.map((A,L)=>e.jsxs("tr",{children:[e.jsx("td",{style:{height:"20px"},children:A.PLAN_ID}),e.jsx("td",{style:{height:"20px"},children:A.STEP}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{})]}))})]})}),e.jsxs("div",{className:"text1",children:["5. 제품 정보 Thông tin vật liệu | Liệu chính ",p[0].PROD_MAIN_MATERIAL," | ",V===!0?"Đã SET":"Chưa SET"]}),e.jsxs("div",{className:"thongtinvatlieu",children:[T.length<=ce&&e.jsx("div",{className:"vatlieugiua",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Mã Liệu/원단코드"}),e.jsx("th",{children:"Tên Liệu/원단명"}),e.jsx("th",{children:"Size Liệu/원단폭"}),e.jsx("th",{children:"SL chỉ thị/지시 수량"}),e.jsx("th",{children:"Thực xuất M/실제 출고 M"}),e.jsx("th",{children:"Thực xuất Roll/실제 출고 Roll"}),e.jsx("th",{children:"Ghi chú/비고"})]})}),e.jsx("tbody",{children:T.map((A,L)=>e.jsxs("tr",{children:[e.jsx("td",{children:L}),e.jsx("td",{children:A.M_CODE}),A.LIEUQL_SX===1?e.jsx("td",{style:{color:"red",fontWeight:"bold",backgroundColor:"lightgreen"},children:A.M_NAME}):e.jsx("td",{children:A.M_NAME}),e.jsx("td",{children:A.WIDTH_CD}),e.jsxs("td",{children:[(A.M_MET_QTY*A.M_QTY).toLocaleString("en-US")," ","M"]}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{children:A.LIEUQL_SX})]},L))})]})}),T.length>ce&&e.jsx("div",{className:"vatlieutrai",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Mã Liệu/원단코드"}),e.jsx("th",{children:"Tên Liệu/원단명"}),e.jsx("th",{children:"Size Liệu/원단폭"}),e.jsx("th",{children:"SL chỉ thị/지시 수량"}),e.jsx("th",{children:"Thực xuất M/실제 출고 M"}),e.jsx("th",{children:"Thực xuất Roll/실제 출고 Roll"}),e.jsx("th",{children:"Ghi chú/비고"})]})}),e.jsx("tbody",{children:T.map((A,L)=>L<=ce&&e.jsxs("tr",{children:[e.jsx("td",{children:L}),e.jsx("td",{children:A.M_CODE}),A.LIEUQL_SX===1?e.jsx("td",{style:{color:"red",fontWeight:"bold",backgroundColor:"lightgreen"},children:A.M_NAME}):e.jsx("td",{children:A.M_NAME}),e.jsx("td",{children:A.WIDTH_CD}),e.jsxs("td",{children:[(A.M_MET_QTY*A.M_QTY).toLocaleString("en-US")," ","M"]}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{children:A.LIEUQL_SX})]},L))})]})}),T.length>ce&&e.jsx("div",{className:"vatlieuphai",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Mã Liệu/원단코드"}),e.jsx("th",{children:"Tên Liệu/원단명"}),e.jsx("th",{children:"Size Liệu/원단폭"}),e.jsx("th",{children:"SL chỉ thị/지시 수량"}),e.jsx("th",{children:"Thực xuất M/실제 출고 M"}),e.jsx("th",{children:"Thực xuất Roll/실제 출고 Roll"}),e.jsx("th",{children:"Ghi chú/비고"})]})}),e.jsx("tbody",{children:T.map((A,L)=>L>ce&&e.jsxs("tr",{children:[e.jsx("td",{children:L}),e.jsx("td",{children:A.M_CODE}),A.LIEUQL_SX===1?e.jsx("td",{style:{color:"red",fontWeight:"bold",backgroundColor:"lightgreen"},children:A.M_NAME}):e.jsx("td",{children:A.M_NAME}),e.jsx("td",{children:A.WIDTH_CD}),e.jsxs("td",{children:[(A.M_MET_QTY*A.M_QTY).toLocaleString("en-US")," ","M"]}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{children:A.LIEUQL_SX})]},L))})]})})]})]})]})},sn=()=>{d.useTransition();const C=ft(t=>t.totalSlice.multiple_chithi_array),V=Fl(),[f,w]=d.useState(0),[p,F]=d.useState(0),[T,k]=d.useState({tab1:!0,tab2:!1,tab3:!1,tabycsx:!1,tabbanve:!1}),ce=t=>{t===1?k({...T,tab1:!0,tab2:!1,tab3:!1}):t===2?k({...T,tab1:!1,tab2:!0,tab3:!1}):t===3&&k({...T,tab1:!1,tab2:!1,tab3:!0})},[Ne,ke]=d.useState([]),[I,ne]=d.useState({FACTORY:"",EQ1:"",EQ2:"",Setting1:0,Setting2:0,UPH1:0,UPH2:0,Step1:0,Step2:0,LOSS_SX1:0,LOSS_SX2:0,LOSS_SETTING1:0,LOSS_SETTING2:0,NOTE:""});d.useState([]),d.useState([]),d.useState([]);const[z,Ee]=d.useState([]);d.useState([]);const[ae,Y]=d.useState(!0),[Le,he]=d.useState([]);d.useState([]);const[Ce,ge]=d.useState([]);d.useState([]);const[Z,de]=d.useState([]),[S,K]=d.useState([]),[ee,X]=d.useState(!1),[A,L]=d.useState(!1),g=ft(t=>t.totalSlice.userData),[ie,Oe]=d.useState(!1),[M,y]=d.useState(q().format("YYYY-MM-DD")),[He,H]=d.useState(q().format("YYYY-MM-DD")),[Ze,Fe]=d.useState(""),[at,We]=d.useState(""),[it,et]=d.useState(""),[Ke,Q]=d.useState(""),[te,Rt]=d.useState(""),[Yt,pt]=d.useState(""),[Lt,gt]=d.useState(!1),[Qt,At]=d.useState("00"),[Kt,jt]=d.useState(""),[st,ht]=d.useState([]),[se,ue]=d.useState([]),[De,W]=d.useState([]),[Ie,R]=d.useState([]),[Bt,_t]=d.useState([]);d.useState([]);const[wt,Ve]=d.useState(!0),[ze,Se]=d.useState(!1),[tt,Pt]=d.useState(!1),[mt,qe]=d.useState(),[Ut,bt]=d.useState(),[rt,fe]=d.useState(),[It,yt]=d.useState(),[Me,Re]=d.useState("FR1"),[$e,Ae]=d.useState("NM1"),[je,vt]=d.useState(q().format("YYYY-MM-DD")),[r,ot]=d.useState(),[St,Tt]=d.useState(!1),[Nt,Ye]=d.useState(!1),[Ft,pe]=d.useState(!1),[lt,Et]=d.useState(!0),[n,_]=d.useState(!0),u=d.useRef(null),[j,N]=d.useState(12),re=()=>{var a;let t=(a=localStorage.getItem("maxLieu"))==null?void 0:a.toString();t!==void 0?(console.log("temp max lieu: ",t),N(t)):localStorage.setItem("maxLieu","12")},$=Ul.useReactToPrint({content:()=>u.current}),Te=[{field:"G_CODE",headerName:"G_CODE",width:80},{field:"G_NAME",headerName:"G_NAME",width:250,renderCell:t=>t.row.PDBV==="P"||t.row.PDBV===null?e.jsx("span",{style:{color:"red"},children:t.row.G_NAME}):e.jsx("span",{style:{color:"green"},children:t.row.G_NAME})},{field:"EMPL_NAME",headerName:"PIC KD",width:150},{field:"CUST_NAME_KD",headerName:"KHÁCH",width:120},{field:"PROD_REQUEST_NO",headerName:"SỐ YCSX",width:80},{field:"PROD_REQUEST_DATE",headerName:"NGÀY YCSX",width:80},{field:"PROD_REQUEST_QTY",type:"number",headerName:"SL YCSX",width:80,renderCell:t=>e.jsx("span",{style:{color:"#009933"},children:e.jsx("b",{children:t.row.PROD_REQUEST_QTY.toLocaleString("en-US")})})},{field:"LOT_TOTAL_INPUT_QTY_EA",type:"number",headerName:"NHẬP KIỂM",width:80,renderCell:t=>e.jsx("span",{style:{color:"#cc0099"},children:e.jsx("b",{children:t.row.LOT_TOTAL_INPUT_QTY_EA.toLocaleString("en-US")})})},{field:"LOT_TOTAL_OUTPUT_QTY_EA",type:"number",headerName:"XUẤT KIỂM",width:80,renderCell:t=>e.jsx("span",{style:{color:"#cc0099"},children:e.jsx("b",{children:t.row.LOT_TOTAL_OUTPUT_QTY_EA.toLocaleString("en-US")})})},{field:"SHORTAGE_YCSX",type:"number",headerName:"TỒN YCSX",width:80,renderCell:t=>e.jsx("span",{style:{color:"blue"},children:e.jsx("b",{children:t.row.SHORTAGE_YCSX.toLocaleString("en-US")})})},{field:"PHAN_LOAI",headerName:"PHAN_LOAI",width:80,renderCell:t=>{if(t.row.PHAN_LOAI==="01")return e.jsx("span",{style:{color:"black"},children:e.jsx("b",{children:"Thông thường"})});if(t.row.PHAN_LOAI==="02")return e.jsx("span",{style:{color:"black"},children:e.jsx("b",{children:"SDI"})});if(t.row.PHAN_LOAI==="03")return e.jsx("span",{style:{color:"black"},children:e.jsx("b",{children:"GC"})});if(t.row.PHAN_LOAI==="04")return e.jsx("span",{style:{color:"black"},children:e.jsx("b",{children:"SAMPLE"})})}},{field:"REMARK",headerName:"REMARK",width:120},{field:"PDUYET",headerName:"PDUYET",width:80,renderCell:t=>t.row.PDUYET===1?e.jsx("span",{style:{color:"green"},children:e.jsx("b",{children:"Đã Duyệt"})}):e.jsx("span",{style:{color:"red"},children:e.jsx("b",{children:"Không Duyệt"})})},{field:"BANVE",headerName:"BANVE",width:250,renderCell:t=>{let a=null,s="http://14.160.33.94:5011/upload";const o=async E=>{console.log(a);const G=new FormData;if(G.append("banve",a),G.append("filename",t.row.G_CODE),(g==null?void 0:g.MAINDEPTNAME)==="KD")try{const v=await pl.post(s,G);v.data.tk_status==="OK"?x("update_banve_value",{G_CODE:t.row.G_CODE,banvevalue:"Y"}).then(m=>{if(m.data.tk_status!=="NG"){h.fire("Thông báo","Upload bản vẽ thành công","success");let U=st.map((B,dt)=>B.PROD_REQUEST_NO===t.row.PROD_REQUEST_NO?{...B,BANVE:"Y"}:B);ht(U)}else h.fire("Thông báo","Upload bản vẽ thất bại","error")}).catch(m=>{console.log(m)}):h.fire("Thông báo",v.data.message,"error")}catch(v){console.log(v)}else h.fire("Thông báo","Chỉ bộ phận kinh doanh upload được bản vẽ","error")};let P="/banve/"+t.row.G_CODE+".pdf";return t.row.BANVE==="Y"?e.jsx("span",{style:{color:"green"},children:e.jsx("b",{children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",href:P,children:"LINK"})})}):e.jsxs("div",{className:"uploadfile",children:[e.jsxs(b,{className:"buttonIcon",onClick:o,children:[e.jsx(Rl,{color:"yellow",size:25}),"Upload"]}),e.jsx("input",{accept:".pdf",type:"file",onChange:E=>{a=E.target.files[0],console.log(a)}})]})}},{field:"PDBV",headerName:"PD BANVE",width:80,renderCell:t=>t.row.PDBV==="P"||t.row.PDBV===null?e.jsx("span",{style:{color:"red"},children:e.jsx("b",{children:"PENDING"})}):e.jsx("span",{style:{color:"green"},children:e.jsx("b",{children:"APPROVED"})})},{field:"",headerName:"G_NAME",width:250,renderCell:t=>t.row.PDBV==="P"||t.row.PDBV===null?e.jsx("span",{style:{color:"red"},children:t.row.G_NAME}):e.jsx("span",{style:{color:"green"},children:t.row.G_NAME})},{field:"PO_BALANCE",headerName:"PO_BALANCE",width:110,renderCell:t=>e.jsx("span",{style:{color:"blue"},children:e.jsx("b",{children:t.row.PO_BALANCE.toLocaleString("en","US")})})},{field:"EQ1",headerName:"EQ1",width:80,renderCell:t=>e.jsx("span",{style:{color:"black"},children:t.row.EQ1})},{field:"EQ2",headerName:"EQ2",width:80,renderCell:t=>e.jsx("span",{style:{color:"black"},children:t.row.EQ2})},{field:"CD1",headerName:"XUAT_CD1",width:100,renderCell:t=>e.jsx("span",{style:{color:"blue"},children:e.jsx("b",{children:t.row.CD1.toLocaleString("en","US")})})},{field:"CD2",headerName:"XUAT_CD2",width:100,renderCell:t=>e.jsx("span",{style:{color:"blue"},children:e.jsx("b",{children:t.row.CD2.toLocaleString("en","US")})})},{field:"LOT_TOTAL_OUTPUT_QTY_EA",type:"number",headerName:"XUẤT KIỂM",width:100,renderCell:t=>e.jsx("span",{style:{color:"#cc0099"},children:e.jsx("b",{children:t.row.LOT_TOTAL_OUTPUT_QTY_EA.toLocaleString("en-US")})})},{field:"CD_IN",headerName:"CD_IN",width:80,renderCell:t=>e.jsx("span",{style:{color:"gray"},children:e.jsx("b",{children:t.row.CD_IN.toLocaleString("en","US")})})},{field:"CD_DIECUT",headerName:"CD_DIECUT",width:80,renderCell:t=>e.jsx("span",{style:{color:"gray"},children:e.jsx("b",{children:t.row.CD_DIECUT.toLocaleString("en","US")})})},{field:"TON_CD1",headerName:"TONYCSX_CD1",width:120,renderCell:t=>e.jsx("span",{style:{color:"red"},children:e.jsx("b",{children:t.row.TON_CD1.toLocaleString("en","US")})})},{field:"TON_CD2",headerName:"TONYCSX_CD2",width:120,renderCell:t=>e.jsx("span",{style:{color:"red"},children:e.jsx("b",{children:t.row.TON_CD2.toLocaleString("en","US")})})},{field:"INSPECT_BALANCE",type:"number",headerName:"TỒN KIỂM",width:80,renderCell:t=>e.jsx("span",{style:{color:"#cc0099"},children:e.jsx("b",{children:t.row.INSPECT_BALANCE.toLocaleString("en-US")})})},{field:"YCSX_PENDING",headerName:"YCSX_PENDING",width:80,renderCell:t=>t.row.YCSX_PENDING===1?e.jsx("span",{style:{color:"red"},children:e.jsx("b",{children:"PENDING"})}):e.jsx("span",{style:{color:"green"},children:e.jsx("b",{children:"CLOSED"})})}],oe=[{field:"PLAN_ID",headerName:"PLAN_ID",width:90,editable:!1,resizeable:!0,renderCell:t=>t.row.DKXL===null?e.jsx("span",{style:{color:"red"},children:t.row.PLAN_ID}):e.jsx("span",{style:{color:"green"},children:t.row.PLAN_ID})},{field:"G_CODE",headerName:"G_CODE",width:100,editable:!1},{field:"G_NAME_KD",headerName:"G_NAME_KD",width:180,editable:!1,renderCell:t=>t.row.FACTORY===null||t.row.EQ1===null||t.row.EQ2===null||t.row.Setting1===null||t.row.Setting2===null||t.row.UPH1===null||t.row.UPH2===null||t.row.Step1===null||t.row.Step1===null||t.row.LOSS_SX1===null||t.row.LOSS_SX2===null||t.row.LOSS_SETTING1===null||t.row.LOSS_SETTING2===null?e.jsx("span",{style:{color:"red"},children:t.row.G_NAME_KD}):e.jsx("span",{style:{color:"green"},children:t.row.G_NAME_KD})},{field:"PROD_REQUEST_QTY",headerName:"YCSX QTY",width:80,editable:!1,renderCell:t=>e.jsx("span",{style:{color:"blue"},children:t.row.PROD_REQUEST_QTY.toLocaleString("en","US")})},{field:"CD1",headerName:"KQ_CD1",width:80,editable:!1,renderCell:t=>e.jsx("span",{style:{color:"blue"},children:t.row.CD1.toLocaleString("en","US")})},{field:"CD2",headerName:"KQ_CD2",width:80,editable:!1,renderCell:t=>e.jsx("span",{style:{color:"blue"},children:t.row.CD2.toLocaleString("en","US")})},{field:"TON_CD1",headerName:"TONYCSX_CD1",width:120,editable:!1,renderCell:t=>e.jsx("span",{style:{color:"blue"},children:t.row.TON_CD1.toLocaleString("en","US")})},{field:"TON_CD2",headerName:"TONYCSX_CD2",width:120,editable:!1,renderCell:t=>e.jsx("span",{style:{color:"blue"},children:t.row.TON_CD2.toLocaleString("en","US")})},{field:"PLAN_QTY",headerName:"PLAN_QTY",width:80,editable:lt,renderCell:t=>t.row.PLAN_QTY===0?e.jsx("span",{style:{color:"red"},children:"NG"}):e.jsx("span",{style:{color:"green"},children:t.row.PLAN_QTY.toLocaleString("en","US")})},{field:"PROCESS_NUMBER",headerName:"PROCESS_NUMBER",width:110,editable:lt,renderCell:t=>t.row.PROCESS_NUMBER===null||t.row.PROCESS_NUMBER===0?e.jsx("span",{style:{color:"red"},children:"NG"}):e.jsx("span",{style:{color:"green"},children:t.row.PROCESS_NUMBER})},{field:"STEP",headerName:"STEP",width:60,editable:lt},{field:"PLAN_ORDER",headerName:"PLAN_ORDER",width:110,editable:lt},{field:"KETQUASX",headerName:"KETQUASX",width:110,editable:lt,renderCell:t=>t.row.KETQUASX!==null?e.jsx("span",{children:t.row.KETQUASX.toLocaleString("en-US")}):e.jsx("span",{children:"0"})},{field:"KQ_SX_TAM",headerName:"KETQUASX_TAM",width:120,editable:lt,renderCell:t=>t.row.KQ_SX_TAM!==null?e.jsx("span",{children:t.row.KQ_SX_TAM.toLocaleString("en-US")}):e.jsx("span",{children:"0"})},{field:"PLAN_EQ",headerName:"PLAN_EQ",width:80,editable:lt},{field:"PLAN_FACTORY",headerName:"FACTORY",width:80,editable:!1},{field:"PLAN_DATE",headerName:"PLAN_DATE",width:110,editable:!1},{field:"PROD_REQUEST_NO",headerName:"YCSX NO",width:80,editable:!1},{field:"PROD_REQUEST_DATE",headerName:"YCSX DATE",width:80,editable:!1},{field:"NEXT_PLAN_ID",headerName:"NEXT_PLAN_ID",width:120,editable:!0},{field:"INS_EMPL",headerName:"INS_EMPL",width:120,editable:!1,hide:!0},{field:"INS_DATE",headerName:"INS_DATE",width:120,editable:!1,hide:!0},{field:"UPD_EMPL",headerName:"UPD_EMPL",width:120,editable:!1,hide:!0},{field:"UPD_DATE",headerName:"UPD_DATE",width:120,editable:!1,hide:!0}],ct=[{field:"CHITHI_ID",headerName:"CHITHI_ID",width:90,editable:!1},{field:"PLAN_ID",headerName:"PLAN_ID",width:90,editable:!1},{field:"M_CODE",headerName:"M_CODE",width:80,editable:!1},{field:"M_NAME",headerName:"M_NAME",width:120,editable:!1,renderCell:t=>t.row.LIEUQL_SX===1?e.jsx("span",{style:{color:"red",fontWeight:"bold"},children:t.row.M_NAME}):e.jsx("span",{style:{color:"black"},children:t.row.M_NAME})},{field:"WIDTH_CD",headerName:"SIZE",width:80,editable:!1},{field:"M_MET_QTY",headerName:"M_MET_QTY",width:110,editable:n,renderCell:t=>t.row.M_MET_QTY===0?e.jsx("span",{style:{color:"red"},children:"NG"}):e.jsx("span",{style:{color:"green"},children:t.row.M_MET_QTY})},{field:"M_QTY",headerName:"M_QTY",width:110,editable:n},{field:"LIEUQL_SX",headerName:"LIEUQL_SX",width:110,editable:n},{field:"OUT_KHO_SX",headerName:"OUT_KHO_SX",width:110,editable:n,renderCell:t=>e.jsx("p",{style:{color:"blue",fontWeight:"bold"},children:t.row.OUT_KHO_SX!==null?t.row.OUT_KHO_SX.toLocaleString("en","US"):0})},{field:"OUT_CFM_QTY",headerName:"OUT_KHO_THAT",width:110,editable:n},{field:"INS_EMPL",headerName:"INS_EMPL",width:120,editable:!1,hide:!0},{field:"INS_DATE",headerName:"INS_DATE",width:120,editable:n,hide:!0},{field:"UPD_EMPL",headerName:"UPD_EMPL",width:120,editable:!1,hide:!0},{field:"UPD_DATE",headerName:"UPD_DATE",width:120,editable:!1,hide:!0}],be=()=>{x("checkEQ_STATUS",{}).then(t=>{if(t.data.tk_status!=="NG"){const a=t.data.data.map((s,o)=>({...s,id:o}));ke(a)}else ke([])}).catch(t=>{console.log(t)})},ut=t=>{x("lichsuinputlieusanxuat",{PLAN_ID:t}).then(a=>{if(console.log(a.data.data),a.data.tk_status!=="NG"){const s=a.data.data.map((o,P)=>({...o,INS_DATE:q(o.INS_DATE).utc().format("YYYY-MM-DD HH:mm:ss"),id:P}));ge(s)}}).catch(a=>{console.log(a)})},Wt=()=>{x("lichsunhapkhoao",{}).then(t=>{if(t.data.tk_status!=="NG"){const a=t.data.data.map((s,o)=>({...s,INS_DATE:q(s.INS_DATE).utc().format("YYYY-MM-DD HH:mm:ss"),id:o}));Ee(a)}else Ee([])}).catch(t=>{console.log(t)})},ol=()=>{x("lichsuxuatkhoao",{}).then(t=>{if(t.data.tk_status!=="NG"){const a=t.data.data.map((s,o)=>({...s,INS_DATE:q(s.INS_DATE).utc().format("YYYY-MM-DD HH:mm:ss"),id:o}));he(a)}else he([])}).catch(t=>{console.log(t)})},Zt=()=>{x("checktonlieutrongxuong",{}).then(t=>{if(t.data.tk_status!=="NG"){const a=t.data.data.map((s,o)=>({...s,id:o}));_t(a)}else _t([])}).catch(t=>{console.log(t)})},el=async()=>{if(r!==void 0)if((g==null?void 0:g.EMPL_NO)==="NHU1903"||(g==null?void 0:g.MAINDEPTNAME)==="QLSX"){let t="0";console.log(I),I.FACTORY==="NA"||I.EQ1==="NA"||I.EQ1==="NO"||I.EQ2===""||I.Setting1===0||I.UPH1===0||I.Step1===0||I.LOSS_SX1===0?h.fire("Thông báo","Lưu thất bại, hãy nhập đủ thông tin","error"):(x("saveQLSX",{G_CODE:r==null?void 0:r.G_CODE,FACTORY:I.FACTORY,EQ1:I.EQ1,EQ2:I.EQ2,Setting1:I.Setting1,Setting2:I.Setting2,UPH1:I.UPH1,UPH2:I.UPH2,Step1:I.Step1,Step2:I.Step2,LOSS_SX1:I.LOSS_SX1,LOSS_SX2:I.LOSS_SX2,LOSS_SETTING1:I.LOSS_SETTING1,LOSS_SETTING2:I.LOSS_SETTING2,NOTE:I.NOTE}).then(a=>{console.log(a.data.tk_status),a.data.tk_status!=="NG"||(t="1")}).catch(a=>{console.log(a)}),t==="1"?h.fire("Thông báo","Lưu thất bại, không được để trống ô cần thiết","error"):(Qe(je),h.fire("Thông báo","Lưu thành công","success")))}else h.fire("Thông báo","Không đủ quyền hạn!","error");else h.fire("Thông báo","Chọn ít nhất 1 G_CODE để SET !","error")},Vt=t=>t.map((a,s)=>e.jsx(vl,{PLAN_ID:a.PLAN_ID,PLAN_DATE:a.PLAN_DATE,PROD_REQUEST_NO:a.PROD_REQUEST_NO,PLAN_QTY:a.PLAN_QTY,PLAN_EQ:a.PLAN_EQ,PLAN_FACTORY:a.PLAN_FACTORY,PLAN_LEADTIME:a.PLAN_LEADTIME,G_CODE:a.G_CODE,G_NAME:a.G_NAME,G_NAME_KD:a.G_NAME_KD,PROD_REQUEST_DATE:a.PROD_REQUEST_DATE,PROD_REQUEST_QTY:a.PROD_REQUEST_QTY,STEP:a.STEP,PLAN_ORDER:a.PLAN_ORDER},s)),zt=t=>t.map((a,s)=>e.jsx(yl,{PLAN_ID:a.PLAN_ID,PLAN_DATE:a.PLAN_DATE,PROD_REQUEST_NO:a.PROD_REQUEST_NO,PLAN_QTY:a.PLAN_QTY,PLAN_EQ:a.PLAN_EQ,PLAN_FACTORY:a.PLAN_FACTORY,PLAN_LEADTIME:a.PLAN_LEADTIME,G_CODE:a.G_CODE,G_NAME:a.G_NAME,G_NAME_KD:a.G_NAME_KD,PROD_REQUEST_DATE:a.PROD_REQUEST_DATE,PROD_REQUEST_QTY:a.PROD_REQUEST_QTY,STEP:a.STEP,PLAN_ORDER:a.PLAN_ORDER,PROCESS_NUMBER:a.PROCESS_NUMBER},s)),nt=t=>e.jsx(an,{PLAN_LIST:t}),Xt=t=>t.map((a,s)=>e.jsx(wl,{PROD_REQUEST_NO:a.PROD_REQUEST_NO,G_CODE:a.G_CODE,PO_TDYCSX:a.PO_TDYCSX,TOTAL_TKHO_TDYCSX:a.TOTAL_TKHO_TDYCSX,TKHO_TDYCSX:a.TKHO_TDYCSX,BTP_TDYCSX:a.BTP_TDYCSX,CK_TDYCSX:a.CK_TDYCSX,BLOCK_TDYCSX:a.BLOCK_TDYCSX,FCST_TDYCSX:a.FCST_TDYCSX,PDBV:a.PDBV,PDBV_EMPL:a.PDBV_EMPL,PDBV_DATE:a.PDBV_DATE,DESCR:a.DESCR},s)),tl=t=>t.map((a,s)=>a.BANVE==="Y"?e.jsx(ml,{G_CODE:a.G_CODE,PDBV:a.PDBV,PROD_REQUEST_NO:a.PROD_REQUEST_NO,PDBV_EMPL:a.PDBV_EMPL,PDBV_DATE:a.PDBV_DATE},s):e.jsxs("div",{children:["Code: ",a.G_NAME," : Không có bản vẽ"]})),Qe=t=>{x("getqlsxplan",{PLAN_DATE:t}).then(a=>{if(a.data.tk_status!=="NG"){let s=a.data.data.map((o,P)=>({...o,PLAN_DATE:q.utc(o.PLAN_DATE).format("YYYY-MM-DD"),id:P}));de(s)}else de([]),h.fire("Thông báo","Nội dung: "+a.data.message,"error")}).catch(a=>{console.log(a)})},Pe=async(t,a,s,o)=>{let P=0,E=0,G=0,v=0,m=0,U=0,B=0,dt=0,J=0,xt=0;await x("getcodefullinfo",{G_CODE:a}).then(le=>{le.data.tk_status!=="NG"&&(P=le.data.data[0].PD,E=le.data.data[0].G_C_R,G=le.data.data[0].G_C,v=le.data.data[0].LOSS_SX1===null?0:le.data.data[0].LOSS_SX1,m=le.data.data[0].LOSS_SX2===null?0:le.data.data[0].LOSS_SX2,U=le.data.data[0].LOSS_SETTING1===null?0:le.data.data[0].LOSS_SETTING1,B=le.data.data[0].LOSS_SETTING2===null?0:le.data.data[0].LOSS_SETTING2,dt=o===1?v:m,J=o===1?ae?U:0:ae?B:0)}).catch(le=>{console.log(le)}),w(P),F(E*G),x("getchithidatatable",{PLAN_ID:t}).then(le=>{le.data.tk_status!=="NG"?K(le.data.data):(xt=parseInt((s*P/(G*E)/1e3).toString()),x("getbomsx",{G_CODE:a}).then(Mt=>{if(Mt.data.tk_status!=="NG"){const Bl=Mt.data.data.map((kt,Xl)=>({CHITHI_ID:"NEW"+Xl,PLAN_ID:t,M_CODE:kt.M_CODE,M_NAME:kt.M_NAME,WIDTH_CD:kt.WIDTH_CD,M_ROLL_QTY:0,M_MET_QTY:parseInt(""+(xt+xt*dt/100+J)),M_QTY:kt.M_QTY,LIEUQL_SX:kt.LIEUQL_SX,MAIN_M:kt.MAIN_M,OUT_KHO_SX:0,OUT_KHO_THAT:0,INS_EMPL:"",INS_DATE:"",UPD_EMPL:"",UPD_DATE:"",id:Xl}));K(Bl)}else K([])}).catch(Mt=>{console.log(Mt)}))}).catch(le=>{console.log(le)})},ll=async()=>{if(r!==void 0){let t=0,a=0,s=0,o=(r==null?void 0:r.PLAN_QTY)===void 0?0:r==null?void 0:r.PLAN_QTY,P=(r==null?void 0:r.PROCESS_NUMBER)===void 0?1:r==null?void 0:r.PROCESS_NUMBER,E=0,G=0,v=0,m=0,U=0,B=0,dt=0;await x("getcodefullinfo",{G_CODE:r==null?void 0:r.G_CODE}).then(J=>{J.data.tk_status!=="NG"&&(t=J.data.data[0].PD,a=J.data.data[0].G_C_R,s=J.data.data[0].G_C,E=J.data.data[0].LOSS_SX1===null?0:J.data.data[0].LOSS_SX1,G=J.data.data[0].LOSS_SX2===null?0:J.data.data[0].LOSS_SX2,v=J.data.data[0].LOSS_SETTING1===null?0:J.data.data[0].LOSS_SETTING1,m=J.data.data[0].LOSS_SETTING2===null?0:J.data.data[0].LOSS_SETTING2,U=P===1?E:G,B=P===1?ae?v:0:ae?m:0)}).catch(J=>{console.log(J)}),w(t),F(a*s),dt=parseInt((o*t/(s*a)/1e3).toString()),await x("getbomsx",{G_CODE:r==null?void 0:r.G_CODE}).then(J=>{if(console.log(J.data.tk_status),J.data.tk_status!=="NG"){const xt=J.data.data.map((le,Mt)=>({CHITHI_ID:Mt,PLAN_ID:r==null?void 0:r.PLAN_ID,M_CODE:le.M_CODE,M_NAME:le.M_NAME,WIDTH_CD:le.WIDTH_CD,M_ROLL_QTY:0,M_MET_QTY:parseInt(""+(dt+dt*U/100+B)),M_QTY:le.M_QTY,LIEUQL_SX:le.LIEUQL_SX,MAIN_M:le.MAIN_M,OUT_KHO_SX:0,OUT_KHO_THAT:0,INS_EMPL:"",INS_DATE:"",UPD_EMPL:"",UPD_DATE:"",id:Mt}));K(xt)}else K([])}).catch(J=>{console.log(J)})}else h.fire("Thông báo","Chọn ít nhất 1 PLAN để RESET Liệu","error")},nl=()=>{Oe(!0),x("traYCSXDataFull_QLSX",{alltime:Lt,start_date:M,end_date:He,cust_name:Ke,codeCMS:at,codeKD:Ze,prod_type:te,empl_name:it,phanloai:Qt,ycsx_pending:ze,inspect_inputcheck:tt,prod_request_no:Yt,material:Kt}).then(t=>{if(t.data.tk_status!=="NG"){const a=t.data.data.map((s,o)=>({...s,PO_TDYCSX:s.PO_TDYCSX===void 0||s.PO_TDYCSX===null?0:s.PO_TDYCSX,TOTAL_TKHO_TDYCSX:s.TOTAL_TKHO_TDYCSX===void 0||s.TOTAL_TKHO_TDYCSX===null?0:s.TOTAL_TKHO_TDYCSX,TKHO_TDYCSX:s.TKHO_TDYCSX===void 0||s.TKHO_TDYCSX===null?0:s.TKHO_TDYCSX,BTP_TDYCSX:s.BTP_TDYCSX===void 0||s.BTP_TDYCSX===null?0:s.BTP_TDYCSX,CK_TDYCSX:s.CK_TDYCSX===void 0||s.CK_TDYCSX===null?0:s.CK_TDYCSX,BLOCK_TDYCSX:s.BLOCK_TDYCSX===void 0||s.BLOCK_TDYCSX===null?0:s.BLOCK_TDYCSX,FCST_TDYCSX:s.FCST_TDYCSX===void 0||s.FCST_TDYCSX===null?0:s.FCST_TDYCSX,W1:s.W1===void 0||s.W1===null?0:s.W1,W2:s.W2===void 0||s.W2===null?0:s.W2,W3:s.W3===void 0||s.W3===null?0:s.W3,W4:s.W4===void 0||s.W4===null?0:s.W4,W5:s.W5===void 0||s.W5===null?0:s.W5,W6:s.W6===void 0||s.W6===null?0:s.W6,W7:s.W7===void 0||s.W7===null?0:s.W7,W8:s.W8===void 0||s.W8===null?0:s.W8,PROD_REQUEST_QTY:s.PROD_REQUEST_QTY===void 0||s.PROD_REQUEST_QTY===null?0:s.PROD_REQUEST_QTY}));ht(a),Oe(!1),h.fire("Thông báo","Đã load "+t.data.data.length+" dòng","success")}else h.fire("Thông báo","Nội dung: "+t.data.message,"error"),Oe(!1)}).catch(t=>{console.log(t)})},we=t=>{t.key==="Enter"&&nl()},al=async t=>{if(se.length>=1){let a=!1;for(let s=0;s<se.length;s++)await x("setpending_ycsx",{PROD_REQUEST_NO:se[s].PROD_REQUEST_NO,YCSX_PENDING:t}).then(o=>{console.log(o.data.tk_status),o.data.tk_status!=="NG"||(a=!0)}).catch(o=>{console.log(o)});a?h.fire("Thông báo","Có lỗi SQL: ","error"):h.fire("Thông báo","SET YCSX thành công (chỉ PO của người đăng nhập)!","success")}else h.fire("Thông báo","Chọn ít nhất 1 YCSX để SET !","error")},cl=()=>{h.fire({title:"Chắc chắn muốn SET PENDING YCSX đã chọn ?",text:"Sẽ bắt đầu SET PENDING YCSX đã chọn",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Vẫn Xóa!"}).then(t=>{t.isConfirmed&&(h.fire("Tiến hành SET PENDING","Đang SET PENDING YCSX hàng loạt","success"),al(1))})},il=()=>{h.fire({title:"Chắc chắn muốn SET CLOSED YCSX đã chọn ?",text:"Sẽ bắt đầu SET CLOSED YCSX đã chọn",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Vẫn Xóa!"}).then(t=>{t.isConfirmed&&(h.fire("Tiến hành SET CLOSED","Đang SET CLOSED YCSX hàng loạt","success"),al(0))})},dl=()=>{h.fire({title:"Chắc chắn muốn xóa PLan đã chọn ?",text:"Sẽ bắt đầu xóa Plan đã chọn",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Vẫn Xóa!"}).then(t=>{t.isConfirmed&&(h.fire("Tiến hành Xóa Plan","Đang xóa Plan","success"),Tl())})},hl=()=>{h.fire({title:"Chắc chắn muốn RESET liệu ?",text:"Sẽ bắt đầu RESET liệu",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Vẫn RESET liệu!"}).then(t=>{t.isConfirmed&&(h.fire("Tiến hành RESET liệu","Đang RESET liệu","success"),ll())})},_l=()=>{h.fire({title:"Chắc chắn muốn Đăng ký xuất liệu ?",text:"Sẽ bắt đầu ĐK liệu",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Vẫn ĐK liệu!"}).then(t=>{t.isConfirmed&&(h.fire({title:"Đăng ký xuất liệu kho thật",text:"Đang đăng ký xuất liệu, hay chờ cho tới khi hoàn thành",icon:"info",showCancelButton:!1,allowOutsideClick:!1,confirmButtonText:"OK",showConfirmButton:!1}),r!==void 0?(xl(),bl((r==null?void 0:r.PLAN_ID)===void 0?"xxx":r==null?void 0:r.PLAN_ID,(r==null?void 0:r.PROD_REQUEST_NO)===void 0?"xxx":r==null?void 0:r.PROD_REQUEST_NO,(r==null?void 0:r.PROD_REQUEST_DATE)===void 0?"xxx":r==null?void 0:r.PROD_REQUEST_DATE)):h.fire("Thông báo","Chọn ít nhất 1 chỉ thị để đăng ký xuất liệu","error"))})},Sl=()=>{h.fire({title:"Chắc chắn muốn xóa Liệu đã chọn ?",text:"Sẽ bắt đầu xóa Liệu đã chọn",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Vẫn Xóa!"}).then(t=>{t.isConfirmed&&(h.fire("Tiến hành Xóa Liệu","Đang xóa Liệu","success"),Nl())})},Tl=async()=>{if(De.length>0){let t=[...Z];for(let a=0;a<De.length;a++)for(let s=0;s<t.length;s++)De[a].id===t[s].id&&await x("checkPLANID_O302",{PLAN_ID:De[a].PLAN_ID}).then(o=>{o.data.tk_status!=="NG"||(De[a].CHOTBC===null?x("deletePlanQLSX",{PLAN_ID:De[a].PLAN_ID}).then(P=>{P.data.tk_status!=="NG"?h.fire("Thông báo","Nội dung: "+P.data.message,"error"):(t.splice(s,1),de(t))}).catch(P=>{console.log(P)}):h.fire("Thông báo","Chỉ thị + "+De[a].PLAN_ID+":  +đã chốt báo cáo, ko xóa được chỉ thị","error"))}).catch(o=>{console.log(o)})}else h.fire("Thông báo","Chọn ít nhất một dòng để xóa","error")},Nl=()=>{if(Ie.length>0){let t=[...S];for(let a=0;a<Ie.length;a++)for(let s=0;s<t.length;s++)Ie[a].CHITHI_ID===t[s].CHITHI_ID&&t.splice(s,1);K(t)}else h.fire("Thông báo","Chọn ít nhất một dòng để xóa","error")},sl=async t=>{let a=t,s=1;return await x("getLastestPLAN_ID",{PROD_REQUEST_NO:t}).then(o=>{if(o.data.tk_status!=="NG"){let P=o.data.data[0].PLAN_ID;P.substring(7,8)==="Z"?P.substring(3,4)==="0"?a=P.substring(0,3)+"A"+P.substring(4,7)+"A":a=P.substring(0,3)+Be[Be.indexOf(P.substring(3,4))+1]+P.substring(4,7)+"A":a=P.substring(0,7)+Be[Be.indexOf(P.substring(7,8))+1]}else a=t+"A"}).catch(o=>{console.log(o)}),await x("getLastestPLANORDER",{PLAN_DATE:je,PLAN_EQ:Me,PLAN_FACTORY:$e}).then(o=>{o.data.tk_status!=="NG"?s=o.data.data[0].PLAN_ORDER+1:s=1}).catch(o=>{console.log(o)}),{NEXT_PLAN_ID:a,NEXT_PLAN_ORDER:s}},El=async()=>{if(se.length>=1)for(let t=0;t<se.length;t++){let a=!1;await x("checkProd_request_no_Exist_O302",{PROD_REQUEST_NO:se[t].PROD_REQUEST_NO}).then(E=>{E.data.tk_status!=="NG"&&(E.data.data.length>0?a=!0:a=!1)}).catch(E=>{console.log(E)});let s=await sl(se[t].PROD_REQUEST_NO),o=s.NEXT_PLAN_ID,P=s.NEXT_PLAN_ORDER;a===!1?await x("addPlanQLSX",{PLAN_ID:o,PLAN_DATE:je,PROD_REQUEST_NO:se[t].PROD_REQUEST_NO,PLAN_QTY:0,PLAN_EQ:Me,PLAN_FACTORY:$e,PLAN_LEADTIME:0,STEP:0,PLAN_ORDER:P,PROCESS_NUMBER:Me.substring(0,2)===se[t].EQ1?1:Me.substring(0,2)===se[t].EQ2?2:0,G_CODE:se[t].G_CODE,NEXT_PLAN_ID:"X"}).then(E=>{console.log(E.data.tk_status),E.data.tk_status!=="NG"&&Qe(je)}).catch(E=>{console.log(E)}):h.fire("Thông báo","Yêu cầu sản xuất này đã chạy từ hệ thống cũ, không chạy được lẫn lộn cũ mới, hãy chạy hết bằng hệ thống cũ với yc này","error")}else h.fire("Thông báo","Chọn ít nhất 1 YCSX để Add !","error")},ul=async()=>{h.fire({title:"Lưu Plan",text:"Đang lưu plan, hãy chờ một chút",icon:"info",showCancelButton:!1,allowOutsideClick:!1,confirmButtonText:"OK",showConfirmButton:!1});let t=Z.filter((s,o)=>s.PLAN_EQ===Me&&s.PLAN_FACTORY===$e),a="0";for(let s=0;s<t.length;s++){let o=!0;t[s].NEXT_PLAN_ID!=="X"&&(t[s].NEXT_PLAN_ID===t[s+1].PLAN_ID?o=!0:o=!1);let P=!1;await x("checkP500PlanID_mobile",{PLAN_ID:t[s].PLAN_ID}).then(E=>{E.data.tk_status!=="NG"?P=!0:P=!1}).catch(E=>{console.log(E)}),(parseInt(t[s].PROCESS_NUMBER.toString())===1||parseInt(t[s].PROCESS_NUMBER.toString())===2)&&t[s].PLAN_QTY!==0&&t[s].PLAN_QTY<=t[s].PROD_REQUEST_QTY&&t[s].PLAN_ID!==t[s].NEXT_PLAN_ID&&t[s].CHOTBC!=="V"&&o&&parseInt(t[s].STEP.toString())>=0&&parseInt(t[s].STEP.toString())<=9&&parseInt(t[s].PROCESS_NUMBER.toString())>=1&&parseInt(t[s].PROCESS_NUMBER.toString())<=2&&P===!1?await x("updatePlanQLSX",{PLAN_ID:t[s].PLAN_ID,STEP:t[s].STEP,PLAN_QTY:t[s].PLAN_QTY,OLD_PLAN_QTY:t[s].PLAN_QTY,PLAN_LEADTIME:t[s].PLAN_LEADTIME,PLAN_EQ:t[s].PLAN_EQ,PLAN_ORDER:t[s].PLAN_ORDER,PROCESS_NUMBER:t[s].PROCESS_NUMBER,KETQUASX:t[s].KETQUASX===null?0:t[s].KETQUASX,NEXT_PLAN_ID:t[s].NEXT_PLAN_ID===null?"X":t[s].NEXT_PLAN_ID}).then(E=>{E.data.tk_status!=="NG"||(a+="_"+E.data.message)}).catch(E=>{console.log(E)}):(a+="_"+t[s].G_NAME_KD+":",parseInt(t[s].PROCESS_NUMBER.toString())===1||parseInt(t[s].PROCESS_NUMBER.toString())===2?t[s].PLAN_QTY===0?a+="_: Số lượng chỉ thị =0":t[s].PLAN_QTY>t[s].PROD_REQUEST_QTY?a+="_: Số lượng chỉ thị lớn hơn số lượng yêu cầu sx":t[s].PLAN_ID===t[s].NEXT_PLAN_ID?a+="_: NEXT_PLAN_ID không được giống PLAN_ID hiện tại":o?t[s].CHOTBC==="V"?a+="_: Chỉ thị đã chốt báo cáo, sẽ ko sửa được, thông tin các chỉ thị khác trong máy được lưu thành công":parseInt(t[s].STEP.toString())>=0&&parseInt(t[s].STEP.toString())<=9?parseInt(t[s].PROCESS_NUMBER.toString())>=1&&parseInt(t[s].PROCESS_NUMBER.toString())<=2?P&&(a+="_: Đã bắn liệu vào sản xuất, không sửa chỉ thị được"):a+="_: Hãy nhập PROCESS NUMBER từ 1 hoặc 2":a+="_: Hãy nhập STEP từ 0 -> 9":a+="_: NEXT_PLAN_ID không giống với PLAN_ID ở dòng tiếp theo":a+="_: Process number chưa đúng")}a!=="0"?h.fire("Thông báo","Có lỗi !"+a,"error"):(h.fire("Thông báo","Lưu PLAN thành công","success"),Qe(je))},xl=async()=>{let t="0",a=0,s=0,o=1,P=0;for(let E=0;E<S.length;E++)a+=S[E].LIEUQL_SX,S[E].LIEUQL_SX>1&&(P+=1);for(let E=0;E<S.length;E++)if(parseInt(S[E].LIEUQL_SX.toString())===1)for(let G=0;G<S.length;G++)S[G].M_NAME===S[E].M_NAME&&parseInt(S[G].LIEUQL_SX.toString())===0&&(s+=1);for(let E=0;E<S.length;E++)if(parseInt(S[E].LIEUQL_SX.toString())===1)for(let G=0;G<S.length;G++)parseInt(S[G].LIEUQL_SX.toString())===1&&S[E].M_NAME!==S[G].M_NAME&&(o=2);if(a>0&&s===0&&o===1&&P===0){await x("deleteMCODEExistIN_O302",{PLAN_ID:r==null?void 0:r.PLAN_ID}).then(E=>{E.data.tk_status}).catch(E=>{console.log(E)});for(let E=0;E<S.length;E++)if(await x("updateLIEUQL_SX_M140",{G_CODE:r==null?void 0:r.G_CODE,M_CODE:S[E].M_CODE,LIEUQL_SX:S[E].LIEUQL_SX>=1?1:0}).then(G=>{G.data.tk_status}).catch(G=>{console.log(G)}),S[E].M_MET_QTY>0){let G=!1;await x("checkM_CODE_PLAN_ID_Exist",{PLAN_ID:r==null?void 0:r.PLAN_ID,M_CODE:S[E].M_CODE}).then(v=>{v.data.tk_status!=="NG"&&(G=!0)}).catch(v=>{console.log(v)}),G?await x("updateChiThi",{PLAN_ID:r==null?void 0:r.PLAN_ID,M_CODE:S[E].M_CODE,M_ROLL_QTY:S[E].M_ROLL_QTY,M_MET_QTY:S[E].M_MET_QTY,M_QTY:S[E].M_QTY,LIEUQL_SX:S[E].LIEUQL_SX>=1?1:0}).then(v=>{v.data.tk_status!=="NG"||(t+="_"+v.data.message)}).catch(v=>{console.log(v)}):await x("insertChiThi",{PLAN_ID:r==null?void 0:r.PLAN_ID,M_CODE:S[E].M_CODE,M_ROLL_QTY:S[E].M_ROLL_QTY,M_MET_QTY:S[E].M_MET_QTY,M_QTY:S[E].M_QTY,LIEUQL_SX:S[E].LIEUQL_SX}).then(v=>{v.data.tk_status!=="NG"||(t+="_"+v.data.message)}).catch(v=>{console.log(v)})}else t+="_"+S[E].M_CODE+": so met = 0";t!=="0"?h.fire("Thông báo","Có lỗi !"+t,"error"):(h.fire("Thông báo","Lưu Chỉ thị thành công","success"),Qe(je))}else h.fire("Thông báo","Phải chỉ định liệu quản lý, k để sót size nào, và chỉ chọn 1 loại liệu làm liệu chính, và nhập liệu quản lý chỉ 1 hoặc 0","error");Pe((r==null?void 0:r.PLAN_ID)===void 0?"xxx":r==null?void 0:r.PLAN_ID,(r==null?void 0:r.G_CODE)===void 0?"xxx":r==null?void 0:r.G_CODE,(r==null?void 0:r.PLAN_QTY)===void 0?0:r==null?void 0:r.PLAN_QTY,(r==null?void 0:r.PROCESS_NUMBER)===void 0?1:r==null?void 0:r.PROCESS_NUMBER)};function Cl(){return e.jsxs(Xe,{children:[e.jsxs(b,{className:"buttonIcon",onClick:()=>{Ue(st,"YCSX Table")},children:[e.jsx(ye,{color:"green",size:25}),"SAVE"]}),e.jsx(Ge,{}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{il()},children:[e.jsx(Ql,{color:"green",size:25}),"SET CLOSED"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{cl()},children:[e.jsx(Yl,{color:"red",size:25}),"SET PENDING"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{se.length>0?(k({...T,tabycsx:se.length>0}),console.log(se),qe(Xt(se))):h.fire("Thông báo","Chọn ít nhất 1 YCSX để in","error")},children:[e.jsx(Je,{color:"#0066ff",size:25}),"Print YCSX"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{se.length>0?(k({...T,tabbanve:se.length>0}),qe(tl(se))):h.fire("Thông báo","Chọn ít nhất 1 YCSX để in","error")},children:[e.jsx(Je,{color:"#ff751a",size:25}),"Print Bản Vẽ"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{se.length>0?El():h.fire("Thông báo","Chọn ít nhất 1 YCSX để thêm PLAN","error")},children:[e.jsx($t,{color:"#69f542",size:25}),"Add to PLAN"]})]})}function Dl(){return e.jsxs(Xe,{children:[e.jsxs(b,{className:"buttonIcon",onClick:()=>{Ue(Z,"Plan Table")},children:[e.jsx(ye,{color:"green",size:25}),"SAVE"]}),e.jsx(Ge,{}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{De.length>0?(Tt(!0),bt(zt(De))):(Tt(!1),h.fire("Thông báo","Chọn ít nhất 1 Plan để in","error"))},children:[e.jsx(Je,{color:"#0066ff",size:25}),"Print Chỉ Thị"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{C!==void 0&&C.length>0?C[0].FACTORY===null||C[0].EQ1===null||C[0].EQ2===null||C[0].Setting1===null||C[0].Setting2===null||C[0].UPH1===null||C[0].UPH2===null||C[0].Step1===null||C[0].Step1===null||C[0].LOSS_SX1===null||C[0].LOSS_SX2===null||C[0].LOSS_SETTING1===null||C[0].LOSS_SETTING2===null?h.fire("Thông báo","Nhập data định mức trước khi chỉ thị","error"):C.filter((a,s)=>a.STEP===0).length>0?(Ye(!0),fe(nt(C))):h.fire("Thông báo","Chưa có chỉ thị chính (B0)","error"):(Ye(!1),h.fire("Thông báo","Chọn ít nhất 1 Plan để in","error"))},children:[e.jsx(Je,{color:"#0066ff",size:25}),"Print Chỉ Thị Combo"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{De.length>0?(pe(!0),yt(Vt(De))):(pe(!1),h.fire("Thông báo","Chọn ít nhất 1 Plan để in","error"))},children:[e.jsx(Je,{color:"#9066ff",size:25}),"Print YCKT"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{xe(g==null?void 0:g.EMPL_NO,g==null?void 0:g.MAINDEPTNAME,["QLSX"],ul)},children:[e.jsx(Dt,{color:"blue",size:20}),"Lưu PLAN"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{xe(g==null?void 0:g.EMPL_NO,g==null?void 0:g.MAINDEPTNAME,["QLSX"],dl)},children:[e.jsx(Jt,{color:"yellow",size:20}),"Xóa PLAN"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{Qe(je)},children:[e.jsx(Ct,{color:"yellow",size:20}),"Refresh PLAN"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{xe(g==null?void 0:g.EMPL_NO,g==null?void 0:g.MAINDEPTNAME,["QLSX"],el)},children:[e.jsx(Dt,{color:"lightgreen",size:20}),"Lưu Data Định Mức"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{V(Wl(De[0]))},children:[e.jsx($t,{color:"#69f542",size:20}),"Add to Print Combo"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{V(Il(""))},children:[e.jsx(Ct,{color:"red",size:20}),"Reset Print Combo"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{let t="";if(C!==void 0){for(let a=0;a<(C==null?void 0:C.length);a++)t+=a+1+"_PLAN_ID: "+C[a].PLAN_ID+"_CODE: "+C[a].G_NAME_KD+"_STEP: "+C[a].STEP+"*******";h.fire("Thong bao",t,"info")}else h.fire("Thong bao","Chưa có chỉ thị trong combo","info")},children:[e.jsx(Ct,{color:"red",size:20}),"Show Combo"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{Ve(!wt)},children:[e.jsx(Ct,{color:"red",size:20}),"Show/Hide YCSX"]})]})}function Ol(){return e.jsxs(Xe,{children:[e.jsxs(b,{className:"buttonIcon",onClick:()=>{Ue(st,"YCSX Table")},children:[e.jsx(ye,{color:"green",size:25}),"SAVE"]}),e.jsx(Ge,{}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{xe(g==null?void 0:g.EMPL_NO,g==null?void 0:g.MAINDEPTNAME,["QLSX"],_l)},children:[e.jsx(Gl,{color:"green",size:20}),"Lưu CT + ĐKXK"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{xe(g==null?void 0:g.EMPL_NO,g==null?void 0:g.MAINDEPTNAME,["QLSX"],Sl)},children:[e.jsx(Jt,{color:"yellow",size:20}),"Xóa Liệu"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{xe(g==null?void 0:g.EMPL_NO,g==null?void 0:g.MAINDEPTNAME,["QLSX"],hl)},children:[e.jsx(kl,{color:"red",size:20}),"RESET Liệu"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{r!==void 0?xe(g==null?void 0:g.EMPL_NO,g==null?void 0:g.MAINDEPTNAME,["QLSX"],()=>{L(!A),Zt(),ol(),Wt(),ut((r==null?void 0:r.PLAN_ID)===void 0?"xxx":r==null?void 0:r.PLAN_ID)}):h.fire("Thông báo","Hãy chọn một chỉ thị","error")},children:[e.jsx(Hl,{color:"blue",size:20}),"KHO ẢO"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{Pe((r==null?void 0:r.PLAN_ID)===void 0?"xxx":r==null?void 0:r.PLAN_ID,(r==null?void 0:r.G_CODE)===void 0?"xxx":r==null?void 0:r.G_CODE,(r==null?void 0:r.PLAN_QTY)===void 0?0:r==null?void 0:r.PLAN_QTY,(r==null?void 0:r.PROCESS_NUMBER)===void 0?0:r==null?void 0:r.PROCESS_NUMBER)},children:[e.jsx(Ct,{color:"yellow",size:20}),"Refresh chỉ thị"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{xe(g==null?void 0:g.EMPL_NO,g==null?void 0:g.MAINDEPTNAME,["QLSX"],Ll)},children:[e.jsx(en,{color:"red",size:20}),"Xuất dao sample"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{xe(g==null?void 0:g.EMPL_NO,g==null?void 0:g.MAINDEPTNAME,["QLSX"],fl)},children:[e.jsx(Vl,{color:"blue",size:20}),"Xuất liệu sample"]}),e.jsx("span",{style:{fontSize:20,fontWeight:"bold",color:"red"},children:r==null?void 0:r.PLAN_ID})," ","___",e.jsx("span",{style:{fontSize:20,fontWeight:"bold",color:"blue"},children:r==null?void 0:r.G_NAME}),e.jsxs("span",{style:{fontSize:20,fontWeight:"bold",color:"green"},children:["___PD:",f]}),e.jsxs("span",{style:{fontSize:20,fontWeight:"bold",color:"green"},children:["___CAVITY:",p]}),e.jsxs("span",{style:{fontSize:20,fontWeight:"bold",color:"green"},children:["___PLAN_QTY:",r==null?void 0:r.PLAN_QTY.toLocaleString("en-US")]}),"Có setting hay không?",e.jsx("input",{type:"checkbox",name:"alltimecheckbox",defaultChecked:ae,onChange:()=>Y(!ae)})]})}const fl=async()=>{if(r!==void 0){let t=(r==null?void 0:r.PROD_REQUEST_NO)===void 0?"xxx":r==null?void 0:r.PROD_REQUEST_NO,a=!1,s=!1;await x("getP4002",{PROD_REQUEST_NO:t}).then(o=>{o.data.tk_status!=="NG"&&o.data.data.map((E,G)=>({...E,id:G}))[0].CODE_55==="04"?a=!0:a=!1}).catch(o=>{console.log(o)}),await x("check_PLAN_ID_KHO_AO",{PLAN_ID:r==null?void 0:r.PLAN_ID}).then(o=>{o.data.tk_status!=="NG"&&(console.log(o.data.data),o.data.data.length>0?s=!0:s=!1)}).catch(o=>{console.log(o)}),a?s===!1?(await x("nhapkhoao",{FACTORY:$e,PHANLOAI:"N",PLAN_ID_INPUT:r==null?void 0:r.PLAN_ID,PLAN_ID_SUDUNG:r==null?void 0:r.PLAN_ID,M_CODE:"A0009680",M_LOT_NO:"2201010001",ROLL_QTY:1,IN_QTY:1,TOTAL_IN_QTY:1,USE_YN:"O"}).then(o=>{console.log(o.data.tk_status),o.data.tk_status}).catch(o=>{console.log(o)}),await x("xuatkhoao",{FACTORY:$e,PHANLOAI:"N",PLAN_ID_INPUT:r==null?void 0:r.PLAN_ID,PLAN_ID_OUTPUT:r==null?void 0:r.PLAN_ID,M_CODE:"A0009680",M_LOT_NO:"2201010001",ROLL_QTY:1,OUT_QTY:1,TOTAL_OUT_QTY:1,USE_YN:"O"}).then(o=>{console.log(o.data.tk_status),o.data.tk_status!=="NG"&&Gt((r==null?void 0:r.PLAN_ID)===void 0?"xxx":r==null?void 0:r.PLAN_ID)}).catch(o=>{console.log(o)}),h.fire("Thông báo","Đã xuất liệu ảo thành công","info")):(Gt((r==null?void 0:r.PLAN_ID)===void 0?"xxx":r==null?void 0:r.PLAN_ID),h.fire("Thông báo","Đã xuất liệu chính rồi","info")):h.fire("Thông báo","Đây không phải ycsx sample","info")}else h.fire("Thông báo","Hãy chọn ít nhất 1 chỉ thị","error")},Ll=async()=>{if(r!==void 0){let t=(r==null?void 0:r.PROD_REQUEST_NO)===void 0?"xxx":r==null?void 0:r.PROD_REQUEST_NO,a=!1,s=!1;await x("getP4002",{PROD_REQUEST_NO:t}).then(o=>{o.data.tk_status!=="NG"&&o.data.data.map((E,G)=>({...E,id:G}))[0].CODE_55==="04"?a=!0:a=!1}).catch(o=>{console.log(o)}),console.log(a),await x("check_PLAN_ID_OUT_KNIFE_FILM",{PLAN_ID:r==null?void 0:r.PLAN_ID}).then(o=>{o.data.tk_status!=="NG"&&(o.data.data.length>0?s=!0:s=!1)}).catch(o=>{console.log(o)}),a?s===!1?(await x("insert_OUT_KNIFE_FILM",{PLAN_ID:r==null?void 0:r.PLAN_ID,EQ_THUC_TE:r==null?void 0:r.PLAN_EQ,CA_LAM_VIEC:"Day",EMPL_NO:g==null?void 0:g.EMPL_NO,KNIFE_FILM_NO:"1K22LH20"}).then(o=>{o.data.tk_status!=="NG"&&Pl((r==null?void 0:r.PLAN_ID)===void 0?"xxx":r==null?void 0:r.PLAN_ID)}).catch(o=>{console.log(o)}),h.fire("Thông báo","Đã xuất dao ảo thành công","success")):h.fire("Thông báo","Đã xuất dao rồi","info"):h.fire("Thông báo","Đây không phải ycsx sample","info")}else h.fire("Thông báo","Hãy chọn ít nhất 1 chỉ thị","error")},gl=t=>{const a=new Set(t);let s=st.filter(o=>a.has(o.PROD_REQUEST_NO));s.length>0?ue(s):(ue([]),console.log("xoa filter"))},Al=t=>{const a=new Set(t);let s=Z.filter(o=>a.has(o.PLAN_ID));s.length>0?W(s):W([])},rl=t=>{const a=new Set(t);let s=S.filter(o=>a.has(o.CHITHI_ID));s.length>0?R(s):R([])},qt=(t,a)=>String(t).padStart(a,"0"),jl=t=>{x("updateDKXLPLAN",{PLAN_ID:t}).then(a=>{console.log(a.data),a.data.tk_status}).catch(a=>{console.log(a)})},Gt=t=>{x("updateXUATLIEUCHINH_PLAN",{PLAN_ID:t}).then(a=>{console.log(a.data),a.data.tk_status}).catch(a=>{console.log(a)})},Pl=t=>{x("update_XUAT_DAO_FILM_PLAN",{PLAN_ID:t}).then(a=>{console.log(a.data),a.data.tk_status}).catch(a=>{console.log(a)})},bl=async(t,a,s)=>{let o=!0,P="001",E=q().format("YYYYMMDD");await x("checkPLANID_O300",{PLAN_ID:t}).then(m=>{console.log(m.data),m.data.tk_status!=="NG"?(o=!0,E=m.data.data[0].OUT_DATE):o=!1}).catch(m=>{console.log(m)});let G=0;if(await x("checkPLANID_O301",{PLAN_ID:t}).then(m=>{m.data.tk_status!=="NG"&&(G=parseInt(m.data.data[0].OUT_SEQ))}).catch(m=>{console.log(m)}),console.log("check plan id o300",o),o)await x("getO300_ROW",{PLAN_ID:t}).then(m=>{m.data.tk_status!=="NG"&&(P=qt(parseInt(m.data.data[0].OUT_NO),3),console.log("nextoutno_o300",P))}).catch(m=>{console.log(m)});else{await x("getO300_LAST_OUT_NO",{}).then(U=>{U.data.tk_status!=="NG"&&(P=qt(parseInt(U.data.data[0].OUT_NO)+1,3),console.log("nextoutno_o300",P))}).catch(U=>{console.log(U)});let m="";await x("getP400",{PROD_REQUEST_NO:a,PROD_REQUEST_DATE:s}).then(U=>{U.data.tk_status!=="NG"&&(m=U.data.data[0].CODE_50)}).catch(U=>{console.log(U)}),console.log(m),await x("insertO300",{OUT_DATE:E,OUT_NO:P,CODE_03:"01",CODE_52:"01",CODE_50:m,USE_YN:"Y",PROD_REQUEST_DATE:s,PROD_REQUEST_NO:a,FACTORY:$e,PLAN_ID:t}).then(U=>{U.data.tk_status}).catch(U=>{console.log(U)})}let v=0;for(let m=0;m<S.length;m++)v+=S[m].M_MET_QTY;if(v>0){for(let m=0;m<S.length;m++)if(S[m].M_MET_QTY>0){console.log("M_MET",S[m].M_MET_QTY);let U=!1;await x("checkM_CODE_PLAN_ID_Exist_in_O301",{PLAN_ID:t,M_CODE:S[m].M_CODE}).then(B=>{console.log(B.data),B.data.tk_status!=="NG"?U=!0:U=!1}).catch(B=>{console.log(B)}),S[m].LIEUQL_SX===1&&jl(S[m].PLAN_ID),U?await x("updateO301",{M_CODE:S[m].M_CODE,OUT_PRE_QTY:S[m].M_MET_QTY*S[m].M_QTY,PLAN_ID:t}).then(B=>{console.log(B.data),B.data.tk_status}).catch(B=>{console.log(B)}):(console.log("Next Out NO",P),await x("checkPLANID_O301",{PLAN_ID:t}).then(B=>{B.data.tk_status!=="NG"&&(G=parseInt(B.data.data[0].OUT_SEQ))}).catch(B=>{console.log(B)}),console.log("outseq",G),await x("insertO301",{OUT_DATE:E,OUT_NO:P,CODE_03:"01",OUT_SEQ:qt(G+m+1,3),USE_YN:"Y",M_CODE:S[m].M_CODE,OUT_PRE_QTY:S[m].M_MET_QTY*S[m].M_QTY,PLAN_ID:t}).then(B=>{B.data.tk_status}).catch(B=>{console.log(B)}))}Qe(je)}else h.fire("Thông báo","Cần đăng ký ít nhất 1 met lòng")},l=(t,a,s)=>{let o=t.row;ot(o),ne({...I,FACTORY:o.FACTORY===null?"NA":o.FACTORY,EQ1:o.EQ1===""?"NA":o.EQ1,EQ2:o.EQ2===""?"NA":o.EQ2,Setting1:o.Setting1===null?0:o.Setting1,Setting2:o.Setting2===null?0:o.Setting2,UPH1:o.UPH1===null?0:o.UPH1,UPH2:o.UPH2===null?0:o.UPH2,Step1:o.Step1===null?0:o.Step1,Step2:o.Step2===null?0:o.Step2,LOSS_SX1:o.LOSS_SX1===null?0:o.LOSS_SX1,LOSS_SX2:o.LOSS_SX2===null?0:o.LOSS_SX2,LOSS_SETTING1:o.LOSS_SETTING1===null?0:o.LOSS_SETTING1,LOSS_SETTING2:o.LOSS_SETTING2===null?0:o.LOSS_SETTING2,NOTE:o.NOTE===null?"":o.NOTE}),Pe(o.PLAN_ID,o.G_CODE,o.PLAN_QTY,o.PROCESS_NUMBER)};let c="",i=["F1","F2","F3","F4","S1","S2","S3","S4","S5","S6","S7","S8","D1","D2","D3","D4","D5","E1","E2","E3","E4","E5","E6","E7","E8","E9","E10","E11","E12","E13","E14","E15","E16","E17","E18","E19","E20","E21","E22","E23","E24","E25","E26","E27","E28","E29","E30","E31","E32","E33","E34","E35","E36","E37","E38"],O=["FR01","FR02","FR03","FR04","SR01","SR02","SR03","SR04","SR05","SR06","SR07","SR08","DC01","DC02","DC03","DC04","DC05","ED01","ED02","ED03","ED04","ED05","ED06","ED07","ED08","ED09","ED10","ED11","ED12","ED13","ED14","ED15","ED16","ED17","ED18","ED19","ED20","ED21","ED22","ED23","ED24","ED25","ED26","ED27","ED28","ED29","ED30","ED31","ED32","ED33","ED34","ED35","ED36","ED37","ED38"];const D=t=>{t.key!=="Enter"&&(c+=t.key),t.key==="F2"?(Qe(je),V(Il(""))):t.key==="Enter"&&ee===!1?(i.indexOf(c.toUpperCase())<0?alert("Không có máy này: "+c.toUpperCase()):(X(!0),Ae(T.tab1===!0?"NM1":"NM2"),Re(O[i.indexOf(c.toUpperCase())]),K([])),c=""):t.key==="["?ce(1):t.key==="]"?ce(2):t.key==="Escape"&&(X(!1),ot(void 0))};return d.useEffect(()=>{re(),Qe(je),be();let t=window.setInterval(()=>{be()},3e3);return()=>{window.clearInterval(t)}},[]),e.jsxs("div",{className:"machineplan",tabIndex:0,onKeyDown:D,children:[e.jsxs("div",{className:"mininavbar",children:[e.jsx("div",{className:"mininavitem",onClick:()=>ce(1),children:e.jsx("span",{className:"mininavtext",children:"NM1"})}),e.jsx("div",{className:"mininavitem",onClick:()=>ce(2),children:e.jsx("span",{className:"mininavtext",children:"NM2"})})]}),e.jsxs("div",{className:"plandateselect",children:[e.jsx("label",{children:"Plan Date"}),e.jsx("input",{className:"inputdata",type:"date",value:je,onChange:t=>{vt(t.target.value.toString()),console.log(t.target.value),Qe(t.target.value)}}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{Qe(je),V(Il(""))},children:[e.jsx(Ct,{color:"blue",size:20}),"Refresh PLAN"]})]}),T.tab1&&e.jsxs("div",{className:"NM1",children:[e.jsx("span",{className:"machine_title",children:"FR-NM1"}),e.jsx("div",{className:"FRlist",children:Ne.filter((t,a)=>t.FACTORY==="NM1"&&t.EQ_NAME.substring(0,2)==="FR").map((t,a)=>e.jsx(Ht,{factory:t.FACTORY,machine_name:t.EQ_NAME,eq_status:t.EQ_STATUS,current_g_name:t.G_NAME,current_plan_id:t.CURR_PLAN_ID,run_stop:t.EQ_ACTIVE==="OK"?1:0,machine_data:Z,onClick:()=>{X(!0),Ae(t.FACTORY),Re(t.EQ_NAME),ot(void 0),K([])}},a))}),e.jsx("span",{className:"machine_title",children:"SR-NM1"}),e.jsx("div",{className:"SRlist",children:Ne.filter((t,a)=>t.FACTORY==="NM1"&&t.EQ_NAME.substring(0,2)==="SR").map((t,a)=>e.jsx(Ht,{factory:t.FACTORY,eq_status:t.EQ_STATUS,current_g_name:t.G_NAME,current_plan_id:t.CURR_PLAN_ID,machine_name:t.EQ_NAME,run_stop:t.EQ_ACTIVE==="OK"?1:0,machine_data:Z,onClick:()=>{X(!0),Ae(t.FACTORY),Re(t.EQ_NAME),K([])}},a))}),e.jsx("span",{className:"machine_title",children:"DC-NM1"}),e.jsx("div",{className:"DClist",children:Ne.filter((t,a)=>t.FACTORY==="NM1"&&t.EQ_NAME.substring(0,2)==="DC").map((t,a)=>e.jsx(Ht,{factory:t.FACTORY,machine_name:t.EQ_NAME,eq_status:t.EQ_STATUS,current_g_name:t.G_NAME,current_plan_id:t.CURR_PLAN_ID,run_stop:t.EQ_ACTIVE==="OK"?1:0,machine_data:Z,onClick:()=>{X(!0),Ae(t.FACTORY),Re(t.EQ_NAME),K([])}},a))}),e.jsx("span",{className:"machine_title",children:"ED-NM1"}),e.jsx("div",{className:"EDlist",children:Ne.filter((t,a)=>t.FACTORY==="NM1"&&t.EQ_NAME.substring(0,2)==="ED").map((t,a)=>e.jsx(Ht,{factory:t.FACTORY,machine_name:t.EQ_NAME,eq_status:t.EQ_STATUS,current_g_name:t.G_NAME,current_plan_id:t.CURR_PLAN_ID,run_stop:t.EQ_ACTIVE==="OK"?1:0,machine_data:Z,onClick:()=>{X(!0),Ae(t.FACTORY),Re(t.EQ_NAME),K([])}},a))})]}),T.tab2&&e.jsxs("div",{className:"NM2",children:[e.jsx("span",{className:"machine_title",children:"FR-NM2"}),e.jsx("div",{className:"FRlist",children:Ne.filter((t,a)=>t.FACTORY==="NM2"&&t.EQ_NAME.substring(0,2)==="FR").map((t,a)=>e.jsx(Ht,{factory:t.FACTORY,machine_name:t.EQ_NAME,eq_status:t.EQ_STATUS,current_g_name:t.G_NAME,current_plan_id:t.CURR_PLAN_ID,run_stop:t.EQ_ACTIVE==="OK"?1:0,machine_data:Z,onClick:()=>{X(!0),Ae(t.FACTORY),Re(t.EQ_NAME),K([])}},a))}),e.jsx("span",{className:"machine_title",children:"ED-NM2"}),e.jsx("div",{className:"EDlist",children:Ne.filter((t,a)=>t.FACTORY==="NM2"&&t.EQ_NAME.substring(0,2)==="ED").map((t,a)=>e.jsx(Ht,{factory:t.FACTORY,machine_name:t.EQ_NAME,eq_status:t.EQ_STATUS,current_g_name:t.G_NAME,current_plan_id:t.CURR_PLAN_ID,run_stop:t.EQ_ACTIVE==="OK"?1:0,machine_data:Z,onClick:()=>{X(!0),Ae(t.FACTORY),Re(t.EQ_NAME),K([])}},a))})]}),T.tab3&&e.jsx("div",{className:"allinone",children:"ALL IN ONE"}),ee&&e.jsxs("div",{className:"planwindow",children:[e.jsxs("div",{className:"title",children:[Me,": ",$e,e.jsx(_e,{onClick:()=>{X(!1),ot(void 0)},children:"Close"}),"Plan hiện tại trên máy ",Me]}),e.jsxs("div",{className:"content",children:[wt&&e.jsx("div",{className:"ycsxlist",children:e.jsxs("div",{className:"tracuuYCSX",children:[e.jsxs("div",{className:"tracuuYCSXform",children:[e.jsxs("div",{className:"forminput",children:[e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"Từ ngày:"}),e.jsx("input",{onKeyDown:t=>{we(t)},type:"date",value:M.slice(0,10),onChange:t=>y(t.target.value)})]}),e.jsxs("label",{children:[e.jsx("b",{children:"Tới ngày:"})," ",e.jsx("input",{onKeyDown:t=>{we(t)},type:"date",value:He.slice(0,10),onChange:t=>H(t.target.value)})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"Code KD:"})," ",e.jsx("input",{onKeyDown:t=>{we(t)},type:"text",placeholder:"GH63-xxxxxx",value:Ze,onChange:t=>Fe(t.target.value)})]}),e.jsxs("label",{children:[e.jsx("b",{children:"Code CMS:"})," ",e.jsx("input",{onKeyDown:t=>{we(t)},type:"text",placeholder:"7C123xxx",value:at,onChange:t=>We(t.target.value)})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"Tên nhân viên:"})," ",e.jsx("input",{onKeyDown:t=>{we(t)},type:"text",placeholder:"Trang",value:it,onChange:t=>et(t.target.value)})]}),e.jsxs("label",{children:[e.jsx("b",{children:"Khách:"})," ",e.jsx("input",{onKeyDown:t=>{we(t)},type:"text",placeholder:"SEVT",value:Ke,onChange:t=>Q(t.target.value)})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"Loại sản phẩm:"})," ",e.jsx("input",{onKeyDown:t=>{we(t)},type:"text",placeholder:"TSP",value:te,onChange:t=>Rt(t.target.value)})]}),e.jsxs("label",{children:[e.jsx("b",{children:"Số YCSX:"})," ",e.jsx("input",{onKeyDown:t=>{we(t)},type:"text",placeholder:"12345",value:Yt,onChange:t=>pt(t.target.value)})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"Phân loại:"}),e.jsxs("select",{name:"phanloai",value:Qt,onChange:t=>{At(t.target.value)},children:[e.jsx("option",{value:"00",children:"ALL"}),e.jsx("option",{value:"01",children:"Thông thường"}),e.jsx("option",{value:"02",children:"SDI"}),e.jsx("option",{value:"03",children:"GC"}),e.jsx("option",{value:"04",children:"SAMPLE"}),e.jsx("option",{value:"22",children:"NOT SAMPLE"})]})]}),e.jsxs("label",{children:[e.jsx("b",{children:"Vật liệu:"})," ",e.jsx("input",{onKeyDown:t=>{we(t)},type:"text",placeholder:"SJ-203020HC",value:Kt,onChange:t=>jt(t.target.value)})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"YCSX Pending:"}),e.jsx("input",{onKeyDown:t=>{we(t)},type:"checkbox",name:"alltimecheckbox",defaultChecked:ze,onChange:()=>Se(!ze)})]}),e.jsxs("label",{children:[e.jsx("b",{children:"Vào kiểm:"}),e.jsx("input",{onKeyDown:t=>{we(t)},type:"checkbox",name:"alltimecheckbox",defaultChecked:tt,onChange:()=>Pt(!tt)})]})]})]}),e.jsxs("div",{className:"formbutton",children:[e.jsxs("label",{children:[e.jsx("b",{children:"All Time:"}),e.jsx("input",{type:"checkbox",name:"alltimecheckbox",defaultChecked:Lt,onChange:()=>gt(!Lt)})]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{nl()},children:[e.jsx(Ml,{color:"green",size:30}),"Search"]})]})]}),e.jsx("div",{className:"tracuuYCSXTable",children:e.jsx(ve,{sx:{fontSize:12,flex:1},components:{Toolbar:Cl,LoadingOverlay:me},loading:ie,rowHeight:30,rows:st,columns:Te,rowsPerPageOptions:[5,10,50,100,500,1e3,5e3,1e4,5e5],editMode:"row",getRowId:t=>t.PROD_REQUEST_NO,onSelectionModelChange:t=>{gl(t)}})})]})}),e.jsxs("div",{className:"chithidiv",children:[e.jsx("div",{className:"listchithi",children:e.jsx("div",{className:"planlist",children:e.jsx(ve,{sx:{fontSize:12,flex:1},components:{Toolbar:Dl,LoadingOverlay:me},loading:ie,rowHeight:30,rows:Z.filter((t,a)=>t.PLAN_EQ===Me&&t.PLAN_FACTORY===$e),columns:oe,rowsPerPageOptions:[5,10,50,100,500,1e3,5e3,1e4,5e5],editMode:"cell",getRowId:t=>t.PLAN_ID,checkboxSelection:!0,onSelectionModelChange:t=>{Al(t)},disableSelectionOnClick:!0,onCellEditCommit:(t,a,s)=>{const o=t.field,P=Z.map(E=>E.PLAN_ID===t.id?{...E,[o]:t.value}:E);de(P)},onRowClick:l})})}),e.jsxs("div",{className:"datadinhmuc",children:[e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"EQ1:"}),e.jsxs("select",{name:"phanloai",value:I.EQ1,onChange:t=>ne({...I,EQ1:t.target.value}),style:{width:150,height:22},children:[e.jsx("option",{value:"FR",children:"FR"}),e.jsx("option",{value:"SR",children:"SR"}),e.jsx("option",{value:"DC",children:"DC"}),e.jsx("option",{value:"ED",children:"ED"}),e.jsx("option",{value:"NO",children:"NO"}),e.jsx("option",{value:"NA",children:"NA"})]})]}),e.jsxs("label",{children:[e.jsx("b",{children:"EQ2:"}),e.jsxs("select",{name:"phanloai",value:I.EQ2,onChange:t=>ne({...I,EQ2:t.target.value}),style:{width:150,height:22},children:[e.jsx("option",{value:"FR",children:"FR"}),e.jsx("option",{value:"SR",children:"SR"}),e.jsx("option",{value:"DC",children:"DC"}),e.jsx("option",{value:"ED",children:"ED"}),e.jsx("option",{value:"NO",children:"NO"}),e.jsx("option",{value:"NA",children:"NA"})]})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"Setting1(min):"})," ",e.jsx("input",{type:"text",placeholder:"Thời gian setting 1",value:I.Setting1,onChange:t=>ne({...I,Setting1:Number(t.target.value)})})]}),e.jsxs("label",{children:[e.jsx("b",{children:"Setting2(min):"})," ",e.jsx("input",{type:"text",placeholder:"Thời gian setting 2",value:I.Setting2,onChange:t=>ne({...I,Setting2:Number(t.target.value)})})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"UPH1(EA/h):"})," ",e.jsx("input",{type:"text",placeholder:"Tốc độ sx 1",value:I.UPH1,onChange:t=>ne({...I,UPH1:Number(t.target.value)})})]}),e.jsxs("label",{children:[e.jsx("b",{children:"UPH2(EA/h):"})," ",e.jsx("input",{type:"text",placeholder:"Tốc độ sx 2",value:I.UPH2,onChange:t=>ne({...I,UPH2:Number(t.target.value)})})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"Step1:"})," ",e.jsx("input",{type:"text",placeholder:"Số bước 1",value:I.Step1,onChange:t=>ne({...I,Step1:Number(t.target.value)})})]}),e.jsxs("label",{children:[e.jsx("b",{children:"Step2:"})," ",e.jsx("input",{type:"text",placeholder:"Số bước 2",value:I.Step2,onChange:t=>ne({...I,Step2:Number(t.target.value)})})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"LOSS_SX1(%):"})," ",e.jsx("input",{type:"text",placeholder:"% loss sx 1",value:I.LOSS_SX1,onChange:t=>ne({...I,LOSS_SX1:Number(t.target.value)})})]}),e.jsxs("label",{children:[e.jsx("b",{children:"LOSS_SX2(%):"})," ",e.jsx("input",{type:"text",placeholder:"% loss sx 2",value:I.LOSS_SX2,onChange:t=>ne({...I,LOSS_SX2:Number(t.target.value)})})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"LOSS SETTING1 (m):"})," ",e.jsx("input",{type:"text",placeholder:"met setting 1",value:I.LOSS_SETTING1,onChange:t=>ne({...I,LOSS_SETTING1:Number(t.target.value)})})]}),e.jsxs("label",{children:[e.jsx("b",{children:"LOSS SETTING2 (m):"})," ",e.jsx("input",{type:"text",placeholder:"met setting 2",value:I.LOSS_SETTING2,onChange:t=>ne({...I,LOSS_SETTING2:Number(t.target.value)})})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"FACTORY:"}),e.jsxs("select",{name:"phanloai",value:I.FACTORY===null?"NA":I.FACTORY,onChange:t=>{ne({...I,FACTORY:t.target.value})},style:{width:162,height:22},children:[e.jsx("option",{value:"NA",children:"NA"}),e.jsx("option",{value:"NM1",children:"NM1"}),e.jsx("option",{value:"NM2",children:"NM2"})]})]}),e.jsxs("label",{children:[e.jsx("b",{children:"NOTE (QLSX):"})," ",e.jsx("input",{type:"text",placeholder:"Chú ý",value:I.NOTE,onChange:t=>ne({...I,NOTE:t.target.value})})]})]})]}),e.jsx("div",{className:"listlieuchithi",children:e.jsx("div",{className:"chithitable",children:e.jsx(ve,{sx:{fontSize:12,flex:1},components:{Toolbar:Ol,LoadingOverlay:me},getRowId:t=>t.CHITHI_ID,loading:ie,rowHeight:30,rows:S,columns:ct,rowsPerPageOptions:[5,10,50,100,500,1e3,5e3,1e4,5e5],editMode:"cell",checkboxSelection:!0,onSelectionModelChange:t=>{rl(t)},onCellEditCommit:(t,a,s)=>{const o=t.field,P=S.map(E=>E.CHITHI_ID===t.id?{...E,[o]:t.value}:E);K(P)}})})}),T.tabycsx&&e.jsxs("div",{className:"printycsxpage",children:[e.jsxs("div",{className:"buttongroup",children:[e.jsx(_e,{onClick:()=>{qe(Xt(se))},children:"Render YCSX"}),e.jsx(_e,{onClick:$,children:"Print YCSX"}),e.jsx(_e,{onClick:()=>{k({...T,tabycsx:!1})},children:"Close"})]}),e.jsx("div",{className:"ycsxrender",ref:u,children:mt})]}),T.tabbanve&&e.jsxs("div",{className:"printycsxpage",children:[e.jsxs("div",{className:"buttongroup",children:[e.jsx(_e,{onClick:()=>{qe(tl(se))},children:"Render Bản Vẽ"}),e.jsx(_e,{onClick:$,children:"Print Bản Vẽ"}),e.jsx(_e,{onClick:()=>{k({...T,tabbanve:!1})},children:"Close"})]}),e.jsx("div",{className:"ycsxrender",ref:u,children:mt})]}),A&&e.jsxs("div",{className:"khoaodiv",children:[e.jsx(_e,{onClick:()=>{L(!A)},children:"Close"}),e.jsx(Kl,{NEXT_PLAN:r==null?void 0:r.PLAN_ID})]}),!1,St&&e.jsxs("div",{className:"printycsxpage",children:[e.jsxs("div",{className:"buttongroup",children:[e.jsx("input",{type:"text",value:j,onChange:t=>{N(Number(t.target.value))}}),e.jsx("button",{onClick:()=>{localStorage.setItem("maxLieu",j.toString()),h.fire("Thông báo","Đã set lại max dòng","success")},children:"Set dòng"}),e.jsx("button",{onClick:()=>{bt(zt(De))},children:"Render Chỉ Thị"}),e.jsx("button",{onClick:$,children:"Print Chỉ Thị"}),e.jsx("button",{onClick:()=>{Tt(!St)},children:"Close"})]}),e.jsx("div",{className:"ycsxrender",ref:u,children:Ut})]}),Nt&&e.jsxs("div",{className:"printycsxpage",children:[e.jsxs("div",{className:"buttongroup",children:[e.jsx("input",{type:"text",value:j,onChange:t=>{N(Number(t.target.value))}}),e.jsx("button",{onClick:()=>{localStorage.setItem("maxLieu",j.toString()),h.fire("Thông báo","Đã set lại max dòng","success")},children:"Set dòng"}),e.jsx("button",{onClick:()=>{fe(nt(C))},children:"Render Chỉ Thị 2"}),e.jsx("button",{onClick:$,children:"Print Chỉ Thị"}),e.jsx("button",{onClick:()=>{Ye(!Nt)},children:"Close"})]}),e.jsx("div",{className:"ycsxrender",ref:u,children:rt})]}),Ft&&e.jsxs("div",{className:"printycsxpage",children:[e.jsxs("div",{className:"buttongroup",children:[e.jsx("button",{onClick:()=>{yt(Vt(De))},children:"Render YCKT"}),e.jsx("button",{onClick:$,children:"Print Chỉ Thị"}),e.jsx("button",{onClick:()=>{pe(!Ft)},children:"Close"})]}),e.jsx("div",{className:"ycsxrender",ref:u,children:It})]})]})]})]})]})};const rn=()=>{d.useState(0),d.useState(0);const[C,V]=d.useState({tab1:!0,tab2:!1,tab3:!1,tabycsx:!1,tabbanve:!1}),[f,w]=d.useState({FACTORY:"NA",EQ1:"NA",EQ2:"NA",Setting1:0,Setting2:0,UPH1:0,UPH2:0,Step1:0,Step2:0,LOSS_SX1:0,LOSS_SX2:0,LOSS_SETTING1:0,LOSS_SETTING2:0,NOTE:""}),[p,F]=d.useState([]);d.useState([]),d.useState(!1),d.useState(!1);const T=ft(n=>n.totalSlice.userData),[k,ce]=d.useState(!1),[Ne,ke]=d.useState(q().format("YYYY-MM-DD")),[I,ne]=d.useState(q().format("YYYY-MM-DD")),[z,Ee]=d.useState(""),[ae,Y]=d.useState(""),[Le,he]=d.useState(""),[Ce,ge]=d.useState(""),[Z,de]=d.useState(""),[S,K]=d.useState(""),[ee,X]=d.useState(!1),[A,L]=d.useState("00"),[g,ie]=d.useState(""),[Oe,M]=d.useState([]),[y,He]=d.useState([]),[H,Ze]=d.useState([]),[Fe,at]=d.useState(!1),[We,it]=d.useState(!1),[et,Ke]=d.useState(),[Q,te]=d.useState(),[Rt,Yt]=d.useState(),[pt,Lt]=d.useState("CODE: "),[gt,Qt]=d.useState("");d.useState("FR01"),d.useState("NM1");const[At,Kt]=d.useState(q().format("YYYY-MM-DD")),[jt,st]=d.useState(!1),[ht,se]=d.useState(!1),[ue,De]=d.useState(!0),[W,Ie]=d.useState(0),[R,Bt]=d.useState(!1),[_t,wt]=d.useState(!0),Ve=d.useRef(null),ze=Ul.useReactToPrint({content:()=>Ve.current}),Se=[{field:"G_CODE",headerName:"G_CODE",width:80},{field:"G_NAME",headerName:"G_NAME",width:250,renderCell:n=>n.row.PDBV==="P"||n.row.PDBV===null?e.jsx("span",{style:{color:"red"},children:n.row.G_NAME}):e.jsx("span",{style:{color:"green"},children:n.row.G_NAME})},{field:"EMPL_NAME",headerName:"PIC KD",width:150},{field:"CUST_NAME_KD",headerName:"KHÁCH",width:120},{field:"PROD_REQUEST_NO",headerName:"SỐ YCSX",width:80},{field:"PROD_REQUEST_DATE",headerName:"NGÀY YCSX",width:80},{field:"PROD_REQUEST_QTY",type:"number",headerName:"SL YCSX",width:80,renderCell:n=>e.jsx("span",{style:{color:"#009933"},children:e.jsx("b",{children:n.row.PROD_REQUEST_QTY.toLocaleString("en-US")})})},{field:"LOT_TOTAL_INPUT_QTY_EA",type:"number",headerName:"NHẬP KIỂM",width:80,renderCell:n=>e.jsx("span",{style:{color:"#cc0099"},children:e.jsx("b",{children:n.row.LOT_TOTAL_INPUT_QTY_EA.toLocaleString("en-US")})})},{field:"LOT_TOTAL_OUTPUT_QTY_EA",type:"number",headerName:"XUẤT KIỂM",width:80,renderCell:n=>e.jsx("span",{style:{color:"#cc0099"},children:e.jsx("b",{children:n.row.LOT_TOTAL_OUTPUT_QTY_EA.toLocaleString("en-US")})})},{field:"SHORTAGE_YCSX",type:"number",headerName:"TỒN YCSX",width:80,renderCell:n=>e.jsx("span",{style:{color:"blue"},children:e.jsx("b",{children:n.row.SHORTAGE_YCSX.toLocaleString("en-US")})})},{field:"PHAN_LOAI",headerName:"PHAN_LOAI",width:80,renderCell:n=>{if(n.row.PHAN_LOAI==="01")return e.jsx("span",{style:{color:"black"},children:e.jsx("b",{children:"Thông thường"})});if(n.row.PHAN_LOAI==="02")return e.jsx("span",{style:{color:"black"},children:e.jsx("b",{children:"SDI"})});if(n.row.PHAN_LOAI==="03")return e.jsx("span",{style:{color:"black"},children:e.jsx("b",{children:"GC"})});if(n.row.PHAN_LOAI==="04")return e.jsx("span",{style:{color:"black"},children:e.jsx("b",{children:"SAMPLE"})})}},{field:"REMARK",headerName:"REMARK",width:120},{field:"PDUYET",headerName:"PDUYET",width:80,renderCell:n=>n.row.PDUYET===1?e.jsx("span",{style:{color:"green"},children:e.jsx("b",{children:"Đã Duyệt"})}):e.jsx("span",{style:{color:"red"},children:e.jsx("b",{children:"Không Duyệt"})})},{field:"BANVE",headerName:"BANVE",width:250,renderCell:n=>{let _=null,u="http://14.160.33.94:5011/upload";const j=async re=>{console.log(_);const $=new FormData;if($.append("banve",_),$.append("filename",n.row.G_CODE),(T==null?void 0:T.MAINDEPTNAME)==="KD")try{const Te=await pl.post(u,$);Te.data.tk_status==="OK"?x("update_banve_value",{G_CODE:n.row.G_CODE,banvevalue:"Y"}).then(oe=>{if(oe.data.tk_status!=="NG"){h.fire("Thông báo","Upload bản vẽ thành công","success");let ct=Oe.map((be,ut)=>be.PROD_REQUEST_NO===n.row.PROD_REQUEST_NO?{...be,BANVE:"Y"}:be);M(ct)}else h.fire("Thông báo","Upload bản vẽ thất bại","error")}).catch(oe=>{console.log(oe)}):h.fire("Thông báo",Te.data.message,"error")}catch(Te){console.log(Te)}else h.fire("Thông báo","Chỉ bộ phận kinh doanh upload được bản vẽ","error")};let N="/banve/"+n.row.G_CODE+".pdf";return n.row.BANVE==="Y"?e.jsx("span",{style:{color:"green"},children:e.jsx("b",{children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",href:N,children:"LINK"})})}):e.jsxs("div",{className:"uploadfile",children:[e.jsxs(b,{className:"buttonIcon",onClick:j,children:[e.jsx(Rl,{color:"yellow",size:25}),"Upload"]}),e.jsx("input",{accept:".pdf",type:"file",onChange:re=>{_=re.target.files[0],console.log(_)}})]})}},{field:"PDBV",headerName:"PD BANVE",width:80,renderCell:n=>n.row.PDBV==="P"||n.row.PDBV===null?e.jsx("span",{style:{color:"red"},children:e.jsx("b",{children:"PENDING"})}):e.jsx("span",{style:{color:"green"},children:e.jsx("b",{children:"APPROVED"})})},{field:"",headerName:"G_NAME",width:250,renderCell:n=>n.row.PDBV==="P"||n.row.PDBV===null?e.jsx("span",{style:{color:"red"},children:n.row.G_NAME}):e.jsx("span",{style:{color:"green"},children:n.row.G_NAME})},{field:"PO_BALANCE",headerName:"PO_BALANCE",width:110,renderCell:n=>e.jsx("span",{style:{color:"blue"},children:e.jsx("b",{children:n.row.PO_BALANCE.toLocaleString("en","US")})})},{field:"EQ1",headerName:"EQ1",width:80,renderCell:n=>e.jsx("span",{style:{color:"black"},children:n.row.EQ1})},{field:"EQ2",headerName:"EQ2",width:80,renderCell:n=>e.jsx("span",{style:{color:"black"},children:n.row.EQ2})},{field:"CD1",headerName:"XUAT_CD1",width:100,renderCell:n=>e.jsx("span",{style:{color:"blue"},children:e.jsx("b",{children:n.row.CD1.toLocaleString("en","US")})})},{field:"CD2",headerName:"XUAT_CD2",width:100,renderCell:n=>e.jsx("span",{style:{color:"blue"},children:e.jsx("b",{children:n.row.CD2.toLocaleString("en","US")})})},{field:"LOT_TOTAL_OUTPUT_QTY_EA",type:"number",headerName:"XUẤT KIỂM",width:100,renderCell:n=>e.jsx("span",{style:{color:"#cc0099"},children:e.jsx("b",{children:n.row.LOT_TOTAL_OUTPUT_QTY_EA.toLocaleString("en-US")})})},{field:"CD_IN",headerName:"CD_IN",width:80,renderCell:n=>e.jsx("span",{style:{color:"gray"},children:e.jsx("b",{children:n.row.CD_IN.toLocaleString("en","US")})})},{field:"CD_DIECUT",headerName:"CD_DIECUT",width:80,renderCell:n=>e.jsx("span",{style:{color:"gray"},children:e.jsx("b",{children:n.row.CD_DIECUT.toLocaleString("en","US")})})},{field:"TON_CD1",headerName:"TONYCSX_CD1",width:120,renderCell:n=>e.jsx("span",{style:{color:"red"},children:e.jsx("b",{children:n.row.TON_CD1.toLocaleString("en","US")})})},{field:"TON_CD2",headerName:"TONYCSX_CD2",width:120,renderCell:n=>e.jsx("span",{style:{color:"red"},children:e.jsx("b",{children:n.row.TON_CD2.toLocaleString("en","US")})})},{field:"INSPECT_BALANCE",type:"number",headerName:"TỒN KIỂM",width:80,renderCell:n=>e.jsx("span",{style:{color:"#cc0099"},children:e.jsx("b",{children:n.row.INSPECT_BALANCE.toLocaleString("en-US")})})},{field:"YCSX_PENDING",headerName:"YCSX_PENDING",width:80,renderCell:n=>n.row.YCSX_PENDING===1?e.jsx("span",{style:{color:"red"},children:e.jsx("b",{children:"PENDING"})}):e.jsx("span",{style:{color:"green"},children:e.jsx("b",{children:"CLOSED"})})}],tt=[{field:"PLAN_ID",headerName:"PLAN_ID",width:90,editable:!1,resizeable:!0},{field:"PROD_REQUEST_NO",headerName:"YCSX_NO",width:100,editable:!0},{field:"G_CODE",headerName:"G_CODE",width:80,editable:!1},{field:"G_NAME_KD",headerName:"G_NAME_KD",width:200,editable:!1,renderCell:n=>n.row.FACTORY===null||n.row.EQ1===null||n.row.EQ2===null||n.row.Setting1===null||n.row.Setting2===null||n.row.UPH1===null||n.row.UPH2===null||n.row.Step1===null||n.row.Step1===null||n.row.LOSS_SX1===null||n.row.LOSS_SX2===null||n.row.LOSS_SETTING1===null||n.row.LOSS_SETTING2===null?e.jsx("span",{style:{color:"red"},children:n.row.G_NAME_KD}):e.jsx("span",{style:{color:"green"},children:n.row.G_NAME_KD})},{field:"PROD_REQUEST_QTY",headerName:"YCSX_QTY",width:80,editable:!1,renderCell:n=>e.jsx("span",{style:{color:"blue"},children:n.row.PROD_REQUEST_QTY.toLocaleString("en","US")})},{field:"CD1",headerName:"KQ_CD1",width:80,editable:!1,renderCell:n=>e.jsx("span",{style:{color:"blue"},children:n.row.CD1.toLocaleString("en","US")})},{field:"CD2",headerName:"KQ_CD2",width:80,editable:!1,renderCell:n=>e.jsx("span",{style:{color:"blue"},children:n.row.CD2.toLocaleString("en","US")})},{field:"TON_CD1",headerName:"TONYCSX_CD1",width:120,editable:!1,renderCell:n=>e.jsx("span",{style:{color:"blue"},children:n.row.TON_CD1.toLocaleString("en","US")})},{field:"TON_CD2",headerName:"TONYCSX_CD2",width:120,editable:!1,renderCell:n=>e.jsx("span",{style:{color:"blue"},children:n.row.TON_CD2.toLocaleString("en","US")})},{field:"PLAN_QTY",headerName:"PLAN_QTY",width:80,editable:ue,renderCell:n=>n.row.PLAN_QTY===0?e.jsx("span",{style:{color:"red"},children:"NG"}):e.jsx("span",{style:{color:"green"},children:n.row.PLAN_QTY.toLocaleString("en","US")})},{field:"PROCESS_NUMBER",headerName:"PROCESS_NUMBER",width:110,editable:ue,renderCell:n=>n.row.PROCESS_NUMBER===null||n.row.PROCESS_NUMBER===0?e.jsx("span",{style:{color:"red"},children:"NG"}):e.jsx("span",{style:{color:"green"},children:n.row.PROCESS_NUMBER})},{field:"PLAN_ORDER",headerName:"PLAN_ORDER",width:110,editable:ue},{field:"EQ1",headerName:"EQ1",width:80,editable:ue},{field:"EQ2",headerName:"EQ2",width:80,editable:ue},{field:"PLAN_EQ",headerName:"PLAN_EQ",width:80,editable:ue,renderCell:n=>n.row.PLAN_EQ===null||n.row.PLAN_EQ===""?e.jsx("span",{style:{color:"red"},children:"NG"}):e.jsx("span",{style:{color:"green"},children:n.row.PLAN_EQ})},{field:"STEP",headerName:"STEP",width:60,editable:ue},{field:"PLAN_FACTORY",headerName:"FACTORY",width:80,editable:!1},{field:"PLAN_DATE",headerName:"PLAN_DATE",width:110,editable:!1},{field:"NEXT_PLAN_ID",headerName:"NEXT_PLAN_ID",width:120,editable:!0}],Pt=n=>n.map((_,u)=>e.jsx(vl,{PLAN_ID:_.PLAN_ID,PLAN_DATE:_.PLAN_DATE,PROD_REQUEST_NO:_.PROD_REQUEST_NO,PLAN_QTY:_.PLAN_QTY,PLAN_EQ:_.PLAN_EQ,PLAN_FACTORY:_.PLAN_FACTORY,PLAN_LEADTIME:_.PLAN_LEADTIME,G_CODE:_.G_CODE,G_NAME:_.G_NAME,G_NAME_KD:_.G_NAME_KD,PROD_REQUEST_DATE:_.PROD_REQUEST_DATE,PROD_REQUEST_QTY:_.PROD_REQUEST_QTY,STEP:_.STEP,PLAN_ORDER:_.PLAN_ORDER},u)),mt=n=>n.map((_,u)=>e.jsx(yl,{PLAN_ID:_.PLAN_ID,PLAN_DATE:_.PLAN_DATE,PROD_REQUEST_NO:_.PROD_REQUEST_NO,PLAN_QTY:_.PLAN_QTY,PLAN_EQ:_.PLAN_EQ,PLAN_FACTORY:_.PLAN_FACTORY,PLAN_LEADTIME:_.PLAN_LEADTIME,G_CODE:_.G_CODE,G_NAME:_.G_NAME,G_NAME_KD:_.G_NAME_KD,PROD_REQUEST_DATE:_.PROD_REQUEST_DATE,PROD_REQUEST_QTY:_.PROD_REQUEST_QTY,STEP:_.STEP,PLAN_ORDER:_.PLAN_ORDER},u)),qe=n=>n.map((_,u)=>e.jsx(wl,{PROD_REQUEST_NO:_.PROD_REQUEST_NO,G_CODE:_.G_CODE,PO_TDYCSX:_.PO_TDYCSX,TOTAL_TKHO_TDYCSX:_.TOTAL_TKHO_TDYCSX,TKHO_TDYCSX:_.TKHO_TDYCSX,BTP_TDYCSX:_.BTP_TDYCSX,CK_TDYCSX:_.CK_TDYCSX,BLOCK_TDYCSX:_.BLOCK_TDYCSX,FCST_TDYCSX:_.FCST_TDYCSX,PDBV:_.PDBV,PDBV_EMPL:_.PDBV_EMPL,PDBV_DATE:_.PDBV_DATE,DESCR:_.DESCR},u)),Ut=n=>n.map((_,u)=>_.BANVE==="Y"?e.jsx(ml,{G_CODE:_.G_CODE,PDBV:_.PDBV,PROD_REQUEST_NO:_.PROD_REQUEST_NO,PDBV_EMPL:_.PDBV_EMPL,PDBV_DATE:_.PDBV_DATE},u):e.jsxs("div",{children:["Code: ",_.G_NAME," : Không có bản vẽ"]})),bt=n=>{x("getqlsxplan_table",{PROD_REQUEST_NO:n}).then(_=>{if(_.data.tk_status!=="NG"){let u=_.data.data.map((j,N)=>({...j,PLAN_DATE:q.utc(j.PLAN_DATE).format("YYYY-MM-DD"),id:N}));F(u)}else F([]),h.fire("Thông báo","Nội dung: "+_.data.message,"error")}).catch(_=>{console.log(_)})},rt=()=>{ce(!0),x("traYCSXDataFull_QLSX",{alltime:ee,start_date:Ne,end_date:I,cust_name:Ce,codeCMS:ae,codeKD:z,prod_type:Z,empl_name:Le,phanloai:A,ycsx_pending:Fe,inspect_inputcheck:We,prod_request_no:S,material:g}).then(n=>{if(n.data.tk_status!=="NG"){const _=n.data.data.map((u,j)=>({...u,PO_TDYCSX:u.PO_TDYCSX===void 0||u.PO_TDYCSX===null?0:u.PO_TDYCSX,TOTAL_TKHO_TDYCSX:u.TOTAL_TKHO_TDYCSX===void 0||u.TOTAL_TKHO_TDYCSX===null?0:u.TOTAL_TKHO_TDYCSX,TKHO_TDYCSX:u.TKHO_TDYCSX===void 0||u.TKHO_TDYCSX===null?0:u.TKHO_TDYCSX,BTP_TDYCSX:u.BTP_TDYCSX===void 0||u.BTP_TDYCSX===null?0:u.BTP_TDYCSX,CK_TDYCSX:u.CK_TDYCSX===void 0||u.CK_TDYCSX===null?0:u.CK_TDYCSX,BLOCK_TDYCSX:u.BLOCK_TDYCSX===void 0||u.BLOCK_TDYCSX===null?0:u.BLOCK_TDYCSX,FCST_TDYCSX:u.FCST_TDYCSX===void 0||u.FCST_TDYCSX===null?0:u.FCST_TDYCSX,W1:u.W1===void 0||u.W1===null?0:u.W1,W2:u.W2===void 0||u.W2===null?0:u.W2,W3:u.W3===void 0||u.W3===null?0:u.W3,W4:u.W4===void 0||u.W4===null?0:u.W4,W5:u.W5===void 0||u.W5===null?0:u.W5,W6:u.W6===void 0||u.W6===null?0:u.W6,W7:u.W7===void 0||u.W7===null?0:u.W7,W8:u.W8===void 0||u.W8===null?0:u.W8,PROD_REQUEST_QTY:u.PROD_REQUEST_QTY===void 0||u.PROD_REQUEST_QTY===null?0:u.PROD_REQUEST_QTY}));M(_),ce(!1),h.fire("Thông báo","Đã load "+n.data.data.length+" dòng","success")}else h.fire("Thông báo","Nội dung: "+n.data.message,"error"),ce(!1)}).catch(n=>{console.log(n)})},fe=n=>{n.key==="Enter"&&rt()},It=async n=>{if(y.length>=1){let _=!1;for(let u=0;u<y.length;u++)await x("setpending_ycsx",{PROD_REQUEST_NO:y[u].PROD_REQUEST_NO,YCSX_PENDING:n}).then(j=>{console.log(j.data.tk_status),j.data.tk_status!=="NG"||(_=!0)}).catch(j=>{console.log(j)});_?h.fire("Thông báo","Có lỗi SQL: ","error"):h.fire("Thông báo","SET YCSX thành công (chỉ PO của người đăng nhập)!","success")}else h.fire("Thông báo","Chọn ít nhất 1 YCSX để SET !","error")},yt=()=>{h.fire({title:"Chắc chắn muốn SET PENDING YCSX đã chọn ?",text:"Sẽ bắt đầu SET PENDING YCSX đã chọn",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Vẫn Xóa!"}).then(n=>{n.isConfirmed&&(h.fire("Tiến hành SET PENDING","Đang SET PENDING YCSX hàng loạt","success"),It(1))})},Me=()=>{h.fire({title:"Chắc chắn muốn SET CLOSED YCSX đã chọn ?",text:"Sẽ bắt đầu SET CLOSED YCSX đã chọn",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Vẫn Xóa!"}).then(n=>{n.isConfirmed&&(h.fire("Tiến hành SET CLOSED","Đang SET CLOSED YCSX hàng loạt","success"),It(0))})},Re=()=>{h.fire({title:"Chắc chắn muốn xóa PLan đã chọn ?",text:"Sẽ bắt đầu xóa Plan đã chọn",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Vẫn Xóa!"}).then(n=>{n.isConfirmed&&(h.fire("Tiến hành Xóa Plan","Đang xóa Plan","success"),Ae())})},$e=()=>{h.fire({title:"Chắc chắn muốn Lưu PLAN đã chọn ?",text:"Sẽ bắt đầu Lưu PLAN đã chọn",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Vẫn Lưu!"}).then(n=>{n.isConfirmed&&(h.fire("Tiến hành Lưu PLAN","Đang Lưu PLAN hàng loạt","success"),ot())})},Ae=async()=>{if(H.length>0){let n=[...p];for(let _=0;_<H.length;_++)for(let u=0;u<n.length;u++)if(H[_].id===n[u].id){let j=n.length;n.splice(u,1);let N=n.length-1;j===1?(Ie(0),localStorage.setItem("temp_plan_table_max_id","0")):(Ie(parseInt(n[N].id)),localStorage.setItem("temp_plan_table_max_id",n[N].id)),F(n),localStorage.setItem("temp_plan_table",JSON.stringify(n))}}else h.fire("Thông báo","Chọn ít nhất một dòng để xóa","error")},je=async(n,_)=>{let u=n,j=1;return await x("getLastestPLAN_ID",{PROD_REQUEST_NO:n}).then(N=>{if(N.data.tk_status!=="NG"){let re=N.data.data[0].PLAN_ID;re.substring(7,8)==="Z"?re.substring(3,4)==="0"?u=re.substring(0,3)+"A"+re.substring(4,7)+"A":u=re.substring(0,3)+Be[Be.indexOf(re.substring(3,4))+1]+re.substring(4,7)+"A":u=re.substring(0,7)+Be[Be.indexOf(re.substring(7,8))+1]}else u=n+"A"}).catch(N=>{console.log(N)}),await x("getLastestPLANORDER",{PLAN_DATE:_.PLAN_DATE,PLAN_EQ:_.PLAN_EQ,PLAN_FACTORY:_.PLAN_FACTORY}).then(N=>{N.data.tk_status!=="NG"?j=N.data.data[0].PLAN_ORDER+1:j=1}).catch(N=>{console.log(N)}),{NEXT_PLAN_ID:u,NEXT_PLAN_ORDER:j}},vt=async()=>{let n=W;if(n++,Ie(n),localStorage.setItem("temp_plan_table_max_id",n.toString()),y.length>=1)for(let _=0;_<y.length;_++){let u={id:W+1+"",PLAN_ID:"PL"+(W+1),PLAN_DATE:q().format("YYYY-MM-DD"),PROD_REQUEST_NO:y[_].PROD_REQUEST_NO,PLAN_QTY:0,PLAN_EQ:"",PLAN_FACTORY:(T==null?void 0:T.FACTORY_CODE)===1?"NM1":"NM2",PLAN_LEADTIME:0,INS_EMPL:T==null?void 0:T.EMPL_NO,INS_DATE:q().format("YYYY-MM-DD HH:mm:ss"),UPD_EMPL:T==null?void 0:T.EMPL_NO,UPD_DATE:q().format("YYYY-MM-DD HH:mm:ss"),G_CODE:y[_].G_CODE,G_NAME:y[_].G_NAME,G_NAME_KD:y[_].G_NAME,PROD_REQUEST_DATE:y[_].PROD_REQUEST_DATE,PROD_REQUEST_QTY:y[_].PROD_REQUEST_QTY,STEP:1,PLAN_ORDER:"1",PROCESS_NUMBER:1,KETQUASX:0,KQ_SX_TAM:0,CD1:y[_].CD1,CD2:y[_].CD2,TON_CD1:y[_].TON_CD1,TON_CD2:y[_].TON_CD2,FACTORY:"",EQ1:y[_].EQ1,EQ2:y[_].EQ2,Setting1:y[_].Setting1,Setting2:y[_].Setting2,UPH1:y[_].UPH1,UPH2:y[_].UPH2,Step1:y[_].Step1,Step2:y[_].Step2,LOSS_SX1:y[_].LOSS_SX1,LOSS_SX2:y[_].LOSS_SX2,LOSS_SETTING1:y[_].LOSS_SETTING1,LOSS_SETTING2:y[_].LOSS_SETTING2,NOTE:y[_].NOTE,NEXT_PLAN_ID:"X"};F([...p,u]),localStorage.setItem("temp_plan_table",JSON.stringify([...p,u]))}else h.fire("Thông báo","Chọn ít nhất 1 YCSX để Add !","error")},r=async()=>{let n=W;n++,Ie(n),localStorage.setItem("temp_plan_table_max_id",n.toString());let _={id:W+1+"",PLAN_ID:"PL"+(W+1),PLAN_DATE:q().format("YYYY-MM-DD"),PROD_REQUEST_NO:"",PLAN_QTY:0,PLAN_EQ:"",PLAN_FACTORY:(T==null?void 0:T.FACTORY_CODE)===1?"NM1":"NM2",PLAN_LEADTIME:0,INS_EMPL:T==null?void 0:T.EMPL_NO,INS_DATE:q().format("YYYY-MM-DD HH:mm:ss"),UPD_EMPL:T==null?void 0:T.EMPL_NO,UPD_DATE:q().format("YYYY-MM-DD HH:mm:ss"),G_CODE:"",G_NAME:"",G_NAME_KD:"",PROD_REQUEST_DATE:"",PROD_REQUEST_QTY:0,STEP:1,PLAN_ORDER:"1",PROCESS_NUMBER:1,KETQUASX:0,KQ_SX_TAM:0,CD1:0,CD2:0,TON_CD1:0,TON_CD2:0,FACTORY:"",EQ1:"",EQ2:"",Setting1:0,Setting2:0,UPH1:0,UPH2:0,Step1:0,Step2:0,LOSS_SX1:0,LOSS_SX2:0,LOSS_SETTING1:0,LOSS_SETTING2:0,NOTE:"",NEXT_PLAN_ID:"X"};F([...p,_]),localStorage.setItem("temp_plan_table",JSON.stringify([...p,_]))},ot=async()=>{if(H.length!==0){localStorage.setItem("temp_plan_table",JSON.stringify(p));let n="0";for(let _=0;_<H.length;_++)if((parseInt(H[_].PROCESS_NUMBER.toString())===1||parseInt(H[_].PROCESS_NUMBER.toString())===2)&&H[_].PLAN_QTY!==0&&H[_].PLAN_QTY<=H[_].PROD_REQUEST_QTY&&H[_].PLAN_EQ.substring(0,2)!==""&&(H[_].PLAN_EQ.substring(0,2)==="FR"||H[_].PLAN_EQ.substring(0,2)==="SR"||H[_].PLAN_EQ.substring(0,2)==="DC"||H[_].PLAN_EQ.substring(0,2)==="ED")&&parseInt(H[_].STEP.toString())>=0&&parseInt(H[_].STEP.toString())<=9){let u=!1;await x("checkProd_request_no_Exist_O302",{PROD_REQUEST_NO:H[_].PROD_REQUEST_NO}).then($=>{$.data.tk_status!=="NG"&&($.data.data.length>0?u=!0:u=!1)}).catch($=>{console.log($)});let j=await je(H[_].PROD_REQUEST_NO,H[_]),N=j.NEXT_PLAN_ID,re=j.NEXT_PLAN_ORDER;u===!1?x("addPlanQLSX",{STEP:H[_].STEP,PLAN_QTY:H[_].PLAN_QTY,PLAN_LEADTIME:H[_].PLAN_LEADTIME,PLAN_EQ:H[_].PLAN_EQ,PLAN_ORDER:re,PROCESS_NUMBER:H[_].PROCESS_NUMBER,KETQUASX:H[_].KETQUASX===null?0:H[_].KETQUASX,PLAN_ID:N,PLAN_DATE:q().format("YYYY-MM-DD"),PROD_REQUEST_NO:H[_].PROD_REQUEST_NO,PLAN_FACTORY:H[_].PLAN_FACTORY,G_CODE:H[_].G_CODE,NEXT_PLAN_ID:H[_].NEXT_PLAN_ID}).then($=>{$.data.tk_status!=="NG"?Ae():n+="_"+$.data.message}).catch($=>{console.log($)}):n+="__Yc này đã chạy hệ thống cũ, chạy nốt bằng hệ thống cũ nhé"}else n+="_"+H[_].G_NAME_KD+": Plan QTY =0 hoặc Process number trắng hoặc khác giá trị 1 or 2, hoặc chỉ thị nhiều hơn ycsx qty, hoặc PLAN_EQ rỗng, hoặc không hợp lệ, hoặc Step không nằm trong khoảng từ 0 đến 9 sẽ ko được lưu";n!=="0"?h.fire("Thông báo","Có lỗi !"+n,"error"):h.fire("Thông báo","Lưu PLAN thành công","success")}else h.fire("Thông báo","Chọn ít nhất 1 dòng để lưu","error")},St=async()=>{if(gt!==void 0)if((T==null?void 0:T.EMPL_NO)==="NHU1903"||(T==null?void 0:T.MAINDEPTNAME)==="QLSX"){let n="0";console.log(f),f.FACTORY==="NA"||f.EQ1==="NA"||f.EQ1==="NO"||f.EQ2===""||f.Setting1===0||f.UPH1===0||f.Step1===0||f.LOSS_SX1===0?h.fire("Thông báo","Lưu thất bại, hãy nhập đủ thông tin","error"):(x("saveQLSX",{G_CODE:gt,FACTORY:f.FACTORY,EQ1:f.EQ1,EQ2:f.EQ2,Setting1:f.Setting1,Setting2:f.Setting2,UPH1:f.UPH1,UPH2:f.UPH2,Step1:f.Step1,Step2:f.Step2,LOSS_SX1:f.LOSS_SX1,LOSS_SX2:f.LOSS_SX2,LOSS_SETTING1:f.LOSS_SETTING1,LOSS_SETTING2:f.LOSS_SETTING2,NOTE:f.NOTE}).then(_=>{console.log(_.data.tk_status),_.data.tk_status!=="NG"||(n="1")}).catch(_=>{console.log(_)}),n==="1"?h.fire("Thông báo","Lưu thất bại, không được để trống ô cần thiết","error"):(bt(At),h.fire("Thông báo","Lưu thành công","success")))}else h.fire("Thông báo","Không đủ quyền hạn!","error");else h.fire("Thông báo","Chọn ít nhất 1 Code để SET !","error")};function Tt(){return e.jsxs(Xe,{children:[e.jsxs(b,{className:"buttonIcon",onClick:()=>{Ue(Oe,"YCSX Table")},children:[e.jsx(ye,{color:"green",size:25}),"SAVE"]}),e.jsx(Ge,{}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{Me()},children:[e.jsx(Ql,{color:"green",size:25}),"SET CLOSED"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{yt()},children:[e.jsx(Yl,{color:"red",size:25}),"SET PENDING"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{y.length>0?(V({...C,tabycsx:y.length>0}),console.log(y),Ke(qe(y))):h.fire("Thông báo","Chọn ít nhất 1 YCSX để in","error")},children:[e.jsx(Je,{color:"#0066ff",size:25}),"Print YCSX"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{y.length>0?(V({...C,tabbanve:y.length>0}),Ke(Ut(y))):h.fire("Thông báo","Chọn ít nhất 1 YCSX để in","error")},children:[e.jsx(Je,{color:"#ff751a",size:25}),"Print Bản Vẽ"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{y.length>0?vt():h.fire("Thông báo","Chọn ít nhất 1 YCSX để thêm PLAN","error")},children:[e.jsx($t,{color:"#69f542",size:25}),"Add to PLAN"]})]})}function Nt(){return e.jsxs(Xe,{children:[e.jsxs(b,{className:"buttonIcon",onClick:()=>{Ue(p,"Plan Table")},children:[e.jsx(ye,{color:"green",size:25}),"SAVE"]}),e.jsx(Ge,{}),e.jsx("span",{style:{fontSize:20,fontWeight:"bold"},children:"Bảng tạm xắp PLAN"}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{r()},children:[e.jsx($t,{color:"#69f542",size:25}),"Add Blank PLAN"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{xe(T==null?void 0:T.EMPL_NO,T==null?void 0:T.MAINDEPTNAME,["QLSX"],$e)},children:[e.jsx(Dt,{color:"blue",size:20}),"LƯU PLAN"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{Re()},children:[e.jsx(Jt,{color:"yellow",size:20}),"XÓA PLAN NHÁP"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{Bt(!R)},children:[e.jsx(zl,{color:"green",size:20}),"Ẩn /Hiện"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{xe(T==null?void 0:T.EMPL_NO,T==null?void 0:T.MAINDEPTNAME,["QLSX"],St)},children:[e.jsx(Dt,{color:"lightgreen",size:20}),"Lưu Data Định Mức"]})]})}const Ye=n=>{const _=new Set(n);let u=Oe.filter(j=>_.has(j.PROD_REQUEST_NO));u.length>0?He(u):(He([]),console.log("xoa filter"))},Ft=n=>{const _=new Set(n);let u=p.filter(j=>_.has(j.PLAN_ID));u.length>0?Ze(u):Ze([])},pe=async n=>{let _=[];return await x("traYCSXDataFull_QLSX",{alltime:!0,start_date:Ne,end_date:I,cust_name:"",codeCMS:"",codeKD:"",prod_type:"",empl_name:"",phanloai:A,ycsx_pending:!1,inspect_inputcheck:!1,prod_request_no:n,material:""}).then(u=>{u.data.tk_status!=="NG"?_=u.data.data.map((N,re)=>({...N,PO_TDYCSX:N.PO_TDYCSX===void 0||N.PO_TDYCSX===null?0:N.PO_TDYCSX,TOTAL_TKHO_TDYCSX:N.TOTAL_TKHO_TDYCSX===void 0||N.TOTAL_TKHO_TDYCSX===null?0:N.TOTAL_TKHO_TDYCSX,TKHO_TDYCSX:N.TKHO_TDYCSX===void 0||N.TKHO_TDYCSX===null?0:N.TKHO_TDYCSX,BTP_TDYCSX:N.BTP_TDYCSX===void 0||N.BTP_TDYCSX===null?0:N.BTP_TDYCSX,CK_TDYCSX:N.CK_TDYCSX===void 0||N.CK_TDYCSX===null?0:N.CK_TDYCSX,BLOCK_TDYCSX:N.BLOCK_TDYCSX===void 0||N.BLOCK_TDYCSX===null?0:N.BLOCK_TDYCSX,FCST_TDYCSX:N.FCST_TDYCSX===void 0||N.FCST_TDYCSX===null?0:N.FCST_TDYCSX,W1:N.W1===void 0||N.W1===null?0:N.W1,W2:N.W2===void 0||N.W2===null?0:N.W2,W3:N.W3===void 0||N.W3===null?0:N.W3,W4:N.W4===void 0||N.W4===null?0:N.W4,W5:N.W5===void 0||N.W5===null?0:N.W5,W6:N.W6===void 0||N.W6===null?0:N.W6,W7:N.W7===void 0||N.W7===null?0:N.W7,W8:N.W8===void 0||N.W8===null?0:N.W8,PROD_REQUEST_QTY:N.PROD_REQUEST_QTY===void 0||N.PROD_REQUEST_QTY===null?0:N.PROD_REQUEST_QTY})):h.fire("Thông báo","Nội dung: "+u.data.message,"error")}).catch(u=>{console.log(u)}),_},lt=(n,_,u)=>{let j=n.row;Lt("CODE: "+j.G_NAME_KD),Qt(j.G_CODE),w({...f,FACTORY:j.FACTORY===null?"NA":j.FACTORY,EQ1:j.EQ1===""?"NA":j.EQ1,EQ2:j.EQ2===""?"NA":j.EQ2,Setting1:j.Setting1===null?0:j.Setting1,Setting2:j.Setting2===null?0:j.Setting2,UPH1:j.UPH1===null?0:j.UPH1,UPH2:j.UPH2===null?0:j.UPH2,Step1:j.Step1===null?0:j.Step1,Step2:j.Step2===null?0:j.Step2,LOSS_SX1:j.LOSS_SX1===null?0:j.LOSS_SX1,LOSS_SX2:j.LOSS_SX2===null?0:j.LOSS_SX2,LOSS_SETTING1:j.LOSS_SETTING1===null?0:j.LOSS_SETTING1,LOSS_SETTING2:j.LOSS_SETTING2===null?0:j.LOSS_SETTING2,NOTE:j.NOTE===null?"":j.NOTE})},Et=(n,_,u)=>{(async()=>{var re;const j=n.field;let N=[];if(j==="PROD_REQUEST_NO"){N=await pe(n.value);const $=p.map(Te=>Te.PLAN_ID===n.id?j==="PROD_REQUEST_NO"?N.length>0?{...Te,[j]:n.value,G_CODE:N[0].G_CODE,G_NAME_KD:N[0].G_NAME,PROD_REQUEST_QTY:N[0].PROD_REQUEST_QTY,CD1:N[0].CD1,CD2:N[0].CD2,TON_CD1:N[0].TON_CD1,TON_CD2:N[0].TON_CD2,EQ1:N[0].EQ1,EQ2:N[0].EQ2,UPH1:N[0].UPH1,UPH2:N[0].UPH2,FACTORY:N[0].FACTORY,Setting1:N[0].Setting1,Setting2:N[0].Setting2,Step1:N[0].Step1,Step2:N[0].Step2,LOSS_SX1:N[0].LOSS_SX1,LOSS_SX2:N[0].LOSS_SX2,LOSS_SETTING1:N[0].LOSS_SETTING1,LOSS_SETTING2:N[0].LOSS_SETTING2,NOTE:N[0].NOTE}:(h.fire("Thông báo","Không có số yc này","error"),{...Te,[j]:""}):(console.log(j),{...Te,[j]:n.value}):Te);localStorage.setItem("temp_plan_table",JSON.stringify($)),F($)}else if(j==="PLAN_EQ"){let $=(re=p.find(oe=>oe.PLAN_ID===n.id))==null?void 0:re.PROD_REQUEST_NO;$!==void 0&&(N=await pe($));const Te=p.map(oe=>{if(oe.PLAN_ID===n.id)if(j==="PLAN_EQ")if(n.value.length===4){let ct=n.value.substring(0,2),be=oe.UPH1===null?999999999:oe.UPH1,ut=oe.UPH2===null?999999999:oe.UPH2;return console.log("UPH1",be),console.log("UPH2",ut),ct===oe.EQ1?{...oe,[j]:n.value,PROCESS_NUMBER:1,CD1:N[0].CD1,CD2:N[0].CD2,TON_CD1:N[0].TON_CD1,TON_CD2:N[0].TON_CD2,PLAN_QTY:N[0].TON_CD1<=0?0:N[0].TON_CD1<be*10?N[0].TON_CD1:be*10}:ct===oe.EQ2?{...oe,[j]:n.value,PROCESS_NUMBER:2,CD1:N[0].CD1,CD2:N[0].CD2,TON_CD1:N[0].TON_CD1,TON_CD2:N[0].TON_CD2,PLAN_QTY:N[0].TON_CD2<=0?0:N[0].TON_CD2<ut*10?N[0].TON_CD2:ut*10}:(h.fire("Thông báo","Máy đã nhập ko giống trong BOM","warning"),{...oe,[j]:n.value})}else return h.fire("Thông báo","Nhập máy không đúng","error"),{...oe,[j]:""};else return console.log(j),{...oe,[j]:n.value};else return oe});localStorage.setItem("temp_plan_table",JSON.stringify(Te)),F(Te)}else{const $=p.map(Te=>Te.PLAN_ID===n.id?{...Te,[j]:n.value}:Te);localStorage.setItem("temp_plan_table",JSON.stringify($)),F($)}})()};return d.useEffect(()=>{var N,re;let n=[],_=0,u=(N=localStorage.getItem("temp_plan_table"))==null?void 0:N.toString(),j=(re=localStorage.getItem("temp_plan_table_max_id"))==null?void 0:re.toString();u!==void 0&&j!==void 0?(_=parseInt(j),n=JSON.parse(u),F(n),Ie(_)):(F([]),Ie(0))},[]),e.jsx("div",{className:"quickplan",children:e.jsxs("div",{className:"planwindow",children:[e.jsx("span",{style:{fontSize:25,color:"blue",marginLeft:20},children:pt}),e.jsx("div",{className:"dinhmucdiv",children:_t&&e.jsxs("div",{className:"datadinhmuc",children:[e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"EQ1:"}),e.jsxs("select",{name:"phanloai",value:f.EQ1,onChange:n=>w({...f,EQ1:n.target.value}),style:{width:150,height:22},children:[e.jsx("option",{value:"FR",children:"FR"}),e.jsx("option",{value:"SR",children:"SR"}),e.jsx("option",{value:"DC",children:"DC"}),e.jsx("option",{value:"ED",children:"ED"}),e.jsx("option",{value:"NO",children:"NO"}),e.jsx("option",{value:"NA",children:"NA"})]})]}),e.jsxs("label",{children:[e.jsx("b",{children:"EQ2:"}),e.jsxs("select",{name:"phanloai",value:f.EQ2,onChange:n=>w({...f,EQ2:n.target.value}),style:{width:150,height:22},children:[e.jsx("option",{value:"FR",children:"FR"}),e.jsx("option",{value:"SR",children:"SR"}),e.jsx("option",{value:"DC",children:"DC"}),e.jsx("option",{value:"ED",children:"ED"}),e.jsx("option",{value:"NO",children:"NO"}),e.jsx("option",{value:"NA",children:"NA"})]})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"Setting1(min):"})," ",e.jsx("input",{type:"text",placeholder:"Thời gian setting 1",value:f.Setting1,onChange:n=>w({...f,Setting1:Number(n.target.value)})})]}),e.jsxs("label",{children:[e.jsx("b",{children:"Setting2(min):"})," ",e.jsx("input",{type:"text",placeholder:"Thời gian setting 2",value:f.Setting2,onChange:n=>w({...f,Setting2:Number(n.target.value)})})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"UPH1(EA/h):"})," ",e.jsx("input",{type:"text",placeholder:"Tốc độ sx 1",value:f.UPH1,onChange:n=>w({...f,UPH1:Number(n.target.value)})})]}),e.jsxs("label",{children:[e.jsx("b",{children:"UPH2(EA/h):"})," ",e.jsx("input",{type:"text",placeholder:"Tốc độ sx 2",value:f.UPH2,onChange:n=>w({...f,UPH2:Number(n.target.value)})})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"Step1:"})," ",e.jsx("input",{type:"text",placeholder:"Số bước 1",value:f.Step1,onChange:n=>w({...f,Step1:Number(n.target.value)})})]}),e.jsxs("label",{children:[e.jsx("b",{children:"Step2:"})," ",e.jsx("input",{type:"text",placeholder:"Số bước 2",value:f.Step2,onChange:n=>w({...f,Step2:Number(n.target.value)})})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"LOSS_SX1(%):"})," ",e.jsx("input",{type:"text",placeholder:"% loss sx 1",value:f.LOSS_SX1,onChange:n=>w({...f,LOSS_SX1:Number(n.target.value)})})]}),e.jsxs("label",{children:[e.jsx("b",{children:"LOSS_SX2(%):"})," ",e.jsx("input",{type:"text",placeholder:"% loss sx 2",value:f.LOSS_SX2,onChange:n=>w({...f,LOSS_SX2:Number(n.target.value)})})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"LOSS SETTING1 (m):"})," ",e.jsx("input",{type:"text",placeholder:"met setting 1",value:f.LOSS_SETTING1,onChange:n=>w({...f,LOSS_SETTING1:Number(n.target.value)})})]}),e.jsxs("label",{children:[e.jsx("b",{children:"LOSS SETTING2 (m):"})," ",e.jsx("input",{type:"text",placeholder:"met setting 2",value:f.LOSS_SETTING2,onChange:n=>w({...f,LOSS_SETTING2:Number(n.target.value)})})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"FACTORY:"}),e.jsxs("select",{name:"phanloai",value:f.FACTORY===null?"NA":f.FACTORY,onChange:n=>{w({...f,FACTORY:n.target.value})},style:{width:162,height:22},children:[e.jsx("option",{value:"NA",children:"NA"}),e.jsx("option",{value:"NM1",children:"NM1"}),e.jsx("option",{value:"NM2",children:"NM2"})]})]}),e.jsxs("label",{children:[e.jsx("b",{children:"NOTE (QLSX):"})," ",e.jsx("input",{type:"text",placeholder:"Chú ý",value:f.NOTE,onChange:n=>w({...f,NOTE:n.target.value})})]})]})]})}),e.jsxs("div",{className:"content",children:[R&&e.jsx("div",{className:"ycsxlist",children:e.jsxs("div",{className:"tracuuYCSX",children:[e.jsxs("div",{className:"tracuuYCSXform",children:[e.jsxs("div",{className:"forminput",children:[e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"Từ ngày:"}),e.jsx("input",{onKeyDown:n=>{fe(n)},type:"date",value:Ne.slice(0,10),onChange:n=>ke(n.target.value)})]}),e.jsxs("label",{children:[e.jsx("b",{children:"Tới ngày:"})," ",e.jsx("input",{onKeyDown:n=>{fe(n)},type:"date",value:I.slice(0,10),onChange:n=>ne(n.target.value)})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"Code KD:"})," ",e.jsx("input",{onKeyDown:n=>{fe(n)},type:"text",placeholder:"GH63-xxxxxx",value:z,onChange:n=>Ee(n.target.value)})]}),e.jsxs("label",{children:[e.jsx("b",{children:"Code CMS:"})," ",e.jsx("input",{onKeyDown:n=>{fe(n)},type:"text",placeholder:"7C123xxx",value:ae,onChange:n=>Y(n.target.value)})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"Tên nhân viên:"})," ",e.jsx("input",{onKeyDown:n=>{fe(n)},type:"text",placeholder:"Trang",value:Le,onChange:n=>he(n.target.value)})]}),e.jsxs("label",{children:[e.jsx("b",{children:"Khách:"})," ",e.jsx("input",{onKeyDown:n=>{fe(n)},type:"text",placeholder:"SEVT",value:Ce,onChange:n=>ge(n.target.value)})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"Loại sản phẩm:"})," ",e.jsx("input",{onKeyDown:n=>{fe(n)},type:"text",placeholder:"TSP",value:Z,onChange:n=>de(n.target.value)})]}),e.jsxs("label",{children:[e.jsx("b",{children:"Số YCSX:"})," ",e.jsx("input",{onKeyDown:n=>{fe(n)},type:"text",placeholder:"12345",value:S,onChange:n=>K(n.target.value)})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"Phân loại:"}),e.jsxs("select",{name:"phanloai",value:A,onChange:n=>{L(n.target.value)},children:[e.jsx("option",{value:"00",children:"ALL"}),e.jsx("option",{value:"01",children:"Thông thường"}),e.jsx("option",{value:"02",children:"SDI"}),e.jsx("option",{value:"03",children:"GC"}),e.jsx("option",{value:"04",children:"SAMPLE"}),e.jsx("option",{value:"22",children:"NOT SAMPLE"})]})]}),e.jsxs("label",{children:[e.jsx("b",{children:"Vật liệu:"})," ",e.jsx("input",{onKeyDown:n=>{fe(n)},type:"text",placeholder:"SJ-203020HC",value:g,onChange:n=>ie(n.target.value)})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"YCSX Pending:"}),e.jsx("input",{onKeyDown:n=>{fe(n)},type:"checkbox",name:"alltimecheckbox",defaultChecked:Fe,onChange:()=>at(!Fe)})]}),e.jsxs("label",{children:[e.jsx("b",{children:"Vào kiểm:"}),e.jsx("input",{onKeyDown:n=>{fe(n)},type:"checkbox",name:"alltimecheckbox",defaultChecked:We,onChange:()=>it(!We)})]})]})]}),e.jsxs("div",{className:"formbutton",children:[e.jsxs("label",{children:[e.jsx("b",{children:"All Time:"}),e.jsx("input",{type:"checkbox",name:"alltimecheckbox",defaultChecked:ee,onChange:()=>X(!ee)})]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{rt()},children:[e.jsx(Ml,{color:"green",size:30}),"Search"]})]})]}),e.jsx("div",{className:"tracuuYCSXTable",children:e.jsx(ve,{sx:{fontSize:12,flex:1},components:{Toolbar:Tt,LoadingOverlay:me},loading:k,rowHeight:30,rows:Oe,columns:Se,rowsPerPageOptions:[5,10,50,100,500,1e3,5e3,1e4,5e5],editMode:"row",getRowId:n=>n.PROD_REQUEST_NO,onSelectionModelChange:n=>{Ye(n)}})}),C.tabycsx&&e.jsxs("div",{className:"printycsxpage",children:[e.jsxs("div",{className:"buttongroup",children:[e.jsx(_e,{onClick:()=>{Ke(qe(y))},children:"Render YCSX"}),e.jsx(_e,{onClick:ze,children:"Print YCSX"}),e.jsx(_e,{onClick:()=>{V({...C,tabycsx:!1})},children:"Close"})]}),e.jsx("div",{className:"ycsxrender",ref:Ve,children:et})]}),C.tabbanve&&e.jsxs("div",{className:"printycsxpage",children:[e.jsxs("div",{className:"buttongroup",children:[e.jsx(_e,{onClick:()=>{Ke(Ut(y))},children:"Render Bản Vẽ"}),e.jsx(_e,{onClick:ze,children:"Print Bản Vẽ"}),e.jsx(_e,{onClick:()=>{V({...C,tabbanve:!1})},children:"Close"})]}),e.jsx("div",{className:"ycsxrender",ref:Ve,children:et})]}),jt&&e.jsxs("div",{className:"printycsxpage",children:[e.jsxs("div",{className:"buttongroup",children:[e.jsx("button",{onClick:()=>{te(mt(H))},children:"Render Chỉ Thị"}),e.jsx("button",{onClick:ze,children:"Print Chỉ Thị"}),e.jsx("button",{onClick:()=>{st(!jt)},children:"Close"})]}),e.jsx("div",{className:"ycsxrender",ref:Ve,children:Q})]}),ht&&e.jsxs("div",{className:"printycsxpage",children:[e.jsxs("div",{className:"buttongroup",children:[e.jsx("button",{onClick:()=>{Yt(Pt(H))},children:"Render YCKT"}),e.jsx("button",{onClick:ze,children:"Print Chỉ Thị"}),e.jsx("button",{onClick:()=>{se(!ht)},children:"Close"})]}),e.jsx("div",{className:"ycsxrender",ref:Ve,children:Rt})]})]})}),e.jsx("div",{className:"chithidiv",children:e.jsx("div",{className:"planlist",children:e.jsx(ve,{sx:{fontSize:12,flex:1},components:{Toolbar:Nt,LoadingOverlay:me},loading:k,rowHeight:30,rows:p,columns:tt,rowsPerPageOptions:[5,10,50,100,500,1e3,5e3,1e4,5e5],disableSelectionOnClick:!0,checkboxSelection:!0,editMode:"cell",getRowId:n=>n.PLAN_ID,onSelectionModelChange:n=>{Ft(n)},onCellEditCommit:Et,onRowClick:lt})})})]})]})})};const on=()=>{const[C,V]=d.useState(0),[f,w]=d.useState(0),[p,F]=d.useState({tab1:!0,tab2:!1,tab3:!1,tabycsx:!1,tabbanve:!1}),[T,k]=d.useState({FACTORY:"",EQ1:"",EQ2:"",Setting1:0,Setting2:0,UPH1:0,UPH2:0,Step1:0,Step2:0,LOSS_SX1:0,LOSS_SX2:0,LOSS_SETTING1:0,LOSS_SETTING2:0,NOTE:""}),[ce,Ne]=d.useState([]),[ke,I]=d.useState([]),[ne,z]=d.useState([]),[Ee,ae]=d.useState([]);d.useState([]);const[Y,Le]=d.useState(!0),[he,Ce]=d.useState([]),[ge,Z]=d.useState([]),[de,S]=d.useState([]),[K,ee]=d.useState([]),[X,A]=d.useState([]),[L,g]=d.useState([]);d.useState(!1);const[ie,Oe]=d.useState(!1),M=ft(l=>l.totalSlice.userData),[y,He]=d.useState(!1),[H,Ze]=d.useState(q().format("YYYY-MM-DD")),[Fe,at]=d.useState(q().format("YYYY-MM-DD")),[We,it]=d.useState(""),[et,Ke]=d.useState(""),[Q,te]=d.useState(""),[Rt,Yt]=d.useState(""),[pt,Lt]=d.useState(""),[gt,Qt]=d.useState(""),[At,Kt]=d.useState(!1),[jt,st]=d.useState("00"),[ht,se]=d.useState(""),[ue,De]=d.useState([]),[W,Ie]=d.useState([]),[R,Bt]=d.useState([]),[_t,wt]=d.useState([]),[Ve,ze]=d.useState([]),[Se,tt]=d.useState([]),[Pt,mt]=d.useState(!1),[qe,Ut]=d.useState(!1),[bt,rt]=d.useState(),[fe,It]=d.useState(),[yt,Me]=d.useState(),[Re,$e]=d.useState("FR01"),[Ae,je]=d.useState("NM1"),[vt,r]=d.useState(q().format("YYYY-MM-DD")),[ot,St]=d.useState(!1),[Tt,Nt]=d.useState(!1),[Ye,Ft]=d.useState(!0),[pe,lt]=d.useState(!0),Et=d.useRef(null),n=Ul.useReactToPrint({content:()=>Et.current}),_=[{field:"G_CODE",headerName:"G_CODE",width:80},{field:"G_NAME",headerName:"G_NAME",width:250,renderCell:l=>l.row.PDBV==="P"||l.row.PDBV===null?e.jsx("span",{style:{color:"red"},children:l.row.G_NAME}):e.jsx("span",{style:{color:"green"},children:l.row.G_NAME})},{field:"EMPL_NAME",headerName:"PIC KD",width:150},{field:"CUST_NAME_KD",headerName:"KHÁCH",width:120},{field:"PROD_REQUEST_NO",headerName:"SỐ YCSX",width:80},{field:"PROD_REQUEST_DATE",headerName:"NGÀY YCSX",width:80},{field:"PROD_REQUEST_QTY",type:"number",headerName:"SL YCSX",width:80,renderCell:l=>e.jsx("span",{style:{color:"#009933"},children:e.jsx("b",{children:l.row.PROD_REQUEST_QTY.toLocaleString("en-US")})})},{field:"LOT_TOTAL_INPUT_QTY_EA",type:"number",headerName:"NHẬP KIỂM",width:80,renderCell:l=>e.jsx("span",{style:{color:"#cc0099"},children:e.jsx("b",{children:l.row.LOT_TOTAL_INPUT_QTY_EA.toLocaleString("en-US")})})},{field:"LOT_TOTAL_OUTPUT_QTY_EA",type:"number",headerName:"XUẤT KIỂM",width:80,renderCell:l=>e.jsx("span",{style:{color:"#cc0099"},children:e.jsx("b",{children:l.row.LOT_TOTAL_OUTPUT_QTY_EA.toLocaleString("en-US")})})},{field:"SHORTAGE_YCSX",type:"number",headerName:"TỒN YCSX",width:80,renderCell:l=>e.jsx("span",{style:{color:"blue"},children:e.jsx("b",{children:l.row.SHORTAGE_YCSX.toLocaleString("en-US")})})},{field:"PHAN_LOAI",headerName:"PHAN_LOAI",width:80,renderCell:l=>{if(l.row.PHAN_LOAI==="01")return e.jsx("span",{style:{color:"black"},children:e.jsx("b",{children:"Thông thường"})});if(l.row.PHAN_LOAI==="02")return e.jsx("span",{style:{color:"black"},children:e.jsx("b",{children:"SDI"})});if(l.row.PHAN_LOAI==="03")return e.jsx("span",{style:{color:"black"},children:e.jsx("b",{children:"GC"})});if(l.row.PHAN_LOAI==="04")return e.jsx("span",{style:{color:"black"},children:e.jsx("b",{children:"SAMPLE"})})}},{field:"REMARK",headerName:"REMARK",width:120},{field:"PDUYET",headerName:"PDUYET",width:80,renderCell:l=>l.row.PDUYET===1?e.jsx("span",{style:{color:"green"},children:e.jsx("b",{children:"Đã Duyệt"})}):e.jsx("span",{style:{color:"red"},children:e.jsx("b",{children:"Không Duyệt"})})},{field:"BANVE",headerName:"BANVE",width:250,renderCell:l=>{let c=null,i="http://14.160.33.94:5011/upload";const O=async t=>{console.log(c);const a=new FormData;if(a.append("banve",c),a.append("filename",l.row.G_CODE),(M==null?void 0:M.MAINDEPTNAME)==="KD")try{const s=await pl.post(i,a);s.data.tk_status==="OK"?x("update_banve_value",{G_CODE:l.row.G_CODE,banvevalue:"Y"}).then(o=>{if(o.data.tk_status!=="NG"){h.fire("Thông báo","Upload bản vẽ thành công","success");let P=ue.map((E,G)=>E.PROD_REQUEST_NO===l.row.PROD_REQUEST_NO?{...E,BANVE:"Y"}:E);De(P)}else h.fire("Thông báo","Upload bản vẽ thất bại","error")}).catch(o=>{console.log(o)}):h.fire("Thông báo",s.data.message,"error")}catch(s){console.log(s)}else h.fire("Thông báo","Chỉ bộ phận kinh doanh upload được bản vẽ","error")};let D="/banve/"+l.row.G_CODE+".pdf";return l.row.BANVE==="Y"?e.jsx("span",{style:{color:"green"},children:e.jsx("b",{children:e.jsx("a",{target:"_blank",rel:"noopener noreferrer",href:D,children:"LINK"})})}):e.jsxs("div",{className:"uploadfile",children:[e.jsxs(b,{className:"buttonIcon",onClick:O,children:[e.jsx(Rl,{color:"yellow",size:25}),"Upload"]}),e.jsx("input",{accept:".pdf",type:"file",onChange:t=>{c=t.target.files[0],console.log(c)}})]})}},{field:"PDBV",headerName:"PD BANVE",width:80,renderCell:l=>l.row.PDBV==="P"||l.row.PDBV===null?e.jsx("span",{style:{color:"red"},children:e.jsx("b",{children:"PENDING"})}):e.jsx("span",{style:{color:"green"},children:e.jsx("b",{children:"APPROVED"})})},{field:"",headerName:"G_NAME",width:250,renderCell:l=>l.row.PDBV==="P"||l.row.PDBV===null?e.jsx("span",{style:{color:"red"},children:l.row.G_NAME}):e.jsx("span",{style:{color:"green"},children:l.row.G_NAME})},{field:"PO_BALANCE",headerName:"PO_BALANCE",width:110,renderCell:l=>e.jsx("span",{style:{color:"blue"},children:e.jsx("b",{children:l.row.PO_BALANCE.toLocaleString("en","US")})})},{field:"EQ1",headerName:"EQ1",width:80,renderCell:l=>e.jsx("span",{style:{color:"black"},children:l.row.EQ1})},{field:"EQ2",headerName:"EQ2",width:80,renderCell:l=>e.jsx("span",{style:{color:"black"},children:l.row.EQ2})},{field:"CD1",headerName:"XUAT_CD1",width:100,renderCell:l=>e.jsx("span",{style:{color:"blue"},children:e.jsx("b",{children:l.row.CD1.toLocaleString("en","US")})})},{field:"CD2",headerName:"XUAT_CD2",width:100,renderCell:l=>e.jsx("span",{style:{color:"blue"},children:e.jsx("b",{children:l.row.CD2.toLocaleString("en","US")})})},{field:"LOT_TOTAL_OUTPUT_QTY_EA",type:"number",headerName:"XUẤT KIỂM",width:100,renderCell:l=>e.jsx("span",{style:{color:"#cc0099"},children:e.jsx("b",{children:l.row.LOT_TOTAL_OUTPUT_QTY_EA.toLocaleString("en-US")})})},{field:"CD_IN",headerName:"CD_IN",width:80,renderCell:l=>e.jsx("span",{style:{color:"gray"},children:e.jsx("b",{children:l.row.CD_IN.toLocaleString("en","US")})})},{field:"CD_DIECUT",headerName:"CD_DIECUT",width:80,renderCell:l=>e.jsx("span",{style:{color:"gray"},children:e.jsx("b",{children:l.row.CD_DIECUT.toLocaleString("en","US")})})},{field:"TON_CD1",headerName:"TONYCSX_CD1",width:120,renderCell:l=>e.jsx("span",{style:{color:"red"},children:e.jsx("b",{children:l.row.TON_CD1.toLocaleString("en","US")})})},{field:"TON_CD2",headerName:"TONYCSX_CD2",width:120,renderCell:l=>e.jsx("span",{style:{color:"red"},children:e.jsx("b",{children:l.row.TON_CD2.toLocaleString("en","US")})})},{field:"INSPECT_BALANCE",type:"number",headerName:"TỒN KIỂM",width:80,renderCell:l=>e.jsx("span",{style:{color:"#cc0099"},children:e.jsx("b",{children:l.row.INSPECT_BALANCE.toLocaleString("en-US")})})},{field:"YCSX_PENDING",headerName:"YCSX_PENDING",width:80,renderCell:l=>l.row.YCSX_PENDING===1?e.jsx("span",{style:{color:"red"},children:e.jsx("b",{children:"PENDING"})}):e.jsx("span",{style:{color:"green"},children:e.jsx("b",{children:"CLOSED"})})}],u=[{field:"PLAN_ID",headerName:"PLAN_ID",width:90,editable:!1,resizeable:!0,renderCell:l=>l.row.DKXL===null?e.jsx("span",{style:{color:"red"},children:l.row.PLAN_ID}):e.jsx("span",{style:{color:"green"},children:l.row.PLAN_ID})},{field:"G_CODE",headerName:"G_CODE",width:100,editable:!1},{field:"G_NAME_KD",headerName:"G_NAME_KD",width:180,editable:!1,renderCell:l=>l.row.FACTORY===null||l.row.EQ1===null||l.row.EQ2===null||l.row.Setting1===null||l.row.Setting2===null||l.row.UPH1===null||l.row.UPH2===null||l.row.Step1===null||l.row.Step1===null||l.row.LOSS_SX1===null||l.row.LOSS_SX2===null||l.row.LOSS_SETTING1===null||l.row.LOSS_SETTING2===null?e.jsx("span",{style:{color:"red"},children:l.row.G_NAME_KD}):e.jsx("span",{style:{color:"green"},children:l.row.G_NAME_KD})},{field:"PROD_REQUEST_QTY",headerName:"YCSX QTY",width:80,editable:!1,renderCell:l=>e.jsx("span",{style:{color:"blue"},children:l.row.PROD_REQUEST_QTY.toLocaleString("en","US")})},{field:"CD1",headerName:"KQ_CD1",width:80,editable:!1,renderCell:l=>e.jsx("span",{style:{color:"blue"},children:l.row.CD1.toLocaleString("en","US")})},{field:"CD2",headerName:"KQ_CD2",width:80,editable:!1,renderCell:l=>e.jsx("span",{style:{color:"blue"},children:l.row.CD2.toLocaleString("en","US")})},{field:"TON_CD1",headerName:"TONYCSX_CD1",width:120,editable:!1,renderCell:l=>e.jsx("span",{style:{color:"blue"},children:l.row.TON_CD1.toLocaleString("en","US")})},{field:"TON_CD2",headerName:"TONYCSX_CD2",width:120,editable:!1,renderCell:l=>e.jsx("span",{style:{color:"blue"},children:l.row.TON_CD2.toLocaleString("en","US")})},{field:"PLAN_QTY",headerName:"PLAN_QTY",width:80,editable:Ye,renderCell:l=>l.row.PLAN_QTY===0?e.jsx("span",{style:{color:"red"},children:"NG"}):e.jsx("span",{style:{color:"green"},children:l.row.PLAN_QTY.toLocaleString("en","US")})},{field:"PROCESS_NUMBER",headerName:"PROCESS_NUMBER",width:110,editable:Ye,renderCell:l=>l.row.PROCESS_NUMBER===null||l.row.PROCESS_NUMBER===0?e.jsx("span",{style:{color:"red"},children:"NG"}):e.jsx("span",{style:{color:"green"},children:l.row.PROCESS_NUMBER})},{field:"STEP",headerName:"STEP",width:60,editable:Ye},{field:"PLAN_ORDER",headerName:"PLAN_ORDER",width:110,editable:Ye},{field:"KETQUASX",headerName:"KETQUASX",width:110,editable:Ye,renderCell:l=>l.row.KETQUASX!==null?e.jsx("span",{children:l.row.KETQUASX.toLocaleString("en-US")}):e.jsx("span",{children:"0"})},{field:"KQ_SX_TAM",headerName:"KETQUASX_TAM",width:120,editable:Ye,renderCell:l=>l.row.KQ_SX_TAM!==null?e.jsx("span",{children:l.row.KQ_SX_TAM.toLocaleString("en-US")}):e.jsx("span",{children:"0"})},{field:"PLAN_EQ",headerName:"PLAN_EQ",width:80,editable:Ye},{field:"PLAN_FACTORY",headerName:"FACTORY",width:80,editable:!1},{field:"PLAN_DATE",headerName:"PLAN_DATE",width:110,editable:!1},{field:"PROD_REQUEST_NO",headerName:"YCSX NO",width:80,editable:!1},{field:"PROD_REQUEST_DATE",headerName:"YCSX DATE",width:80,editable:!1},{field:"NEXT_PLAN_ID",headerName:"NEXT_PLAN_ID",width:120,editable:!0},{field:"INS_EMPL",headerName:"INS_EMPL",width:120,editable:!1,hide:!0},{field:"INS_DATE",headerName:"INS_DATE",width:120,editable:!1,hide:!0},{field:"UPD_EMPL",headerName:"UPD_EMPL",width:120,editable:!1,hide:!0},{field:"UPD_DATE",headerName:"UPD_DATE",width:120,editable:!1,hide:!0}],j=[{field:"CHITHI_ID",headerName:"CHITHI_ID",width:90,editable:!1},{field:"PLAN_ID",headerName:"PLAN_ID",width:90,editable:!1},{field:"M_CODE",headerName:"M_CODE",width:80,editable:!1},{field:"M_NAME",headerName:"M_NAME",width:120,editable:!1,renderCell:l=>l.row.LIEUQL_SX===1?e.jsx("span",{style:{color:"red",fontWeight:"bold"},children:l.row.M_NAME}):e.jsx("span",{style:{color:"black"},children:l.row.M_NAME})},{field:"WIDTH_CD",headerName:"SIZE",width:80,editable:!1},{field:"M_MET_QTY",headerName:"M_MET_QTY",width:110,editable:pe,renderCell:l=>l.row.M_MET_QTY===0?e.jsx("span",{style:{color:"red"},children:"NG"}):e.jsx("span",{style:{color:"green"},children:l.row.M_MET_QTY})},{field:"M_QTY",headerName:"M_QTY",width:110,editable:pe},{field:"LIEUQL_SX",headerName:"LIEUQL_SX",width:110,editable:pe},{field:"OUT_KHO_SX",headerName:"OUT_KHO_SX",width:110,editable:pe,renderCell:l=>e.jsx("p",{style:{color:"blue",fontWeight:"bold"},children:l.row.OUT_KHO_SX!==null?l.row.OUT_KHO_SX.toLocaleString("en","US"):0})},{field:"OUT_CFM_QTY",headerName:"OUT_KHO_THAT",width:110,editable:pe},{field:"INS_EMPL",headerName:"INS_EMPL",width:120,editable:!1,hide:!0},{field:"INS_DATE",headerName:"INS_DATE",width:120,editable:pe,hide:!0},{field:"UPD_EMPL",headerName:"UPD_EMPL",width:120,editable:!1,hide:!0},{field:"UPD_DATE",headerName:"UPD_DATE",width:120,editable:!1,hide:!0}],N=[{field:"FACTORY",headerName:"NM",width:40,editable:!1},{field:"PLAN_ID_INPUT",headerName:"PLAN_ID",width:80,editable:!1},{field:"PHANLOAI",headerName:"PL",width:40,editable:!1},{field:"M_CODE",headerName:"M_CODE",width:80,editable:!1},{field:"M_NAME",headerName:"M_NAME",width:120,editable:!1,renderCell:l=>l.row.LIEUQL_SX===1?e.jsx("span",{style:{color:"red",fontWeight:"bold"},children:l.row.M_NAME}):e.jsx("span",{style:{color:"black"},children:l.row.M_NAME})},{field:"WIDTH_CD",headerName:"SIZE",width:30,editable:!1},{field:"M_LOT_NO",headerName:"M_LOT_NO",width:90,editable:!1},{field:"ROLL_QTY",headerName:"ROLL_QTY",width:70,editable:!1,renderCell:l=>l.row.PHANLOAI!=="F"?e.jsx("span",{style:{color:"green"},children:l.row.ROLL_QTY.toLocaleString("en","US")}):e.jsx("span",{style:{color:"red",fontWeight:"bold"},children:l.row.ROLL_QTY.toLocaleString("en","US")})},{field:"IN_QTY",headerName:"IN_QTY",width:70,editable:!1,renderCell:l=>l.row.PHANLOAI!=="F"?e.jsx("span",{style:{color:"green"},children:l.row.IN_QTY.toLocaleString("en","US")}):e.jsx("span",{style:{color:"red",fontWeight:"bold"},children:l.row.IN_QTY.toLocaleString("en","US")})},{field:"TOTAL_IN_QTY",headerName:"TOTAL_IN_QTY",width:70,editable:!1,renderCell:l=>l.row.PHANLOAI!=="F"?e.jsx("span",{style:{color:"green"},children:l.row.TOTAL_IN_QTY.toLocaleString("en","US")}):e.jsx("span",{style:{color:"red",fontWeight:"bold"},children:l.row.TOTAL_IN_QTY.toLocaleString("en","US")})}],re=[{field:"FACTORY",headerName:"NM",width:40},{field:"PHANLOAI",headerName:"PL",width:30},{field:"M_CODE",headerName:"M_CODE",width:80},{field:"M_NAME",headerName:"M_NAME",width:120},{field:"WIDTH_CD",headerName:"SIZE",width:30},{field:"M_LOT_NO",headerName:"M_LOT_NO",width:90},{field:"PLAN_ID_INPUT",headerName:"PLAN_ID",width:80},{field:"ROLL_QTY",headerName:"ROLLQTY",width:70},{field:"IN_QTY",headerName:"IN_QTY",width:80},{field:"TOTAL_IN_QTY",headerName:"TOTAL",width:80},{field:"INS_DATE",headerName:"INS_DATE",width:150}],$=[{field:"FACTORY",headerName:"NM",width:40},{field:"PHANLOAI",headerName:"PL",width:30},{field:"M_CODE",headerName:"M_CODE",width:80},{field:"M_NAME",headerName:"M_NAME",width:120},{field:"WIDTH_CD",headerName:"SIZE",width:30},{field:"M_LOT_NO",headerName:"M_LOT_NO",width:90},{field:"PLAN_ID_INPUT",headerName:"PLAN_ID_IN",width:90},{field:"PLAN_ID_OUTPUT",headerName:"PLAN_ID_OUT",width:90},{field:"ROLL_QTY",headerName:"ROLL_QTY",width:80},{field:"OUT_QTY",headerName:"OUT_QTY",width:80},{field:"TOTAL_OUT_QTY",headerName:"TOTAL",width:80},{field:"INS_DATE",headerName:"INS_DATE",width:150}],Te=[{field:"PLAN_ID",headerName:"PLAN_ID",width:80},{field:"M_CODE",headerName:"M_CODE",width:80},{field:"M_NAME",headerName:"M_NAME",width:120},{field:"WIDTH_CD",headerName:"SIZE",width:40},{field:"M_LOT_NO",headerName:"M_LOT_NO",width:90},{field:"INPUT_QTY",headerName:"INPUT_QTY",width:120},{field:"USED_QTY",headerName:"USED_QTY",width:80},{field:"REMAIN_QTY",headerName:"REMAIN_QTY",width:90,editable:!0},{field:"EMPL_NO",headerName:"EMPL_NO",width:80},{field:"EQUIPMENT_CD",headerName:"MAY",width:40},{field:"INS_DATE",headerName:"INS_DATE",width:150}],oe=l=>{x("lichsuinputlieusanxuat",{PLAN_ID:l}).then(c=>{if(console.log(c.data.data),c.data.tk_status!=="NG"){const i=c.data.data.map((O,D)=>({...O,INS_DATE:q(O.INS_DATE).utc().format("YYYY-MM-DD HH:mm:ss"),id:D}));S(i)}}).catch(c=>{console.log(c)})},ct=()=>{x("lichsunhapkhoao",{}).then(l=>{if(l.data.tk_status!=="NG"){const c=l.data.data.map((i,O)=>({...i,INS_DATE:q(i.INS_DATE).utc().format("YYYY-MM-DD HH:mm:ss"),id:O}));ae(c)}else ae([])}).catch(l=>{console.log(l)})},be=()=>{x("lichsuxuatkhoao",{}).then(l=>{if(l.data.tk_status!=="NG"){const c=l.data.data.map((i,O)=>({...i,INS_DATE:q(i.INS_DATE).utc().format("YYYY-MM-DD HH:mm:ss"),id:O}));Ce(c)}else Ce([])}).catch(l=>{console.log(l)})},ut=async()=>{if(R.length>0)if(Se.length>0){let l="0";for(let c=0;c<Se.length;c++){let i=!0;await x("checkM_CODE_CHITHI",{PLAN_ID_OUTPUT:R[0].PLAN_ID,M_CODE:Se[c].M_CODE}).then(O=>{console.log(O.data.data),O.data.tk_status!=="NG"?i=!0:i=!1}).catch(O=>{console.log(O)}),i===!0?await x("xuatkhoao",{FACTORY:Se[c].FACTORY,PHANLOAI:"N",PLAN_ID_INPUT:Se[c].PLAN_ID_INPUT,PLAN_ID_OUTPUT:R[0].PLAN_ID,M_CODE:Se[c].M_CODE,M_LOT_NO:Se[c].M_LOT_NO,ROLL_QTY:Se[c].ROLL_QTY,OUT_QTY:Se[c].IN_QTY,TOTAL_OUT_QTY:Se[c].TOTAL_IN_QTY,USE_YN:"O"}).then(O=>{console.log(O.data.tk_status),O.data.tk_status!=="NG"?(console.log("set yes no"),x("setUSE_YN_KHO_AO_INPUT",{FACTORY:Se[c].FACTORY,PHANLOAI:Se[c].PHANLOAI,PLAN_ID_INPUT:Se[c].PLAN_ID_INPUT,M_CODE:Se[c].M_CODE,M_LOT_NO:Se[c].M_LOT_NO,TOTAL_IN_QTY:Se[c].TOTAL_IN_QTY,USE_YN:"O"}).then(D=>{console.log(D.data),D.data.tk_status}).catch(D=>{console.log(D)})):l+="| "+O.data.message}).catch(O=>{console.log(O)}):l+="| Liệu: "+Se[c].M_NAME+` chưa được đăng ký xuất liệu 
 Đã xuất các liệu hợp lệ`}l!=="0"&&h.fire("Thông báo","Có lỗi: "+l,"error"),tt([]),Wt(),be(),oe(R[0].PLAN_ID),Ne([])}else h.fire("Thông báo","Chọn ít nhất 1 liệu để xuất kho","error")},Wt=()=>{x("checktonlieutrongxuong",{}).then(l=>{if(l.data.tk_status!=="NG"){const c=l.data.data.map((i,O)=>({...i,id:O}));ze(c)}else ze([])}).catch(l=>{console.log(l)})},ol=async()=>{if(R.length>=1)if((M==null?void 0:M.EMPL_NO)==="NHU1903"||(M==null?void 0:M.MAINDEPTNAME)==="QLSX"){let l="0";console.log(T),T.FACTORY==="NA"||T.EQ1==="NA"||T.EQ1==="NO"||T.EQ2===""||T.Setting1===0||T.UPH1===0||T.Step1===0||T.LOSS_SX1===0?h.fire("Thông báo","Lưu thất bại, hãy nhập đủ thông tin","error"):(x("saveQLSX",{G_CODE:R[0].G_CODE,FACTORY:T.FACTORY,EQ1:T.EQ1,EQ2:T.EQ2,Setting1:T.Setting1,Setting2:T.Setting2,UPH1:T.UPH1,UPH2:T.UPH2,Step1:T.Step1,Step2:T.Step2,LOSS_SX1:T.LOSS_SX1,LOSS_SX2:T.LOSS_SX2,LOSS_SETTING1:T.LOSS_SETTING1,LOSS_SETTING2:T.LOSS_SETTING2,NOTE:T.NOTE}).then(c=>{console.log(c.data.tk_status),c.data.tk_status!=="NG"||(l="1")}).catch(c=>{console.log(c)}),l==="1"?h.fire("Thông báo","Lưu thất bại, không được để trống ô cần thiết","error"):(nt(R[0].PROD_REQUEST_NO),h.fire("Thông báo","Lưu thành công","success")))}else h.fire("Thông báo","Không đủ quyền hạn!","error");else h.fire("Thông báo","Chọn ít nhất 1 G_CODE để SET !","error")},Zt=l=>l.map((c,i)=>e.jsx(vl,{PLAN_ID:c.PLAN_ID,PLAN_DATE:c.PLAN_DATE,PROD_REQUEST_NO:c.PROD_REQUEST_NO,PLAN_QTY:c.PLAN_QTY,PLAN_EQ:c.PLAN_EQ,PLAN_FACTORY:c.PLAN_FACTORY,PLAN_LEADTIME:c.PLAN_LEADTIME,G_CODE:c.G_CODE,G_NAME:c.G_NAME,G_NAME_KD:c.G_NAME_KD,PROD_REQUEST_DATE:c.PROD_REQUEST_DATE,PROD_REQUEST_QTY:c.PROD_REQUEST_QTY,STEP:c.STEP,PLAN_ORDER:c.PLAN_ORDER},i)),el=l=>l.map((c,i)=>e.jsx(yl,{PLAN_ID:c.PLAN_ID,PLAN_DATE:c.PLAN_DATE,PROD_REQUEST_NO:c.PROD_REQUEST_NO,PLAN_QTY:c.PLAN_QTY,PLAN_EQ:c.PLAN_EQ,PLAN_FACTORY:c.PLAN_FACTORY,PLAN_LEADTIME:c.PLAN_LEADTIME,G_CODE:c.G_CODE,G_NAME:c.G_NAME,G_NAME_KD:c.G_NAME_KD,PROD_REQUEST_DATE:c.PROD_REQUEST_DATE,PROD_REQUEST_QTY:c.PROD_REQUEST_QTY,STEP:c.STEP,PLAN_ORDER:c.PLAN_ORDER},i)),Vt=l=>l.map((c,i)=>e.jsx(wl,{PROD_REQUEST_NO:c.PROD_REQUEST_NO,G_CODE:c.G_CODE,PO_TDYCSX:c.PO_TDYCSX,TOTAL_TKHO_TDYCSX:c.TOTAL_TKHO_TDYCSX,TKHO_TDYCSX:c.TKHO_TDYCSX,BTP_TDYCSX:c.BTP_TDYCSX,CK_TDYCSX:c.CK_TDYCSX,BLOCK_TDYCSX:c.BLOCK_TDYCSX,FCST_TDYCSX:c.FCST_TDYCSX,PDBV:c.PDBV,PDBV_EMPL:c.PDBV_EMPL,PDBV_DATE:c.PDBV_DATE,DESCR:c.DESCR},i)),zt=l=>l.map((c,i)=>c.BANVE==="Y"?e.jsx(ml,{G_CODE:c.G_CODE,PDBV:c.PDBV,PROD_REQUEST_NO:c.PROD_REQUEST_NO,PDBV_EMPL:c.PDBV_EMPL,PDBV_DATE:c.PDBV_DATE},i):e.jsxs("div",{children:["Code: ",c.G_NAME," : Không có bản vẽ"]})),nt=l=>{x("getqlsxplan_table",{PROD_REQUEST_NO:l}).then(c=>{if(c.data.tk_status!=="NG"){let i=c.data.data.map((O,D)=>({...O,PLAN_DATE:q.utc(O.PLAN_DATE).format("YYYY-MM-DD"),id:D}));A(i)}else A([]),h.fire("Thông báo","Nội dung: "+c.data.message,"error")}).catch(c=>{console.log(c)})},Xt=async(l,c,i,O)=>{let D=0,t=0,a=0,s=0,o=0,P=0,E=0,G=0,v=0,m=0;await x("getcodefullinfo",{G_CODE:c}).then(U=>{U.data.tk_status!=="NG"&&(D=U.data.data[0].PD,t=U.data.data[0].G_C_R,a=U.data.data[0].G_C,s=U.data.data[0].LOSS_SX1===null?0:U.data.data[0].LOSS_SX1,o=U.data.data[0].LOSS_SX2===null?0:U.data.data[0].LOSS_SX2,P=U.data.data[0].LOSS_SETTING1===null?0:U.data.data[0].LOSS_SETTING1,E=U.data.data[0].LOSS_SETTING2===null?0:U.data.data[0].LOSS_SETTING2,G=O===1?s:o,v=O===1?Y?P:0:Y?E:0)}).catch(U=>{console.log(U)}),V(D),w(t*a),x("getchithidatatable",{PLAN_ID:l}).then(U=>{U.data.tk_status!=="NG"?g(U.data.data):(m=parseInt((i*D/(a*t)/1e3).toString()),x("getbomsx",{G_CODE:c}).then(B=>{if(B.data.tk_status!=="NG"){const dt=B.data.data.map((J,xt)=>({CHITHI_ID:"NEW"+xt,PLAN_ID:l,M_CODE:J.M_CODE,M_NAME:J.M_NAME,WIDTH_CD:J.WIDTH_CD,M_ROLL_QTY:0,M_MET_QTY:parseInt(""+(m+m*G/100+v)),M_QTY:J.M_QTY,LIEUQL_SX:J.LIEUQL_SX,MAIN_M:J.MAIN_M,OUT_KHO_SX:0,OUT_KHO_THAT:0,INS_EMPL:"",INS_DATE:"",UPD_EMPL:"",UPD_DATE:"",id:xt}));g(dt)}else g([])}).catch(B=>{console.log(B)}))}).catch(U=>{console.log(U)})},tl=async()=>{if(R.length>0){let l=0,c=0,i=0,O=R[0].PLAN_QTY,D=R[0].PROCESS_NUMBER,t=0,a=0,s=0,o=0,P=0,E=0,G=0;await x("getcodefullinfo",{G_CODE:R[0].G_CODE}).then(v=>{v.data.tk_status!=="NG"&&(l=v.data.data[0].PD,c=v.data.data[0].G_C_R,i=v.data.data[0].G_C,t=v.data.data[0].LOSS_SX1===null?0:v.data.data[0].LOSS_SX1,a=v.data.data[0].LOSS_SX2===null?0:v.data.data[0].LOSS_SX2,s=v.data.data[0].LOSS_SETTING1===null?0:v.data.data[0].LOSS_SETTING1,o=v.data.data[0].LOSS_SETTING2===null?0:v.data.data[0].LOSS_SETTING2,P=D===1?t:a,E=D===1?Y?s:0:Y?o:0)}).catch(v=>{console.log(v)}),V(l),w(c*i),G=parseInt((O*l/(i*c)/1e3).toString()),await x("getbomsx",{G_CODE:R[0].G_CODE}).then(v=>{if(console.log(v.data.tk_status),v.data.tk_status!=="NG"){const m=v.data.data.map((U,B)=>({CHITHI_ID:B,PLAN_ID:R[0].PLAN_ID,M_CODE:U.M_CODE,M_NAME:U.M_NAME,WIDTH_CD:U.WIDTH_CD,M_ROLL_QTY:0,M_MET_QTY:parseInt(""+(G+G*P/100+E)),M_QTY:U.M_QTY,LIEUQL_SX:U.LIEUQL_SX,MAIN_M:U.MAIN_M,OUT_KHO_SX:0,OUT_KHO_THAT:0,INS_EMPL:"",INS_DATE:"",UPD_EMPL:"",UPD_DATE:"",id:B}));g(m)}else g([])}).catch(v=>{console.log(v)})}else h.fire("Thông báo","Chọn ít nhất 1 PLAN để RESET Liệu","error")},Qe=()=>{He(!0),x("traYCSXDataFull_QLSX",{alltime:At,start_date:H,end_date:Fe,cust_name:Rt,codeCMS:et,codeKD:We,prod_type:pt,empl_name:Q,phanloai:jt,ycsx_pending:Pt,inspect_inputcheck:qe,prod_request_no:gt,material:ht}).then(l=>{if(l.data.tk_status!=="NG"){const c=l.data.data.map((i,O)=>({...i,PO_TDYCSX:i.PO_TDYCSX===void 0||i.PO_TDYCSX===null?0:i.PO_TDYCSX,TOTAL_TKHO_TDYCSX:i.TOTAL_TKHO_TDYCSX===void 0||i.TOTAL_TKHO_TDYCSX===null?0:i.TOTAL_TKHO_TDYCSX,TKHO_TDYCSX:i.TKHO_TDYCSX===void 0||i.TKHO_TDYCSX===null?0:i.TKHO_TDYCSX,BTP_TDYCSX:i.BTP_TDYCSX===void 0||i.BTP_TDYCSX===null?0:i.BTP_TDYCSX,CK_TDYCSX:i.CK_TDYCSX===void 0||i.CK_TDYCSX===null?0:i.CK_TDYCSX,BLOCK_TDYCSX:i.BLOCK_TDYCSX===void 0||i.BLOCK_TDYCSX===null?0:i.BLOCK_TDYCSX,FCST_TDYCSX:i.FCST_TDYCSX===void 0||i.FCST_TDYCSX===null?0:i.FCST_TDYCSX,W1:i.W1===void 0||i.W1===null?0:i.W1,W2:i.W2===void 0||i.W2===null?0:i.W2,W3:i.W3===void 0||i.W3===null?0:i.W3,W4:i.W4===void 0||i.W4===null?0:i.W4,W5:i.W5===void 0||i.W5===null?0:i.W5,W6:i.W6===void 0||i.W6===null?0:i.W6,W7:i.W7===void 0||i.W7===null?0:i.W7,W8:i.W8===void 0||i.W8===null?0:i.W8,PROD_REQUEST_QTY:i.PROD_REQUEST_QTY===void 0||i.PROD_REQUEST_QTY===null?0:i.PROD_REQUEST_QTY}));De(c),He(!1),h.fire("Thông báo","Đã load "+l.data.data.length+" dòng","success")}else h.fire("Thông báo","Nội dung: "+l.data.message,"error"),He(!1)}).catch(l=>{console.log(l)})},Pe=l=>{l.key==="Enter"&&Qe()},ll=async l=>{if(W.length>=1){let c=!1;for(let i=0;i<W.length;i++)await x("setpending_ycsx",{PROD_REQUEST_NO:W[i].PROD_REQUEST_NO,YCSX_PENDING:l}).then(O=>{console.log(O.data.tk_status),O.data.tk_status!=="NG"||(c=!0)}).catch(O=>{console.log(O)});c?h.fire("Thông báo","Có lỗi SQL: ","error"):h.fire("Thông báo","SET YCSX thành công (chỉ PO của người đăng nhập)!","success")}else h.fire("Thông báo","Chọn ít nhất 1 YCSX để SET !","error")},nl=()=>{h.fire({title:"Chắc chắn muốn SET PENDING YCSX đã chọn ?",text:"Sẽ bắt đầu SET PENDING YCSX đã chọn",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Vẫn Xóa!"}).then(l=>{l.isConfirmed&&(h.fire("Tiến hành SET PENDING","Đang SET PENDING YCSX hàng loạt","success"),ll(1))})},we=()=>{h.fire({title:"Chắc chắn muốn SET CLOSED YCSX đã chọn ?",text:"Sẽ bắt đầu SET CLOSED YCSX đã chọn",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Vẫn Xóa!"}).then(l=>{l.isConfirmed&&(h.fire("Tiến hành SET CLOSED","Đang SET CLOSED YCSX hàng loạt","success"),ll(0))})},al=()=>{h.fire({title:"Chắc chắn muốn xóa PLan đã chọn ?",text:"Sẽ bắt đầu xóa Plan đã chọn",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Vẫn Xóa!"}).then(l=>{l.isConfirmed&&(h.fire("Tiến hành Xóa Plan","Đang xóa Plan","success"),hl())})},cl=()=>{h.fire({title:"Chắc chắn muốn RESET liệu ?",text:"Sẽ bắt đầu RESET liệu",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Vẫn RESET liệu!"}).then(l=>{l.isConfirmed&&(h.fire("Tiến hành RESET liệu","Đang RESET liệu","success"),tl())})},il=()=>{h.fire({title:"Chắc chắn muốn Đăng ký xuất liệu ?",text:"Sẽ bắt đầu ĐK liệu",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Vẫn ĐK liệu!"}).then(l=>{l.isConfirmed&&(h.fire({title:"Đăng ký xuất liệu",text:"Đang đăng ký xuất liệu kho thật, hãy chờ một chút",icon:"info",showCancelButton:!1,allowOutsideClick:!1,confirmButtonText:"OK",showConfirmButton:!1}),R.length>0?(sl(),Xt(R[0].PLAN_ID,R[0].G_CODE,R[0].PLAN_QTY,R[0].PROCESS_NUMBER),bl(R[0].PLAN_ID,R[0].PROD_REQUEST_NO,R[0].PROD_REQUEST_DATE)):h.fire("Thông báo","Chọn ít nhất 1 chỉ thị để đăng ký xuất liệu","error"))})},dl=()=>{h.fire({title:"Chắc chắn muốn xóa Liệu đã chọn ?",text:"Sẽ bắt đầu xóa Liệu đã chọn",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Vẫn Xóa!"}).then(l=>{l.isConfirmed&&(h.fire("Tiến hành Xóa Liệu","Đang xóa Liệu","success"),_l())})},hl=async()=>{if(R.length>0){let l=[...X];for(let c=0;c<R.length;c++)for(let i=0;i<l.length;i++)R[c].id===l[i].id&&x("checkPLANID_O302",{PLAN_ID:R[c].PLAN_ID}).then(O=>{O.data.tk_status!=="NG"||x("deletePlanQLSX",{PLAN_ID:R[c].PLAN_ID}).then(D=>{D.data.tk_status!=="NG"?h.fire("Thông báo","Nội dung: "+D.data.message,"error"):(l.splice(i,1),A(l))}).catch(D=>{console.log(D)})}).catch(O=>{console.log(O)})}else h.fire("Thông báo","Chọn ít nhất một dòng để xóa","error")},_l=()=>{if(_t.length>0){let l=[...L];for(let c=0;c<_t.length;c++)for(let i=0;i<l.length;i++)_t[c].CHITHI_ID===l[i].CHITHI_ID&&l.splice(i,1);g(l)}else h.fire("Thông báo","Chọn ít nhất một dòng để xóa","error")},Sl=async l=>{let c=l,i=1;return await x("getLastestPLAN_ID",{PROD_REQUEST_NO:l}).then(O=>{if(O.data.tk_status!=="NG"){console.log(O.data.data[0].PLAN_ID),console.log("length",O.data.data[0].PLAN_ID.length);let D=O.data.data[0].PLAN_ID;D.substring(7,8)==="Z"?D.substring(3,4)==="0"?c=D.substring(0,3)+"A"+D.substring(4,7)+"A":c=D.substring(0,3)+Be[Be.indexOf(D.substring(3,4))+1]+D.substring(4,7)+"A":c=D.substring(0,7)+Be[Be.indexOf(D.substring(7,8))+1]}else c=l+"A"}).catch(O=>{console.log(O)}),await x("getLastestPLANORDER",{PLAN_DATE:vt,PLAN_EQ:Re,PLAN_FACTORY:Ae}).then(O=>{O.data.tk_status!=="NG"?i=O.data.data[0].PLAN_ORDER+1:i=1}).catch(O=>{console.log(O)}),{NEXT_PLAN_ID:c,NEXT_PLAN_ORDER:i}},Tl=async()=>{if(W.length>=1)for(let l=0;l<W.length;l++){let c=!1;await x("checkProd_request_no_Exist_O302",{PROD_REQUEST_NO:W[l].PROD_REQUEST_NO}).then(t=>{t.data.tk_status!=="NG"&&(t.data.data.length>0?c=!0:c=!1)}).catch(t=>{console.log(t)});let i=await Sl(W[l].PROD_REQUEST_NO),O=i.NEXT_PLAN_ID,D=i.NEXT_PLAN_ORDER;c===!1?await x("addPlanQLSX",{PLAN_ID:O,PLAN_DATE:vt,PROD_REQUEST_NO:W[l].PROD_REQUEST_NO,PLAN_QTY:0,PLAN_EQ:Re,PLAN_FACTORY:Ae,PLAN_LEADTIME:0,STEP:1,PLAN_ORDER:D,PROCESS_NUMBER:0,G_CODE:W[l].G_CODE,NEXT_PLAN_ID:"X"}).then(t=>{console.log(t.data.tk_status),t.data.tk_status!=="NG"&&nt(W[0].PROD_REQUEST_NO)}).catch(t=>{console.log(t)}):h.fire("Thông báo","Yêu cầu sản xuất này đã chạy từ hệ thống cũ, không chạy được lẫn lộn cũ mới, hãy chạy hết bằng hệ thống cũ với yc này","error")}else h.fire("Thông báo","Chọn ít nhất 1 YCSX để Add !","error")},Nl=()=>{let l=X.filter((i,O)=>i.PLAN_EQ===Re&&i.PLAN_FACTORY===Ae),c="0";for(let i=0;i<l.length;i++){let O=!0;l[i].NEXT_PLAN_ID!=="X"&&(l[i].NEXT_PLAN_ID===l[i+1].PLAN_ID?O=!0:O=!1),(parseInt(l[i].PROCESS_NUMBER.toString())===1||parseInt(l[i].PROCESS_NUMBER.toString())===2)&&l[i].PLAN_QTY!==0&&l[i].PLAN_QTY<=l[i].PROD_REQUEST_QTY&&l[i].PLAN_ID!==l[i].NEXT_PLAN_ID&&l[i].CHOTBC!=="V"&&O&&parseInt(l[i].STEP.toString())>=0&&parseInt(l[i].STEP.toString())<=9?x("updatePlanQLSX",{PLAN_ID:l[i].PLAN_ID,STEP:l[i].STEP,PLAN_QTY:l[i].PLAN_QTY,OLD_PLAN_QTY:l[i].PLAN_QTY,PLAN_LEADTIME:l[i].PLAN_LEADTIME,PLAN_EQ:l[i].PLAN_EQ,PLAN_ORDER:l[i].PLAN_ORDER,PROCESS_NUMBER:l[i].PROCESS_NUMBER,KETQUASX:l[i].KETQUASX===null?0:l[i].KETQUASX,NEXT_PLAN_ID:l[i].NEXT_PLAN_ID===null?"X":l[i].NEXT_PLAN_ID}).then(D=>{D.data.tk_status!=="NG"||(c+="_"+D.data.message)}).catch(D=>{console.log(D)}):(c+="_"+l[i].G_NAME_KD+":",parseInt(l[i].PROCESS_NUMBER.toString())===1||parseInt(l[i].PROCESS_NUMBER.toString())===2||(c+="_: Process number chưa đúng"),l[i].PLAN_QTY===0&&(c+="_: Số lượng chỉ thị =0"),l[i].PLAN_QTY>l[i].PROD_REQUEST_QTY&&(c+="_: Số lượng chỉ thị lớn hơn số lượng yêu cầu sx"),l[i].PLAN_ID===l[i].NEXT_PLAN_ID&&(c+="_: NEXT_PLAN_ID không được giống PLAN_ID hiện tại"),O||(c+="_: NEXT_PLAN_ID không giống với PLAN_ID ở dòng tiếp theo"),l[i].CHOTBC==="V"&&(c+="_: Chỉ thị đã chốt báo cáo, sẽ ko sửa được, thông tin các chỉ thị khác trong máy được lưu thành công"),parseInt(l[i].STEP.toString())>=0&&parseInt(l[i].STEP.toString())<=9||(c+="_: Hãy nhập STEP từ 0 -> 9"))}c!=="0"?h.fire("Thông báo","Có lỗi !"+c,"error"):(h.fire("Thông báo","Lưu PLAN thành công","success"),nt(W[0].PROD_REQUEST_NO))},sl=async()=>{let l="0",c=0,i=0,O=1;for(let D=0;D<L.length;D++)c+=L[D].LIEUQL_SX;for(let D=0;D<L.length;D++)if(parseInt(L[D].LIEUQL_SX.toString())===1)for(let t=0;t<L.length;t++)L[t].M_NAME===L[D].M_NAME&&parseInt(L[t].LIEUQL_SX.toString())===0&&(i+=1);for(let D=0;D<L.length;D++)if(L[D].LIEUQL_SX===1)for(let t=0;t<L.length;t++)L[t].LIEUQL_SX===1&&L[D].LIEUQL_SX!==L[t].LIEUQL_SX&&(O=2);if(c>0&&i===0&&O===1){await x("deleteMCODEExistIN_O302",{PLAN_ID:R[0].PLAN_ID}).then(D=>{D.data.tk_status}).catch(D=>{console.log(D)});for(let D=0;D<L.length;D++)if(x("updateLIEUQL_SX_M140",{G_CODE:R[0].G_CODE,M_CODE:L[D].M_CODE,LIEUQL_SX:L[D].LIEUQL_SX}).then(t=>{t.data.tk_status}).catch(t=>{console.log(t)}),L[D].M_MET_QTY>0){let t=!1;await x("checkM_CODE_PLAN_ID_Exist",{PLAN_ID:R[0].PLAN_ID,M_CODE:L[D].M_CODE}).then(a=>{a.data.tk_status!=="NG"&&(t=!0)}).catch(a=>{console.log(a)}),t?x("updateChiThi",{PLAN_ID:R[0].PLAN_ID,M_CODE:L[D].M_CODE,M_ROLL_QTY:L[D].M_ROLL_QTY,M_MET_QTY:L[D].M_MET_QTY,M_QTY:L[D].M_QTY,LIEUQL_SX:L[D].LIEUQL_SX}).then(a=>{a.data.tk_status!=="NG"||(l+="_"+a.data.message)}).catch(a=>{console.log(a)}):x("insertChiThi",{PLAN_ID:R[0].PLAN_ID,M_CODE:L[D].M_CODE,M_ROLL_QTY:L[D].M_ROLL_QTY,M_MET_QTY:L[D].M_MET_QTY,M_QTY:L[D].M_QTY,LIEUQL_SX:L[D].LIEUQL_SX}).then(a=>{a.data.tk_status!=="NG"||(l+="_"+a.data.message)}).catch(a=>{console.log(a)})}else l+="_"+L[D].M_CODE+": so met = 0";l!=="0"?h.fire("Thông báo","Có lỗi !"+l,"error"):(h.fire("Thông báo","Lưu Chỉ thị thành công","success"),nt(W[0].PROD_REQUEST_NO))}else h.fire("Thông báo","Phải chỉ định liệu quản lý, k để sót size nào, và chỉ chọn 1 loại liệu làm liệu chính","error")};function El(){return e.jsxs(Xe,{children:[e.jsxs(b,{className:"buttonIcon",onClick:()=>{Ue(ue,"YCSX Table")},children:[e.jsx(ye,{color:"green",size:25}),"SAVE"]}),e.jsx(Ge,{}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{we()},children:[e.jsx(Ql,{color:"green",size:25}),"SET CLOSED"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{nl()},children:[e.jsx(Yl,{color:"red",size:25}),"SET PENDING"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{W.length>0?(F({...p,tabycsx:W.length>0}),console.log(W),rt(Vt(W))):h.fire("Thông báo","Chọn ít nhất 1 YCSX để in","error")},children:[e.jsx(Je,{color:"#0066ff",size:25}),"Print YCSX"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{W.length>0?(F({...p,tabbanve:W.length>0}),rt(zt(W))):h.fire("Thông báo","Chọn ít nhất 1 YCSX để in","error")},children:[e.jsx(Je,{color:"#ff751a",size:25}),"Print Bản Vẽ"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{W.length>0?Tl():h.fire("Thông báo","Chọn ít nhất 1 YCSX để thêm PLAN","error")},children:[e.jsx($t,{color:"#69f542",size:25}),"Add to PLAN"]})]})}function ul(){return e.jsxs(Xe,{children:[e.jsxs(b,{className:"buttonIcon",onClick:()=>{Ue(X,"Plan Table")},children:[e.jsx(ye,{color:"green",size:25}),"SAVE"]}),e.jsx(Ge,{}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{R.length>0?R[0].FACTORY===null||R[0].EQ1===null||R[0].EQ2===null||R[0].Setting1===null||R[0].Setting2===null||R[0].UPH1===null||R[0].UPH2===null||R[0].Step1===null||R[0].Step1===null||R[0].LOSS_SX1===null||R[0].LOSS_SX2===null||R[0].LOSS_SETTING1===null||R[0].LOSS_SETTING2===null?h.fire("Thông báo","Nhập data định mức trước khi chỉ thị","error"):(St(!0),It(el(R))):(St(!1),h.fire("Thông báo","Chọn ít nhất 1 Plan để in","error"))},children:[e.jsx(Je,{color:"#0066ff",size:25}),"Print Chỉ Thị"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{R.length>0?(Nt(!0),Me(Zt(R))):(Nt(!1),h.fire("Thông báo","Chọn ít nhất 1 Plan để in","error"))},children:[e.jsx(Je,{color:"#9066ff",size:25}),"Print YCKT"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{xe(M==null?void 0:M.EMPL_NO,M==null?void 0:M.MAINDEPTNAME,["QLSX"],Nl)},children:[e.jsx(Dt,{color:"blue",size:20}),"Lưu PLAN"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{xe(M==null?void 0:M.EMPL_NO,M==null?void 0:M.MAINDEPTNAME,["QLSX"],al)},children:[e.jsx(Jt,{color:"yellow",size:20}),"Xóa PLAN"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{nt(W[0].PROD_REQUEST_NO)},children:[e.jsx(Ct,{color:"yellow",size:20}),"Refresh PLAN"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{xe(M==null?void 0:M.EMPL_NO,M==null?void 0:M.MAINDEPTNAME,["QLSX"],ol)},children:[e.jsx(Dt,{color:"lightgreen",size:20}),"Lưu Data Định Mức"]})]})}function xl(){var l,c,i;return e.jsxs(Xe,{children:[e.jsxs(b,{className:"buttonIcon",onClick:()=>{Ue(ue,"YCSX Table")},children:[e.jsx(ye,{color:"green",size:25}),"SAVE"]}),e.jsx(Ge,{}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{L.length>0?(h.fire({title:"Lưu Chỉ thị",text:"Đang lưu chỉ thị, hãy chờ một chút",icon:"info",showCancelButton:!1,allowOutsideClick:!1,confirmButtonText:"OK",showConfirmButton:!1}),xe(M==null?void 0:M.EMPL_NO,M==null?void 0:M.MAINDEPTNAME,["QLSX"],sl)):h.fire("Thông báo","Không có liệu để chỉ thị","error")},children:[e.jsx(Dt,{color:"blue",size:20}),"Lưu chỉ thị"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{xe(M==null?void 0:M.EMPL_NO,M==null?void 0:M.MAINDEPTNAME,["QLSX"],dl)},children:[e.jsx(Jt,{color:"yellow",size:20}),"Xóa Liệu"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{xe(M==null?void 0:M.EMPL_NO,M==null?void 0:M.MAINDEPTNAME,["QLSX"],cl)},children:[e.jsx(kl,{color:"red",size:20}),"RESET Liệu"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{xe(M==null?void 0:M.EMPL_NO,M==null?void 0:M.MAINDEPTNAME,["QLSX"],()=>{R.length>0?(Oe(!ie),Wt(),be(),ct(),oe(R[0].PLAN_ID)):h.fire("Thông báo","Hãy chọn một chỉ thị","error")})},children:[e.jsx(Hl,{color:"blue",size:20}),"Xuất kho ảo"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{xe(M==null?void 0:M.EMPL_NO,M==null?void 0:M.MAINDEPTNAME,["QLSX"],il),il()},children:[e.jsx(Gl,{color:"green",size:20}),"Đăng ký Xuất Kho Thật"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{Xt(R[0].PLAN_ID,R[0].G_CODE,R[0].PLAN_QTY,R[0].PROCESS_NUMBER)},children:[e.jsx(Ct,{color:"yellow",size:20}),"Refresh chỉ thị"]}),e.jsx("span",{style:{fontSize:20,fontWeight:"bold",color:"red"},children:(l=R[0])==null?void 0:l.PLAN_ID})," ","___",e.jsx("span",{style:{fontSize:20,fontWeight:"bold",color:"blue"},children:(c=R[0])==null?void 0:c.G_NAME}),e.jsxs("span",{style:{fontSize:20,fontWeight:"bold",color:"yellow"},children:["___PD:",C]}),e.jsxs("span",{style:{fontSize:20,fontWeight:"bold",color:"green"},children:["___CAVITY:",f]}),e.jsxs("span",{style:{fontSize:20,fontWeight:"bold",color:"white"},children:["___PLAN_QTY:",(i=R[0])==null?void 0:i.PLAN_QTY.toLocaleString("en-US")]}),"Có setting hay không?",e.jsx("input",{type:"checkbox",name:"alltimecheckbox",defaultChecked:Y,onChange:()=>Le(!Y)})]})}function Cl(){return e.jsxs(Xe,{children:[e.jsxs(b,{className:"buttonIcon",onClick:()=>{Ue(ue,"YCSX Table")},children:[e.jsx(ye,{color:"green",size:25}),"SAVE"]}),e.jsx(Ge,{}),e.jsx("div",{className:"div",style:{fontSize:20,fontWeight:"bold"},children:"Tồn kho ảo"}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{ut()},children:[e.jsx(ql,{color:"blue",size:20}),"Xuất kho"]})]})}function Dl(){return e.jsxs(Xe,{children:[e.jsxs(b,{className:"buttonIcon",onClick:()=>{Ue(ue,"YCSX Table")},children:[e.jsx(ye,{color:"green",size:25}),"SAVE"]}),e.jsx(Ge,{}),e.jsx("div",{className:"div",style:{fontSize:20,fontWeight:"bold"},children:"Lịch sử input liệu sản xuất"}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{h.fire("Thông báo","Bên sản xuất sẽ confirm","info")},children:[e.jsx(Dt,{color:"yellow",size:20}),"Lưu tồn liệu"]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{h.fire("Thông báo","Bên sản xuất sẽ confirm","info")},children:[e.jsx($l,{color:"yellow",size:20}),"Nhập lại vào kho ảo"]})]})}function Ol(){return e.jsxs(Xe,{children:[e.jsxs(b,{className:"buttonIcon",onClick:()=>{Ue(ue,"YCSX Table")},children:[e.jsx(ye,{color:"green",size:25}),"SAVE"]}),e.jsx(Ge,{}),e.jsx("div",{className:"div",style:{fontSize:20,fontWeight:"bold"},children:"Lịch sử nhập kho ảo"})]})}function fl(){return e.jsxs(Xe,{children:[e.jsxs(b,{className:"buttonIcon",onClick:()=>{Ue(ue,"YCSX Table")},children:[e.jsx(ye,{color:"green",size:25}),"SAVE"]}),e.jsx(Ge,{}),e.jsx("div",{className:"div",style:{fontSize:20,fontWeight:"bold"},children:"Lịch sử xuất kho ảo"}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{h.fire("Thông báo","Không được phép","error")},children:[e.jsx(Jl,{color:"white",size:20}),"Hủy Xuất"]})]})}const Ll=l=>{const c=new Set(l);let i=ue.filter(O=>c.has(O.PROD_REQUEST_NO));i.length>0?(Ie(i),nt(i[0].PROD_REQUEST_NO)):(Ie([]),console.log("xoa filter"))},gl=l=>{const c=new Set(l);let i=X.filter(O=>c.has(O.PLAN_ID));i.length>0?(Bt(i),k({...T,FACTORY:i[0].FACTORY===null?"":i[0].FACTORY,EQ1:i[0].EQ1===null?"NA":i[0].EQ1===""?"NO":i[0].EQ1,EQ2:i[0].EQ2===null?"NA":i[0].EQ2===""?"NO":i[0].EQ2,Setting1:i[0].Setting1===null?0:i[0].Setting1,Setting2:i[0].Setting2===null?0:i[0].Setting2,UPH1:i[0].UPH1===null?0:i[0].UPH1,UPH2:i[0].UPH2===null?0:i[0].UPH2,Step1:i[0].Step1===null?0:i[0].Step1,Step2:i[0].Step2===null?0:i[0].Step2,LOSS_SX1:i[0].LOSS_SX1===null?0:i[0].LOSS_SX1,LOSS_SX2:i[0].LOSS_SX2===null?0:i[0].LOSS_SX2,LOSS_SETTING1:i[0].LOSS_SETTING1===null?0:i[0].LOSS_SETTING1,LOSS_SETTING2:i[0].LOSS_SETTING2===null?0:i[0].LOSS_SETTING2,NOTE:i[0].NOTE===null?"":i[0].NOTE}),Xt(i[0].PLAN_ID,i[0].G_CODE,i[0].PLAN_QTY,i[0].PROCESS_NUMBER)):(Bt([]),g([]))},Al=l=>{const c=new Set(l);let i=L.filter(O=>c.has(O.CHITHI_ID));i.length>0?wt(i):wt([])},rl=l=>{const c=new Set(l);let i=Ve.filter(O=>c.has(O.id));i.length>0?tt(i):tt([])},qt=l=>{const c=new Set(l);let i=he.filter(O=>c.has(O.id));i.length>0?Z(i):Z([])},jl=l=>{const c=new Set(l);let i=de.filter(O=>c.has(O.id));i.length>0?ee(i):ee([])},Gt=(l,c)=>String(l).padStart(c,"0"),Pl=l=>{x("updateDKXLPLAN",{PLAN_ID:l}).then(c=>{console.log(c.data),c.data.tk_status}).catch(c=>{console.log(c)})},bl=async(l,c,i)=>{let O=!0,D="001",t=q().format("YYYYMMDD");await x("checkPLANID_O300",{PLAN_ID:l}).then(o=>{console.log(o.data),o.data.tk_status!=="NG"?(O=!0,t=o.data.data[0].OUT_DATE):O=!1}).catch(o=>{console.log(o)});let a=0;if(await x("checkPLANID_O301",{PLAN_ID:l}).then(o=>{o.data.tk_status!=="NG"&&(a=parseInt(o.data.data[0].OUT_SEQ))}).catch(o=>{console.log(o)}),console.log("check plan id o300",O),O)await x("getO300_ROW",{PLAN_ID:l}).then(o=>{o.data.tk_status!=="NG"&&(D=Gt(parseInt(o.data.data[0].OUT_NO),3),console.log("nextoutno_o300",D))}).catch(o=>{console.log(o)});else{await x("getO300_LAST_OUT_NO",{}).then(P=>{P.data.tk_status!=="NG"&&(D=Gt(parseInt(P.data.data[0].OUT_NO)+1,3),console.log("nextoutno_o300",D))}).catch(P=>{console.log(P)});let o="";await x("getP400",{PROD_REQUEST_NO:c,PROD_REQUEST_DATE:i}).then(P=>{P.data.tk_status!=="NG"&&(o=P.data.data[0].CODE_50)}).catch(P=>{console.log(P)}),console.log(o),await x("insertO300",{OUT_DATE:t,OUT_NO:D,CODE_03:"01",CODE_52:"01",CODE_50:o,USE_YN:"Y",PROD_REQUEST_DATE:i,PROD_REQUEST_NO:c,FACTORY:Ae,PLAN_ID:l}).then(P=>{P.data.tk_status}).catch(P=>{console.log(P)})}await x("deleteMCODE_O301_Not_ExistIN_O302",{PLAN_ID:l}).then(o=>{o.data.tk_status}).catch(o=>{console.log(o)});let s=0;for(let o=0;o<L.length;o++)s+=L[o].M_MET_QTY;if(s>0){for(let o=0;o<L.length;o++)if(L[o].M_MET_QTY>0){console.log("M_MET",L[o].M_MET_QTY);let P=!1;await x("checkM_CODE_PLAN_ID_Exist_in_O301",{PLAN_ID:l,M_CODE:L[o].M_CODE}).then(E=>{console.log(E.data),E.data.tk_status!=="NG"?P=!0:P=!1}).catch(E=>{console.log(E)}),L[o].LIEUQL_SX===1&&Pl(L[o].PLAN_ID),P?await x("updateO301",{M_CODE:L[o].M_CODE,OUT_PRE_QTY:L[o].M_MET_QTY,PLAN_ID:l}).then(E=>{console.log(E.data),E.data.tk_status}).catch(E=>{console.log(E)}):(console.log("Next Out NO",D),await x("checkPLANID_O301",{PLAN_ID:l}).then(E=>{E.data.tk_status!=="NG"&&(a=parseInt(E.data.data[0].OUT_SEQ))}).catch(E=>{console.log(E)}),console.log("outseq",a),await x("insertO301",{OUT_DATE:t,OUT_NO:D,CODE_03:"01",OUT_SEQ:Gt(a+o+1,3),USE_YN:"Y",M_CODE:L[o].M_CODE,OUT_PRE_QTY:L[o].M_MET_QTY,PLAN_ID:l}).then(E=>{E.data.tk_status}).catch(E=>{console.log(E)}))}}else h.fire("Thông báo","Cần đăng ký ít nhất 1 met lòng")};return d.useEffect(()=>{W.length>0&&nt(W[0].PROD_REQUEST_NO)},[]),e.jsx("div",{className:"tableplan",children:e.jsx("div",{className:"planwindow",children:e.jsxs("div",{className:"content",children:[e.jsx("div",{className:"ycsxlist",children:e.jsxs("div",{className:"tracuuYCSX",children:[e.jsxs("div",{className:"tracuuYCSXform",children:[e.jsxs("div",{className:"forminput",children:[e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"Từ ngày:"}),e.jsx("input",{onKeyDown:l=>{Pe(l)},type:"date",value:H.slice(0,10),onChange:l=>Ze(l.target.value)})]}),e.jsxs("label",{children:[e.jsx("b",{children:"Tới ngày:"})," ",e.jsx("input",{onKeyDown:l=>{Pe(l)},type:"date",value:Fe.slice(0,10),onChange:l=>at(l.target.value)})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"Code KD:"})," ",e.jsx("input",{onKeyDown:l=>{Pe(l)},type:"text",placeholder:"GH63-xxxxxx",value:We,onChange:l=>it(l.target.value)})]}),e.jsxs("label",{children:[e.jsx("b",{children:"Code CMS:"})," ",e.jsx("input",{onKeyDown:l=>{Pe(l)},type:"text",placeholder:"7C123xxx",value:et,onChange:l=>Ke(l.target.value)})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"Tên nhân viên:"})," ",e.jsx("input",{onKeyDown:l=>{Pe(l)},type:"text",placeholder:"Trang",value:Q,onChange:l=>te(l.target.value)})]}),e.jsxs("label",{children:[e.jsx("b",{children:"Khách:"})," ",e.jsx("input",{onKeyDown:l=>{Pe(l)},type:"text",placeholder:"SEVT",value:Rt,onChange:l=>Yt(l.target.value)})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"Loại sản phẩm:"})," ",e.jsx("input",{onKeyDown:l=>{Pe(l)},type:"text",placeholder:"TSP",value:pt,onChange:l=>Lt(l.target.value)})]}),e.jsxs("label",{children:[e.jsx("b",{children:"Số YCSX:"})," ",e.jsx("input",{onKeyDown:l=>{Pe(l)},type:"text",placeholder:"12345",value:gt,onChange:l=>Qt(l.target.value)})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"Phân loại:"}),e.jsxs("select",{name:"phanloai",value:jt,onChange:l=>{st(l.target.value)},children:[e.jsx("option",{value:"00",children:"ALL"}),e.jsx("option",{value:"01",children:"Thông thường"}),e.jsx("option",{value:"02",children:"SDI"}),e.jsx("option",{value:"03",children:"GC"}),e.jsx("option",{value:"04",children:"SAMPLE"}),e.jsx("option",{value:"22",children:"NOT SAMPLE"})]})]}),e.jsxs("label",{children:[e.jsx("b",{children:"Vật liệu:"})," ",e.jsx("input",{onKeyDown:l=>{Pe(l)},type:"text",placeholder:"SJ-203020HC",value:ht,onChange:l=>se(l.target.value)})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"YCSX Pending:"}),e.jsx("input",{onKeyDown:l=>{Pe(l)},type:"checkbox",name:"alltimecheckbox",defaultChecked:Pt,onChange:()=>mt(!Pt)})]}),e.jsxs("label",{children:[e.jsx("b",{children:"Vào kiểm:"}),e.jsx("input",{onKeyDown:l=>{Pe(l)},type:"checkbox",name:"alltimecheckbox",defaultChecked:qe,onChange:()=>Ut(!qe)})]})]})]}),e.jsxs("div",{className:"formbutton",children:[e.jsxs("label",{children:[e.jsx("b",{children:"All Time:"}),e.jsx("input",{type:"checkbox",name:"alltimecheckbox",defaultChecked:At,onChange:()=>Kt(!At)})]}),e.jsxs(b,{className:"buttonIcon",onClick:()=>{Qe()},children:[e.jsx(Ml,{color:"green",size:30}),"Search"]})]})]}),e.jsx("div",{className:"tracuuYCSXTable",children:e.jsx(ve,{sx:{fontSize:12,flex:1},components:{Toolbar:El,LoadingOverlay:me},loading:y,rowHeight:30,rows:ue,columns:_,rowsPerPageOptions:[5,10,50,100,500,1e3,5e3,1e4,5e5],editMode:"row",getRowId:l=>l.PROD_REQUEST_NO,onSelectionModelChange:l=>{Ll(l)}})}),p.tabycsx&&e.jsxs("div",{className:"printycsxpage",children:[e.jsxs("div",{className:"buttongroup",children:[e.jsx(_e,{onClick:()=>{rt(Vt(W))},children:"Render YCSX"}),e.jsx(_e,{onClick:n,children:"Print YCSX"}),e.jsx(_e,{onClick:()=>{F({...p,tabycsx:!1})},children:"Close"})]}),e.jsx("div",{className:"ycsxrender",ref:Et,children:bt})]}),p.tabbanve&&e.jsxs("div",{className:"printycsxpage",children:[e.jsxs("div",{className:"buttongroup",children:[e.jsx(_e,{onClick:()=>{rt(zt(W))},children:"Render Bản Vẽ"}),e.jsx(_e,{onClick:n,children:"Print Bản Vẽ"}),e.jsx(_e,{onClick:()=>{F({...p,tabbanve:!1})},children:"Close"})]}),e.jsx("div",{className:"ycsxrender",ref:Et,children:bt})]}),ie&&e.jsxs("div",{className:"khoaodiv",children:[e.jsxs("div",{className:"khoaotieude",style:{fontSize:25,fontWeight:"bold"},children:["KHO ẢO",e.jsx(_e,{onClick:()=>{Oe(!ie)},children:"Close"}),e.jsx(_e,{onClick:()=>{Wt(),ct(),be(),oe(R[0].PLAN_ID)},children:"Refresh"})]}),e.jsxs("div",{className:"khoaodivtable",children:[e.jsxs("div",{className:"tablekhoao",style:{height:"100%",width:"50%"},children:[e.jsx("div",{className:"tabletonkhoao",children:e.jsx(ve,{sx:{fontSize:12,flex:1},components:{Toolbar:Cl,LoadingOverlay:me},getRowId:l=>l.id,loading:y,rowHeight:30,rows:Ve,columns:N,rowsPerPageOptions:[5,10,50,100,500,1e3,5e3,1e4,5e5],checkboxSelection:!0,selectionModel:ce,onSelectionModelChange:l=>{Ne(l),rl(l)},onCellEditCommit:(l,c,i)=>{const O=l.field,D=Ve.map(t=>t.id===l.id?{...t,[O]:l.value}:t);tt(D)}})}),e.jsx("div",{className:"lichsuinputsanxuat",children:e.jsx(ve,{sx:{fontSize:12,flex:1},components:{Toolbar:Dl,LoadingOverlay:me},getRowId:l=>l.id,loading:y,rowHeight:30,rows:de,columns:Te,rowsPerPageOptions:[5,10,50,100,500,1e3,5e3,1e4,5e5],checkboxSelection:!0,selectionModel:ne,onSelectionModelChange:l=>{z(l),jl(l)},onCellEditCommit:(l,c,i)=>{const O=l.field,D=de.map(t=>t.id===l.id?{...t,[O]:l.value}:t);S(D)}})})]}),e.jsxs("div",{className:"nhapxuatkhoao",style:{height:"100%",width:"50%"},children:[e.jsx("div",{className:"nhapkhoao",style:{height:"100%",width:"100%"},children:e.jsx(ve,{sx:{fontSize:12,flex:1},components:{Toolbar:Ol,LoadingOverlay:me},getRowId:l=>l.id,loading:y,rowHeight:30,rows:Ee,columns:re,rowsPerPageOptions:[5,10,50,100,500,1e3,5e3,1e4,5e5],onSelectionModelChange:l=>{rl(l)},onCellEditCommit:(l,c,i)=>{const O=l.field,D=Ee.map(t=>t.id===l.id?{...t,[O]:l.value}:t);ae(D)}})}),e.jsx("div",{className:"xuatkhoao",style:{height:"100%",width:"100%"},children:e.jsx(ve,{sx:{fontSize:12,flex:1},components:{Toolbar:fl,LoadingOverlay:me},getRowId:l=>l.id,loading:y,rowHeight:30,rows:he,columns:$,rowsPerPageOptions:[5,10,50,100,500,1e3,5e3,1e4,5e5],checkboxSelection:!0,selectionModel:ke,onSelectionModelChange:l=>{I(l),qt(l)},onCellEditCommit:(l,c,i)=>{const O=l.field,D=he.map(t=>t.id===l.id?{...t,[O]:l.value}:t);Ce(D)}})})]})]})]}),ot&&e.jsxs("div",{className:"printycsxpage",children:[e.jsxs("div",{className:"buttongroup",children:[e.jsx("button",{onClick:()=>{It(el(R))},children:"Render Chỉ Thị"}),e.jsx("button",{onClick:n,children:"Print Chỉ Thị"}),e.jsx("button",{onClick:()=>{St(!ot)},children:"Close"})]}),e.jsx("div",{className:"ycsxrender",ref:Et,children:fe})]}),Tt&&e.jsxs("div",{className:"printycsxpage",children:[e.jsxs("div",{className:"buttongroup",children:[e.jsx("button",{onClick:()=>{Me(Zt(R))},children:"Render YCKT"}),e.jsx("button",{onClick:n,children:"Print Chỉ Thị"}),e.jsx("button",{onClick:()=>{Nt(!Tt)},children:"Close"})]}),e.jsx("div",{className:"ycsxrender",ref:Et,children:yt})]})]})}),e.jsxs("div",{className:"chithidiv",children:[e.jsx("div",{className:"planlist",children:e.jsx(ve,{sx:{fontSize:12,flex:1},components:{Toolbar:ul,LoadingOverlay:me},loading:y,rowHeight:30,rows:X,columns:u,rowsPerPageOptions:[5,10,50,100,500,1e3,5e3,1e4,5e5],editMode:"cell",getRowId:l=>l.PLAN_ID,onSelectionModelChange:l=>{gl(l)},onCellEditCommit:(l,c,i)=>{const O=l.field,D=X.map(t=>t.PLAN_ID===l.id?{...t,[O]:l.value}:t);A(D)}})}),e.jsxs("div",{className:"datadinhmuc",children:[e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"EQ1:"}),e.jsxs("select",{name:"phanloai",value:T.EQ1,onChange:l=>k({...T,EQ1:l.target.value}),style:{width:150,height:22},children:[e.jsx("option",{value:"FR",children:"FR"}),e.jsx("option",{value:"SR",children:"SR"}),e.jsx("option",{value:"DC",children:"DC"}),e.jsx("option",{value:"ED",children:"ED"}),e.jsx("option",{value:"NO",children:"NO"}),e.jsx("option",{value:"NA",children:"NA"})]})]}),e.jsxs("label",{children:[e.jsx("b",{children:"EQ2:"}),e.jsxs("select",{name:"phanloai",value:T.EQ2,onChange:l=>k({...T,EQ2:l.target.value}),style:{width:150,height:22},children:[e.jsx("option",{value:"FR",children:"FR"}),e.jsx("option",{value:"SR",children:"SR"}),e.jsx("option",{value:"DC",children:"DC"}),e.jsx("option",{value:"ED",children:"ED"}),e.jsx("option",{value:"NO",children:"NO"}),e.jsx("option",{value:"NA",children:"NA"})]})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"Setting1(min):"})," ",e.jsx("input",{type:"text",placeholder:"Thời gian setting 1",value:T.Setting1,onChange:l=>k({...T,Setting1:Number(l.target.value)})})]}),e.jsxs("label",{children:[e.jsx("b",{children:"Setting2(min):"})," ",e.jsx("input",{type:"text",placeholder:"Thời gian setting 2",value:T.Setting2,onChange:l=>k({...T,Setting2:Number(l.target.value)})})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"UPH1(EA/h):"})," ",e.jsx("input",{type:"text",placeholder:"Tốc độ sx 1",value:T.UPH1,onChange:l=>k({...T,UPH1:Number(l.target.value)})})]}),e.jsxs("label",{children:[e.jsx("b",{children:"UPH2(EA/h):"})," ",e.jsx("input",{type:"text",placeholder:"Tốc độ sx 2",value:T.UPH2,onChange:l=>k({...T,UPH2:Number(l.target.value)})})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"Step1:"})," ",e.jsx("input",{type:"text",placeholder:"Số bước 1",value:T.Step1,onChange:l=>k({...T,Step1:Number(l.target.value)})})]}),e.jsxs("label",{children:[e.jsx("b",{children:"Step2:"})," ",e.jsx("input",{type:"text",placeholder:"Số bước 2",value:T.Step2,onChange:l=>k({...T,Step2:Number(l.target.value)})})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"LOSS_SX1(%):"})," ",e.jsx("input",{type:"text",placeholder:"% loss sx 1",value:T.LOSS_SX1,onChange:l=>k({...T,LOSS_SX1:Number(l.target.value)})})]}),e.jsxs("label",{children:[e.jsx("b",{children:"LOSS_SX2(%):"})," ",e.jsx("input",{type:"text",placeholder:"% loss sx 2",value:T.LOSS_SX2,onChange:l=>k({...T,LOSS_SX2:Number(l.target.value)})})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"LOSS SETTING1 (m):"})," ",e.jsx("input",{type:"text",placeholder:"met setting 1",value:T.LOSS_SETTING1,onChange:l=>k({...T,LOSS_SETTING1:Number(l.target.value)})})]}),e.jsxs("label",{children:[e.jsx("b",{children:"LOSS SETTING2 (m):"})," ",e.jsx("input",{type:"text",placeholder:"met setting 2",value:T.LOSS_SETTING2,onChange:l=>k({...T,LOSS_SETTING2:Number(l.target.value)})})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"FACTORY:"}),e.jsxs("select",{name:"nhamay",value:T.FACTORY===null?"NA":T.FACTORY,onChange:l=>{k({...T,FACTORY:l.target.value})},style:{width:162,height:22},children:[e.jsx("option",{value:"NA",children:"NA"}),e.jsx("option",{value:"NM1",children:"NM1"}),e.jsx("option",{value:"NM2",children:"NM2"})]})]}),e.jsxs("label",{children:[e.jsx("b",{children:"NOTE (QLSX):"})," ",e.jsx("input",{type:"text",placeholder:"Chú ý",value:T.NOTE,onChange:l=>k({...T,NOTE:l.target.value})})]})]})]}),e.jsx("div",{className:"chithitable",children:e.jsx(ve,{sx:{fontSize:12,flex:1},components:{Toolbar:xl,LoadingOverlay:me},getRowId:l=>l.CHITHI_ID,loading:y,rowHeight:30,rows:L,columns:j,rowsPerPageOptions:[5,10,50,100,500,1e3,5e3,1e4,5e5],editMode:"cell",checkboxSelection:!0,onSelectionModelChange:l=>{Al(l)},onCellEditCommit:(l,c,i)=>{const O=l.field,D=L.map(t=>t.CHITHI_ID===l.id?{...t,[O]:l.value}:t);g(D)}})})]})]})})})};const cn=()=>{d.useState([]);const[C,V]=d.useState(!1),f=ft(S=>S.totalSlice.userData),[w,p]=d.useState(!1),[F,T]=d.useState(q().format("YYYY-MM-DD")),[k,ce]=d.useState(q().format("YYYY-MM-DD")),[Ne,ke]=d.useState("ALL"),[I,ne]=d.useState("ALL"),[z,Ee]=d.useState([]),[ae,Y]=d.useState([]),Le=[{field:"PLAN_FACTORY",headerName:"FACTORY",width:80,editable:!1},{field:"PLAN_DATE",headerName:"PLAN_DATE",width:110,editable:!1},{field:"PROD_REQUEST_NO",headerName:"YCSX NO",width:80,editable:!1},{field:"PROD_REQUEST_DATE",headerName:"YCSX DATE",width:80,editable:!1},{field:"PLAN_ID",headerName:"PLAN_ID",width:90,editable:!1,resizeable:!0},{field:"G_CODE",headerName:"G_CODE",width:100,editable:!1},{field:"G_NAME_KD",headerName:"G_NAME_KD",width:180,editable:!1,renderCell:S=>S.row.FACTORY===null||S.row.EQ1===null||S.row.EQ2===null||S.row.Setting1===null||S.row.Setting2===null||S.row.UPH1===null||S.row.UPH2===null||S.row.Step1===null||S.row.Step1===null||S.row.LOSS_SX1===null||S.row.LOSS_SX2===null||S.row.LOSS_SETTING1===null||S.row.LOSS_SETTING2===null?e.jsx("span",{style:{color:"red"},children:S.row.G_NAME_KD}):e.jsx("span",{style:{color:"green"},children:S.row.G_NAME_KD})},{field:"PROD_REQUEST_QTY",headerName:"YCSX QTY",width:80,editable:!1,renderCell:S=>e.jsx("span",{style:{color:"blue"},children:S.row.PROD_REQUEST_QTY.toLocaleString("en","US")})},{field:"EQ1",headerName:"EQ1",width:30,editable:!1},{field:"EQ2",headerName:"EQ2",width:30,editable:!1},{field:"CD1",headerName:"KQ_CD1",width:80,editable:!1,renderCell:S=>e.jsx("span",{style:{color:"blue"},children:S.row.CD1.toLocaleString("en","US")})},{field:"CD2",headerName:"KQ_CD2",width:80,editable:!1,renderCell:S=>e.jsx("span",{style:{color:"blue"},children:S.row.CD2.toLocaleString("en","US")})},{field:"TON_CD1",headerName:"TONYCSX_CD1",width:120,editable:!1,renderCell:S=>e.jsx("span",{style:{color:"blue"},children:S.row.TON_CD1.toLocaleString("en","US")})},{field:"TON_CD2",headerName:"TONYCSX_CD2",width:120,editable:!1,renderCell:S=>e.jsx("span",{style:{color:"blue"},children:S.row.TON_CD2.toLocaleString("en","US")})},{field:"PLAN_QTY",headerName:"PLAN_QTY",width:80,renderCell:S=>S.row.PLAN_QTY===0?e.jsx("span",{style:{color:"red"},children:"NG"}):e.jsx("span",{style:{color:"green"},children:S.row.PLAN_QTY.toLocaleString("en","US")})},{field:"PROCESS_NUMBER",headerName:"PROCESS_NUMBER",width:110,renderCell:S=>S.row.PROCESS_NUMBER===null||S.row.PROCESS_NUMBER===0?e.jsx("span",{style:{color:"red"},children:"NG"}):e.jsx("span",{style:{color:"green"},children:S.row.PROCESS_NUMBER})},{field:"STEP",headerName:"STEP",width:60},{field:"PLAN_ORDER",headerName:"PLAN_ORDER",width:110},{field:"KETQUASX",headerName:"KETQUASX",width:110,renderCell:S=>S.row.KETQUASX!==null?e.jsx("span",{children:S.row.KETQUASX.toLocaleString("en-US")}):e.jsx("span",{children:"0"})},{field:"KQ_SX_TAM",headerName:"KETQUASX_TAM",width:120,renderCell:S=>S.row.KQ_SX_TAM!==null?e.jsx("span",{children:S.row.KQ_SX_TAM.toLocaleString("en-US")}):e.jsx("span",{children:"0"})},{field:"PLAN_EQ",headerName:"PLAN_EQ",width:80},{field:"EQ_STATUS",headerName:"Trạng thái",width:100,renderCell:S=>S.row.EQ_STATUS==="KTST-KSX"?e.jsx("span",{style:{color:"green"},children:"KTST-KSX"}):S.row.EQ_STATUS==="Đang setting"?e.jsx("span",{style:{color:"yellow"},children:"Đang Setting"}):S.row.EQ_STATUS==="Đang Run"?e.jsx("span",{style:{color:"blue"},children:"Đang Run"}):S.row.EQ_STATUS==="Chạy xong"?e.jsx("span",{style:{color:"green"},children:"Chạy xong"}):e.jsx("span",{style:{color:"red"},children:"Chưa chạy"})},{field:"XUATDAOFILM",headerName:"Xuất Dao",width:80},{field:"DKXL",headerName:"ĐK Xuất liệu",width:80},{field:"MAIN_MATERIAL",headerName:"Xuất liệu",width:80},{field:"CHOTBC",headerName:"Chốt báo cáo",width:80},{field:"INS_EMPL",headerName:"INS_EMPL",width:120,editable:!1,hide:!1},{field:"INS_DATE",headerName:"INS_DATE",width:120,editable:!1,hide:!0},{field:"UPD_EMPL",headerName:"UPD_EMPL",width:120,editable:!1,hide:!0},{field:"UPD_DATE",headerName:"UPD_DATE",width:120,editable:!1,hide:!0}];function he(){return e.jsxs(Xe,{children:[e.jsxs(b,{className:"buttonIcon",onClick:()=>{Ue(z,"PLAN Table")},children:[e.jsx(ye,{color:"green",size:25}),"SAVE"]}),e.jsx(Ge,{}),e.jsx("div",{className:"div",style:{fontSize:20,fontWeight:"bold"},children:"BẢNG PLAN THEO NGÀY"})]})}const Ce=S=>{x("getqlsxplan2",{PLAN_DATE:S,MACHINE:I,FACTORY:Ne}).then(K=>{if(K.data.tk_status!=="NG"){let ee=K.data.data.map((X,A)=>({...X,PLAN_DATE:q.utc(X.PLAN_DATE).format("YYYY-MM-DD"),EQ_STATUS:X.EQ_STATUS==="B"?"Đang setting":X.EQ_STATUS==="M"?"Đang Run":X.EQ_STATUS==="K"?"Chạy xong":X.EQ_STATUS==="K"?"KTST-KSX":"Chưa chạy",id:A}));Ee(ee),V(!0),p(!1),h.fire("Thông báo","Đã load: "+K.data.data.length+" dòng","success")}else Ee([]),h.fire("Thông báo","Nội dung: "+K.data.message,"error")}).catch(K=>{console.log(K)})},ge=async()=>{if(ae.length>0){let S="0";for(let K=0;K<ae.length;K++){let ee=!1;await x("checkplansetting",{PLAN_ID:ae[K].PLAN_ID}).then(X=>{X.data.tk_status!=="NG"?ee=!0:ee=!1}).catch(X=>{console.log(X)}),ee?S+="Lỗi: PLAN_ID "+ae[K].PLAN_ID+" đã setting nên không di chuyển được sang ngày khác, phải chốt":x("move_plan",{PLAN_ID:ae[K].PLAN_ID,PLAN_DATE:k}).then(X=>{X.data.tk_status!=="NG"||(S+="Lỗi: "+X.data.message+`
`)}).catch(X=>{console.log(X)})}S!=="0"&&h.fire("Thông báo","Lỗi: "+S,"error"),Ce(F)}else h.fire("Thông báo","Chọn ít nhất một chỉ thị để di chuyển","error")},Z=()=>{h.fire({title:"Chắc chắn muốn chuyển ngày cho plan đã chọn ?",text:"Sẽ bắt đầu chuyển ngày đã chọn",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Vẫn chuyển!"}).then(S=>{S.isConfirmed&&(h.fire("Tiến hành chuyển ngày PLAN","Đang ngày plan","success"),xe(f==null?void 0:f.EMPL_NO,f==null?void 0:f.MAINDEPTNAME,["QLSX"],ge))})},de=S=>{const K=new Set(S);let ee=z.filter(X=>K.has(X.PLAN_ID));ee.length>0?Y(ee):Y([])};return d.useEffect(()=>{},[]),e.jsx("div",{className:"lichsuplanTable",children:e.jsxs("div",{className:"tracuuDataInspection",children:[e.jsxs("div",{className:"tracuuDataInspectionform",children:[e.jsxs("div",{className:"forminput",children:[e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"PLAN DATE"}),e.jsx("input",{type:"date",value:F.slice(0,10),onChange:S=>T(S.target.value)})]}),e.jsxs("label",{children:[e.jsx("b",{children:"FACTORY:"}),e.jsxs("select",{name:"phanloai",value:Ne,onChange:S=>{ke(S.target.value)},children:[e.jsx("option",{value:"ALL",children:"ALL"}),e.jsx("option",{value:"NM1",children:"NM1"}),e.jsx("option",{value:"NM2",children:"NM2"})]})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsxs("label",{children:[e.jsx("b",{children:"MACHINE:"}),e.jsxs("select",{name:"machine",value:I,onChange:S=>{ne(S.target.value)},children:[e.jsx("option",{value:"ALL",children:"ALL"}),e.jsx("option",{value:"FR",children:"FR"}),e.jsx("option",{value:"SR",children:"SR"}),e.jsx("option",{value:"DC",children:"DC"}),e.jsx("option",{value:"ED",children:"ED"})]})]}),e.jsxs("label",{children:[e.jsx("b",{children:"MOVE TO DATE"}),e.jsx("input",{type:"date",value:k.slice(0,10),onChange:S=>ce(S.target.value)})]})]}),e.jsxs("div",{className:"forminputcolumn",children:[e.jsx("button",{className:"tranhatky",onClick:()=>{Z()},children:"MOVE PLAN"}),e.jsx("button",{className:"tranhatky",onClick:()=>{p(!0),V(!1),Ce(F)},children:"Tra PLAN"})]})]}),e.jsx("div",{className:"formbutton"})]}),e.jsx("div",{className:"tracuuYCSXTable",children:C&&e.jsx(ve,{sx:{fontSize:12,flex:1},components:{Toolbar:he,LoadingOverlay:me},loading:w,rowHeight:30,rows:z,columns:Le,rowsPerPageOptions:[5,10,50,100,500,1e3,5e3,1e4,5e5],disableSelectionOnClick:!0,checkboxSelection:!0,editMode:"cell",getRowId:S=>S.PLAN_ID,onSelectionModelChange:S=>{de(S)},onCellEditCommit:(S,K,ee)=>{const X=S.field,A=z.map(L=>L.id===S.id?{...L,[X]:S.value}:L);Ee(A)}})})]})})},dn=()=>{const[C,V]=d.useState({tab1:!0,tab2:!1,tab3:!1}),f=w=>{w===1?V({...C,tab1:!0,tab2:!1,tab3:!1,tab4:!1,tab5:!1,tab6:!1,tab7:!1,tab8:!1,tab9:!1,tab10:!1}):w===2?V({...C,tab1:!1,tab2:!0,tab3:!1,tab4:!1,tab5:!1,tab6:!1,tab7:!1,tab8:!1,tab9:!1,tab10:!1}):w===3?V({...C,tab1:!1,tab2:!1,tab3:!0,tab4:!1,tab5:!1,tab6:!1,tab7:!1,tab8:!1,tab9:!1,tab10:!1}):w===4?V({...C,tab1:!1,tab2:!1,tab3:!1,tab4:!0,tab5:!1,tab6:!1,tab7:!1,tab8:!1,tab9:!1,tab10:!1}):w===5?V({...C,tab1:!1,tab2:!1,tab3:!1,tab4:!1,tab5:!0,tab6:!1,tab7:!1,tab8:!1,tab9:!1,tab10:!1}):w===6?V({...C,tab1:!1,tab2:!1,tab3:!1,tab4:!1,tab5:!1,tab6:!0,tab7:!1,tab8:!1,tab9:!1,tab10:!1}):w===7?V({...C,tab1:!1,tab2:!1,tab3:!1,tab4:!1,tab5:!1,tab6:!1,tab7:!0,tab8:!1,tab9:!1,tab10:!1}):w===8?V({...C,tab1:!1,tab2:!1,tab3:!1,tab4:!1,tab5:!1,tab6:!1,tab7:!1,tab8:!0,tab9:!1,tab10:!1}):w===9?V({...C,tab1:!1,tab2:!1,tab3:!1,tab4:!1,tab5:!1,tab6:!1,tab7:!1,tab8:!1,tab9:!0,tab10:!1}):w===10&&V({...C,tab1:!1,tab2:!1,tab3:!1,tab4:!1,tab5:!1,tab6:!1,tab7:!1,tab8:!1,tab9:!1,tab10:!0})};return d.useEffect(()=>{},[]),e.jsx("div",{className:"qlsxplan",children:e.jsxs(d.Suspense,{fallback:e.jsx("div",{children:" Loading..."}),children:[e.jsxs("div",{className:"mininavbar",children:[e.jsx("div",{className:"mininavitem",onClick:()=>f(1),style:{backgroundColor:C.tab1===!0?"#02c712":"#abc9ae",color:(C.tab1===!0,"yellow")},children:e.jsx("span",{className:"mininavtext",children:"PLAN VISUAL"})}),e.jsx("div",{className:"mininavitem",onClick:()=>f(4),style:{backgroundColor:C.tab4===!0?"#02c712":"#abc9ae",color:(C.tab4===!0,"yellow")},children:e.jsx("span",{className:"mininavtext",children:"QUICK PLAN"})}),e.jsx("div",{className:"mininavitem",onClick:()=>f(5),style:{backgroundColor:C.tab5===!0?"#02c712":"#abc9ae",color:(C.tab5===!0,"yellow")},children:e.jsx("span",{className:"mininavtext",children:"TRA PLAN"})}),e.jsx("div",{className:"mininavitem",onClick:()=>f(3),style:{backgroundColor:C.tab3===!0?"#02c712":"#abc9ae",color:(C.tab3===!0,"yellow")},children:e.jsx("span",{className:"mininavtext",children:"LỊCH SỬ"})}),e.jsx("div",{className:"mininavitem",onClick:()=>f(6),style:{backgroundColor:C.tab6===!0?"#02c712":"#abc9ae",color:(C.tab6===!0,"yellow")},children:e.jsx("span",{className:"mininavtext",children:"DATA SX"})}),e.jsx("div",{className:"mininavitem",onClick:()=>f(7),style:{backgroundColor:C.tab7===!0?"#02c712":"#abc9ae",color:(C.tab7===!0,"yellow")},children:e.jsx("span",{className:"mininavtext",children:"PLAN STATUS"})}),e.jsx("div",{className:"mininavitem",onClick:()=>f(8),style:{backgroundColor:C.tab8===!0?"#02c712":"#abc9ae",color:(C.tab8===!0,"yellow")},children:e.jsx("span",{className:"mininavtext",children:"EQ STATUS"})}),e.jsx("div",{className:"mininavitem",onClick:()=>f(10),style:{backgroundColor:C.tab10===!0?"#02c712":"#abc9ae",color:(C.tab10===!0,"yellow")},children:e.jsx("span",{className:"mininavtext",children:"KHO ẢO"})})]}),C.tab1&&e.jsx("div",{className:"traiqc",children:e.jsx(sn,{})}),C.tab2&&e.jsx("div",{className:"datadtc",children:e.jsx(on,{})}),C.tab3&&e.jsx("div",{className:"datadtc",children:e.jsx(ln,{})}),C.tab4&&e.jsx("div",{className:"datadtc",children:e.jsx(rn,{})}),C.tab5&&e.jsx("div",{className:"datadtc",children:e.jsx(cn,{})}),C.tab6&&e.jsx("div",{className:"datadtc",children:e.jsx(Zl,{})}),C.tab7&&e.jsx("div",{className:"datadtc",children:e.jsx(tn,{})}),C.tab8&&e.jsx("div",{className:"datadtc",children:e.jsx(nn,{})}),C.tab10&&e.jsx("div",{className:"datadtc",children:e.jsx(Kl,{})})]})})},On=Object.freeze(Object.defineProperty({__proto__:null,default:dn},Symbol.toStringTag,{value:"Module"}));export{sn as M,cn as P,dn as Q,rn as a,On as b};
