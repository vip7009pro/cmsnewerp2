import{r as l,j as e,ag as j,ad as T,S as m,ai as Y,aj as L,ak as ce}from"./index-4ab6dde0.js";import{P as X,a as $}from"./PieChart-e6e37eea.js";import{T as w,d as J,C as he,a as Ne,X as fe,L as Te,Y as H,b as K,B as V,e as Q,c as me}from"./ComposedChart-cf350085.js";import{D as p,G as Ae,b as Oe}from"./DataGrid-b5e0acb2.js";import{G as _e,a as ue,b as xe}from"./GridToolbarFilterButton-ec6062d3.js";import"./TextField-db9fe3d0.js";import"./MenuItem-8199bc03.js";import"./Typography-b6d023f3.js";const ge=()=>{const[c,h]=l.useState([]),C=({active:i,payload:d,label:s})=>i&&d&&d.length?e.jsx("div",{className:"custom-tooltip",children:e.jsx("p",{className:"label",children:`${d[0].value.toLocaleString("en-US")} người`})}):null,D=({cx:i,cy:d,midAngle:s,innerRadius:N,outerRadius:f,value:b,index:_})=>{const u=Math.PI/180,A=105+N+(f-N),x=i+A*Math.cos(-s*u),g=d+A*Math.sin(-s*u);return e.jsxs("text",{x,y:g,fill:"#8884d8",textAnchor:x>i?"start":"end",dominantBaseline:"central",style:{color:"white"},children:[c[_].MAINDEPTNAME," : (",b.toLocaleString("en-US")," người)"]})},v=()=>{T("getddmaindepttb",{}).then(i=>{if(i.data.tk_status!=="NG"){let d=i.data.data.map((s,N)=>({...s,id:N}));h(d)}else m.fire("Thông báo","Nội dung: "+i.data.message,"error")}).catch(i=>{console.log(i)})};l.useEffect(()=>{v()},[]);const O=["#cc0000","#cc3300","#cc6600","#cc9900","#cccc00","#99cc00","#66cc00","#33cc00","#00cc00","#00cc33","#00cc66","#00cc99","#00cccc","#0099cc","#0066cc","#0033cc","#0000cc","#3300cc","#6600cc","#9900cc","#cc00cc","#cc0099","#cc0066","#cc0033","#cc0000"];return e.jsx(j,{children:e.jsxs(X,{width:500,height:400,children:[e.jsx(w,{content:e.jsx(C,{})}),e.jsx($,{dataKey:"COUNT_TOTAL",nameKey:"MAINDEPTNAME",isAnimationActive:!1,data:c,cx:"50%",cy:"50%",outerRadius:80,fill:"#8884d8",label:D,children:c.map((i,d)=>e.jsx(J,{fill:O[(2+d)*3%O.length]},`cell-${d}`))})]})})},pe=()=>{const[c,h]=l.useState(!1),[C,D]=l.useState([]),[v,O]=l.useState([]),[i,d]=l.useState([]),[s,N]=l.useState(Y().add(-8,"day").format("YYYY-MM-DD")),[f,b]=l.useState(Y().format("YYYY-MM-DD")),[_,u]=l.useState(6),[A,x]=l.useState(0),[g,q]=l.useState(0),[z,Z]=l.useState([]),[ee,ae]=l.useState([]),[y,te]=l.useState([]),ie=[{field:"MAINDEPTNAME",headerName:"BP Chính",width:120,renderCell:a=>e.jsx("div",{className:"onoffdiv",children:e.jsx("span",{style:{fontWeight:"bold",color:"black"},children:a.row.MAINDEPTNAME})})},{field:"COUNT_TOTAL",headerName:"Tổng",width:120,renderCell:a=>e.jsx("div",{className:"onoffdiv",children:e.jsx("span",{style:{fontWeight:"bold",color:"black"},children:a.row.COUNT_TOTAL})})},{field:"COUT_ON",headerName:"Đi làm",width:120,renderCell:a=>e.jsx("div",{className:"onoffdiv",children:e.jsx("span",{style:{fontWeight:"bold",color:"black"},children:a.row.COUT_ON})})},{field:"COUT_OFF",headerName:"Nghỉ làm",width:120,renderCell:a=>e.jsx("div",{className:"onoffdiv",children:e.jsx("span",{style:{fontWeight:"bold",color:"black"},children:a.row.COUT_OFF})})},{field:"COUNT_CDD",headerName:"Chưa điểm danh",width:120,renderCell:a=>e.jsx("div",{className:"onoffdiv",children:e.jsx("span",{style:{fontWeight:"bold",color:"black"},children:a.row.COUNT_CDD})})},{field:"ON_RATE",headerName:"Tỉ lệ đi làm",width:120,renderCell:a=>e.jsx("div",{className:"onoffdiv",children:e.jsxs("span",{style:{fontWeight:"bold",color:"black"},children:[a.row.ON_RATE.toLocaleString("en-US",{style:"decimal",maximumFractionDigits:2})," %"]})})}],le=[{field:"MAINDEPTNAME",headerName:"BP Chính",width:120,renderCell:a=>e.jsx("div",{className:"onoffdiv",children:e.jsx("span",{style:{fontWeight:"bold",color:"black"},children:a.row.MAINDEPTNAME})})},{field:"SUBDEPTNAME",headerName:"BP Phụ",width:120,renderCell:a=>e.jsx("div",{className:"onoffdiv",children:e.jsx("span",{style:{fontWeight:"bold",color:"black"},children:a.row.SUBDEPTNAME})})},{field:"TOTAL_ALL",headerName:"Tổng",width:90,renderCell:a=>e.jsx("div",{className:"onoffdiv",children:e.jsx("span",{style:{fontWeight:"bold",color:"blue"},children:a.row.TOTAL_ALL})})},{field:"TOTAL_ON",headerName:"Đi Làm",width:90,renderCell:a=>e.jsx("div",{className:"onoffdiv",children:e.jsx("span",{style:{fontWeight:"bold",color:"green"},children:a.row.TOTAL_ON})})},{field:"TOTAL_OFF",headerName:"Nghỉ Làm",width:90,renderCell:a=>e.jsx("div",{className:"onoffdiv",children:e.jsx("span",{style:{fontWeight:"bold",color:"red"},children:a.row.TOTAL_OFF})})},{field:"TOTAL_CDD",headerName:"Chưa ĐD",width:90,renderCell:a=>e.jsx("div",{className:"onoffdiv",children:e.jsx("span",{style:{fontWeight:"bold",color:"black"},children:a.row.TOTAL_CDD})})},{field:"ON_RATE",headerName:"TL ĐI LÀM",width:120,renderCell:a=>e.jsx("div",{className:"onoffdiv",children:e.jsxs("span",{style:{fontWeight:"bold",color:"black"},children:[(a.row.TOTAL_ON/a.row.TOTAL_ALL*100).toLocaleString("en-US",{style:"decimal",maximumFractionDigits:2}),"%"]})})}],de=[{field:"APPLY_DATE",headerName:"APPLY_DATE",width:120,valueGetter:a=>a.row.APPLY_DATE?a.row.APPLY_DATE.slice(0,10):""},{field:"ON_OFF",headerName:"ON_OFF",width:120,renderCell:a=>{if(a.row.ON_OFF===1)return e.jsx("div",{className:"onoffdiv",children:e.jsx("span",{style:{fontWeight:"bold",color:"green"},children:"Đi làm"})});if(a.row.ON_OFF===0)return e.jsx("div",{className:"onoffdiv",children:e.jsx("span",{style:{fontWeight:"bold",color:"red"},children:"Nghỉ làm"})})}},{field:"PHE_DUYET",headerName:"PHE_DUYET",width:120,renderCell:a=>a.row.APPROVAL_STATUS===0?e.jsx("div",{className:"onoffdiv",children:e.jsx("span",{style:{fontWeight:"bold",color:"red"},children:"Từ chối"})}):a.row.APPROVAL_STATUS===1?e.jsx("div",{className:"onoffdiv",children:e.jsx("span",{style:{fontWeight:"bold",color:"green"},children:"Phê duyệt"})}):a.row.APPROVAL_STATUS===2?e.jsx("div",{className:"onoffdiv",children:e.jsx("span",{style:{fontWeight:"bold",color:"white"},children:"Chờ duyệt"})}):e.jsx("div",{className:"onoffdiv"})},{field:"EMPL_NO",headerName:"EMPL_NO",width:120},{field:"CMS_ID",headerName:"CMS_ID",width:120},{field:"MIDLAST_NAME",headerName:"MIDLAST_NAME",width:170},{field:"FIRST_NAME",headerName:"FIRST_NAME",width:120},{field:"CA_NGHI",headerName:"CA_NGHI",width:100},{field:"OVERTIME_INFO",headerName:"OVERTIME_INFO",width:120},{field:"OVERTIME",headerName:"OVERTIME",width:100},{field:"REASON_NAME",headerName:"REASON_NAME",width:120},{field:"REMARK",headerName:"REMARK",width:170},{field:"XACNHAN",headerName:"XACNHAN",width:120},{field:"PHONE_NUMBER",headerName:"PHONE_NUMBER",width:120},{field:"SEX_NAME",headerName:"SEX_NAME",width:120},{field:"WORK_STATUS_NAME",headerName:"WORK_STATUS_NAME",width:120},{field:"FACTORY_NAME",headerName:"FACTORY_NAME",width:120},{field:"JOB_NAME",headerName:"JOB_NAME",width:120},{field:"WORK_SHIF_NAME",headerName:"WORK_SHIF_NAME",width:120},{field:"WORK_POSITION_NAME",headerName:"WORK_POSITION_NAME",width:120},{field:"SUBDEPTNAME",headerName:"SUBDEPTNAME",width:120},{field:"MAINDEPTNAME",headerName:"MAINDEPTNAME",width:120},{field:"REQUEST_DATE",headerName:"REQUEST_DATE",width:120,valueGetter:a=>a.row.REQUEST_DATE?a.row.REQUEST_DATE.slice(0,10):""},{field:"OFF_ID",headerName:"OFF_ID",width:120}];function ne(){return e.jsxs(Ae,{children:[e.jsx(_e,{}),e.jsx(ue,{}),e.jsx(xe,{}),e.jsx(Oe,{}),e.jsx("button",{className:"saveexcelbutton",onClick:()=>{ce(y,"DiemdanhHistoryFull")},children:"Save Excel"})]})}const se=a=>{for(var t=0,r=0,o=0,E=0,P=0,R=0,U=0,I=0,k=0,W=0,B=0,G=0,M=0;M<a.length;M++){var n=a[M];t+=n.TOTAL_ALL,o+=n.TOTAL_ON,r+=n.TOTAL_OFF,E+=n.TOTAL_CDD,P+=n.TOTAL_NM1,R+=n.TOTAL_NM2,U+=n.ON_NM1,I+=n.ON_NM2,k+=n.OFF_NM1,W+=n.OFF_NM2,B+=n.CDD_NM1,G+=n.CDD_NM2}var oe={id:"GRAND_TOTAL",MAINDEPTNAME:"GRAND_TOTAL",SUBDEPTNAME:"GRAND_TOTAL",TOTAL_ALL:t,TOTAL_ON:o,TOTAL_OFF:r,TOTAL_CDD:E,TOTAL_NM1:P,TOTAL_NM2:R,ON_NM1:U,ON_NM2:I,OFF_NM1:k,OFF_NM2:W,CDD_NM1:B,CDD_NM2:G};return a.push(oe),a},F=()=>{h(!0),T("getmaindeptlist",{from_date:s}).then(a=>{a.data.tk_status!=="NG"&&Z(a.data.data)}).catch(a=>{console.log(a)}),T("diemdanhsummarynhom",{todate:f}).then(a=>{a.data.tk_status!=="NG"?(d(a.data.data),O(se(a.data.data)),h(!1)):m.fire("Thông báo","Nội dung: "+a.data.message,"error")}).catch(a=>{console.log(a)}),T("diemdanhhistorynhom",{start_date:s,end_date:f,MAINDEPTCODE:g,WORK_SHIFT_CODE:_,FACTORY_CODE:A}).then(a=>{if(a.data.tk_status!=="NG"){const t=a.data.data.map(r=>({...r,APPLY_DATE:r.APPLY_DATE.slice(0,10)}));ae(t)}else m.fire("Thông báo","Nội dung: "+a.data.message,"error")}).catch(a=>{console.log(a)}),T("diemdanhfull",{from_date:s,to_date:f}).then(a=>{a.data.tk_status!=="NG"?(te(a.data.data),h(!1),m.fire("Thông báo","Đã load "+a.data.data.length+" dòng","success")):m.fire("Thông báo","Nội dung: "+a.data.message,"error")}).catch(a=>{console.log(a)}),T("getddmaindepttb",{}).then(a=>{if(a.data.tk_status!=="NG"){let t={id:1111,MAINDEPTNAME:"TOTAL",COUNT_TOTAL:0,COUT_ON:0,COUT_OFF:0,COUNT_CDD:0,ON_RATE:0},r=a.data.data.map((o,E)=>(t={...t,COUNT_TOTAL:t.COUNT_TOTAL+o.COUNT_TOTAL,COUT_ON:t.COUT_ON+o.COUT_ON,COUT_OFF:t.COUT_OFF+o.COUT_OFF,COUNT_CDD:t.COUNT_CDD+o.COUNT_CDD},{...o,id:E}));t={...t,ON_RATE:t.COUT_ON/t.COUNT_TOTAL*100},r=[...r,t],D(r),h(!1)}else m.fire("Thông báo","Nội dung: "+a.data.message,"error")}).catch(a=>{console.log(a)})},re=()=>{F()},S=["#ff8c66","#ffb366","#ffd966","#ffff66","#d9ff66","#b3ff66","#8cff66","#66ff66","#66ff8c","#66ffb3","#66ffd9","#66ffff","#66d9ff","#66b3ff","#668cff","#6666ff","#8c66ff","#b366ff","#d966ff","#ff66ff","#ff66d9","#ff66b3","#ff668c","#ff6666"];return l.useEffect(()=>{F()},[]),e.jsx("div",{className:"baocaonhansu",children:e.jsxs("div",{className:"baocao1",children:[e.jsx("h3",{children:"Báo cáo nhân sự"}),e.jsxs("div",{className:"filterform",children:[e.jsxs("label",{children:[e.jsx("b",{children:"Chọn bộ phận:"}),e.jsxs("select",{name:"bophan",value:g,onChange:a=>{q(Number(a.target.value))},children:[e.jsx("option",{value:0,children:"Tất cả"}),z.map((a,t)=>e.jsx("option",{value:a.MAINDEPTCODE,children:a.MAINDEPTNAME},t))]})]}),e.jsxs("label",{children:[e.jsx("b",{children:"Chọn nhà máy:"}),e.jsxs("select",{name:"nhamay",value:A,onChange:a=>{x(Number(a.target.value))},children:[e.jsx("option",{value:0,children:"Tất cả"}),e.jsx("option",{value:1,children:"Nhà máy 1"}),e.jsx("option",{value:2,children:"Nhà máy 2"})]})]}),e.jsxs("label",{children:[e.jsx("b",{children:"Chọn ca:"}),e.jsxs("select",{name:"ca",value:_,onChange:a=>{u(Number(a.target.value))},children:[e.jsx("option",{value:6,children:"Tất cả"}),e.jsx("option",{value:1,children:"Ca 1"}),e.jsx("option",{value:2,children:"Ca 2"}),e.jsx("option",{value:3,children:"Hành chính"}),e.jsx("option",{value:4,children:"Ca 1 + Hành Chính"}),e.jsx("option",{value:5,children:"Ca 2 + Hành Chính"})]})]}),e.jsxs("label",{children:[e.jsx("b",{children:"From:"}),e.jsx("input",{type:"date",value:s.slice(0,10),onChange:a=>N(a.target.value)})]}),e.jsxs("label",{children:[e.jsx("b",{children:"To:"}),e.jsx("input",{type:"date",value:f.slice(0,10),onChange:a=>b(a.target.value)})]}),e.jsx("button",{className:"searchbutton",onClick:()=>{re()},children:"Search"})]}),e.jsx("h3",{children:"Biểu đồ trending tình hình đi làm"}),e.jsx("div",{className:"diemdanhhistorychart",children:e.jsx(j,{children:e.jsxs(he,{width:500,height:300,data:ee,margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(Ne,{strokeDasharray:"3 3",className:"chartGrid"}),e.jsxs(fe,{dataKey:"APPLY_DATE",children:[" ",e.jsx(Te,{value:"Ngày tháng",offset:0,position:"insideBottom"})]}),e.jsx(H,{yAxisId:"left-axis",label:{value:"Số lượng đi làm",angle:-90,position:"insideLeft"}}),e.jsx(H,{orientation:"right",yAxisId:"right-axis",label:{value:"Tỉ lệ đi làm",angle:-90,position:"outsideRight"}}),e.jsx(w,{}),e.jsx(K,{}),e.jsx(V,{yAxisId:"left-axis",dataKey:"TOTAL_ON",stackId:"a",fill:"#8884d8",children:e.jsx(Q,{dataKey:"TOTAL_ON",position:"inside"})}),e.jsx(V,{yAxisId:"left-axis",dataKey:"TOTAL_OFF",stackId:"a",fill:"#82ca9d",children:e.jsx(Q,{dataKey:"TOTAL_OFF",position:"inside"})}),e.jsx(me,{yAxisId:"right-axis",type:"monotone",dataKey:"ON_RATE",stroke:"#FF0000",activeDot:{r:8}})]})})}),e.jsx("h3",{children:"Nhân lực điểm danh trong ngày theo bộ phận chính"}),e.jsxs("div",{className:"maindept_tableOK",children:[e.jsx("div",{className:"tiledilamtable",children:e.jsx(p,{components:{LoadingOverlay:L},style:{padding:"20px"},loading:c,rows:C,rowHeight:30,columns:ie,hideFooterPagination:!0,hideFooter:!0})}),e.jsx("div",{className:"titrongphongbangraph",children:e.jsx(j,{children:e.jsx(ge,{})})})]}),e.jsx("h3",{children:"Nhân lực điểm danh trong ngày theo bộ phận phụ"}),e.jsxs("div",{className:"maindept_table",children:[e.jsx("div",{className:"tiledilamtable",children:e.jsx(p,{components:{LoadingOverlay:L},style:{padding:"20px"},loading:c,rows:v,columns:le,getRowHeight:()=>"auto",hideFooterPagination:!0,hideFooter:!0})}),e.jsx("div",{className:"titrongphongbangraph",children:e.jsx(j,{children:e.jsxs(X,{width:500,height:500,children:[e.jsx(K,{}),e.jsx(w,{}),i&&e.jsx($,{data:i.slice(0,i.length-1),isAnimationActive:!1,cx:"50%",cy:"50%",outerRadius:80,fill:"#80bfff",dataKey:"TOTAL_ALL",nameKey:"SUBDEPTNAME",paddingAngle:5,label:!0,labelLine:!0,children:i.map((a,t)=>e.jsx(J,{fill:S[t%S.length]},`cell-${t}`))})]})})})]}),e.jsx("h3",{children:"Lịch sử đi làm full info"}),e.jsx("div",{className:"maindept_table",children:e.jsx(p,{components:{Toolbar:ne,LoadingOverlay:L},style:{padding:"20px"},loading:c,rowHeight:35,rows:y,columns:de,rowsPerPageOptions:[5,10,30,50,100,500,1e3,5e3,1e4],editMode:"row",getRowHeight:()=>"auto"})})]})})};export{pe as default};
