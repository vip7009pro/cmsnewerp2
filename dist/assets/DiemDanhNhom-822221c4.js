import{r as _,ad as c,S as l,j as t,aj as g,ak as F,ai as A}from"./index-4ab6dde0.js";/* empty css                     */import{D as S,G as x,b as j}from"./DataGrid-b5e0acb2.js";import{G as I,a as b,b as C}from"./GridToolbarFilterButton-ec6062d3.js";import"./TextField-db9fe3d0.js";import"./MenuItem-8199bc03.js";import"./Typography-b6d023f3.js";const V=()=>{const[T,f]=_.useState(!1),[u,m]=_.useState(0),[a,r]=_.useState([]),w=[{field:"EMPL_NO",headerName:"EMPL_NO",width:170},{field:"CMS_ID",headerName:"CMS_ID",width:100},{field:"AVATAR",headerName:"AVATAR",width:70,renderCell:e=>t.jsx("img",{width:70,height:90,src:"/Picture_NS/NS_"+e.row.EMPL_NO+".jpg",alt:e.row.EMPL_NO})},{field:"DIEMDANH",headerName:"DIEMDANH",width:170,renderCell:e=>{let E=e.row.ON_OFF===1?"onbt":e.row.ON_OFF===0?"offbt":"";const h=o=>{const n={canghi:1,reason_code:o,remark_content:"AUTO",ngaybatdau:A().format("YYYY-MM-DD"),ngayketthuc:A().format("YYYY-MM-DD"),EMPL_NO:e.row.EMPL_NO};c("dangkynghi2_AUTO",n).then(N=>{if(N.data.tk_status==="OK"){const i=a.map(M=>M.EMPL_NO===e.row.EMPL_NO?{...M,ON_OFF:0,REASON_NAME:"AUTO"}:M);r(i),l.fire("Thông báo","Người này nghỉ ko đăng ký, auto chuyển Nghỉ Việc Riêng!","warning")}else l.fire("Lỗi","Người này nghỉ ko đăng ký, auto chuyển Nghỉ Việc Riêng, tuy nhiên thao tác thất bại ! "+N.data.message,"error")}).catch(N=>{})},O=()=>{const o={EMPL_NO:e.row.EMPL_NO};c("xoadangkynghi_AUTO",o).then(n=>{n.data.tk_status}).catch(n=>{})},d=o=>{o===1?e.row.OFF_ID===null||e.row.REASON_NAME==="Nửa phép"?c("setdiemdanhnhom",{diemdanhvalue:o,EMPL_NO:e.row.EMPL_NO,CURRENT_TEAM:e.row.WORK_SHIF_NAME==="Hành Chính"?0:e.row.WORK_SHIF_NAME==="TEAM 1"?1:2}).then(n=>{if(n.data.tk_status==="OK"){const N=a.map(i=>i.EMPL_NO===e.row.EMPL_NO?{...i,ON_OFF:o}:i);r(N)}else l.fire("Có lỗi","Nội dung: "+n.data.message,"error")}).catch(n=>{}):l.fire("Có lỗi","Đã đăng ký nghỉ rồi, không điểm danh được","error"):o===0?c("setdiemdanhnhom",{diemdanhvalue:o,EMPL_NO:e.row.EMPL_NO,CURRENT_TEAM:e.row.WORK_SHIF_NAME==="Hành Chính"?0:e.row.WORK_SHIF_NAME==="TEAM 1"?1:2}).then(n=>{if(n.data.tk_status==="OK"){const N=a.map(i=>i.EMPL_NO===e.row.EMPL_NO?{...i,ON_OFF:o}:i);e.row.OFF_ID===null&&h(3),r(N)}else l.fire("Có lỗi","Nội dung: "+n.data.message,"error")}).catch(n=>{}):o===2&&c("setdiemdanhnhom",{diemdanhvalue:0,EMPL_NO:e.row.EMPL_NO,CURRENT_TEAM:e.row.WORK_SHIF_NAME==="Hành Chính"?0:e.row.WORK_SHIF_NAME==="TEAM 1"?1:2}).then(n=>{if(n.data.tk_status==="OK"){const N=a.map(i=>i.EMPL_NO===e.row.EMPL_NO?{...i,ON_OFF:0}:i);e.row.OFF_ID===null&&h(5),r(N)}else l.fire("Có lỗi","Nội dung: "+n.data.message,"error")}).catch(n=>{})},s=()=>{if(e.row.REMARK==="AUTO"){const o=a.map(n=>n.EMPL_NO===e.row.EMPL_NO?{...n,ON_OFF:null,OFF_ID:null,REASON_NAME:null}:n);r(o),O()}else{const o=a.map(n=>n.EMPL_NO===e.row.EMPL_NO?{...n,ON_OFF:null}:n);r(o)}};return e.row.ON_OFF===null?t.jsxs("div",{className:`onoffdiv ${E}`,children:[t.jsx("button",{className:"onbutton",onClick:()=>d(1),children:"Làm"})," ",t.jsx("br",{}),t.jsx("button",{className:"offbutton",onClick:()=>d(0),children:"Nghỉ"}),t.jsx("button",{className:"off50button",onClick:()=>d(2),children:"50%"})]}):t.jsxs("div",{className:"onoffdiv",children:[t.jsx("span",{className:`onoffshowtext A${e.row.ON_OFF}`,children:e.row.ON_OFF===1?"ON":"OFF"}),t.jsx("button",{className:"resetbutton",onClick:()=>s(),children:"RESET"})]})}},{field:"TANGCA",headerName:"TANGCA",minWidth:200,flex:1,renderCell:e=>{let E=e.row.OVERTIME===1?"onbt":e.row.OVERTIME===0?"offbt":"";const h=d=>{c("dangkytangcanhom",{tangcavalue:d==="KTC"?0:1,EMPL_NO:e.row.EMPL_NO,overtime_info:d}).then(s=>{if(s.data.tk_status==="OK"){const o=a.map(n=>n.EMPL_NO===e.row.EMPL_NO?{...n,OVERTIME:d==="KTC"?0:1,OVERTIME_INFO:d}:n);r(o)}else l.fire("Có lỗi","Nội dung: "+s.data.message,"error")}).catch(s=>{})},O=()=>{const d=a.map(s=>s.EMPL_NO===e.row.EMPL_NO?{...s,OVERTIME:null,OVERTIME_INFO:null}:s);r(d)};return e.row.OVERTIME===null?t.jsxs("div",{className:`onoffdiv ${E}`,children:[t.jsx("button",{className:"tcbutton",onClick:()=>h("KTC"),children:"KTC"}),t.jsx("button",{className:"tcbutton",onClick:()=>h("0200-0600"),children:"02-06"}),t.jsx("button",{className:"tcbutton",onClick:()=>h("1700-2000"),children:"17-20"}),t.jsx("button",{className:"tcbutton",onClick:()=>h("1700-1800"),children:"17-18"}),t.jsx("button",{className:"tcbutton",onClick:()=>h("0500-0800"),children:"05-08"}),t.jsx("button",{className:"tcbutton",onClick:()=>h("1600-2000"),children:"16-20"})]}):t.jsxs("div",{className:"onoffdiv",children:[t.jsx("span",{className:`onoffshowtext A${e.row.OVERTIME}`,children:e.row.OVERTIME_INFO}),t.jsx("button",{className:"resetbutton",onClick:()=>O(),children:"RESET"})]})}},{field:"MIDLAST_NAME",headerName:"MIDLAST_NAME",width:130},{field:"FIRST_NAME",headerName:"FIRST_NAME",width:130},{field:"PHONE_NUMBER",headerName:"PHONE_NUMBER",width:130},{field:"SEX_NAME",headerName:"SEX_NAME",width:130},{field:"WORK_STATUS_NAME",headerName:"WORK_STATUS_NAME",width:130},{field:"FACTORY_NAME",headerName:"FACTORY_NAME",width:130},{field:"JOB_NAME",headerName:"JOB_NAME",width:130},{field:"WORK_SHIF_NAME",headerName:"WORK_SHIF_NAME",width:130},{field:"WORK_POSITION_NAME",headerName:"WORK_POSITION_NAME",width:130},{field:"SUBDEPTNAME",headerName:"SUBDEPTNAME",width:130},{field:"MAINDEPTNAME",headerName:"MAINDEPTNAME",width:130},{field:"REQUEST_DATE",headerName:"REQUEST_DATE",width:130,valueGetter:e=>{if(e.row.REQUEST_DATE!==null)return e.row.REQUEST_DATE.slice(0,10)}},{field:"APPLY_DATE",headerName:"APPLY_DATE",width:130,valueGetter:e=>{if(e.row.APPLY_DATE!==null)return e.row.APPLY_DATE.slice(0,10)}},{field:"APPROVAL_STATUS",headerName:"APPROVAL_STATUS",width:130},{field:"OFF_ID",headerName:"OFF_ID",width:130},{field:"CA_NGHI",headerName:"CA_NGHI",width:130},{field:"ON_OFF",headerName:"ON_OFF",width:130},{field:"OVERTIME_INFO",headerName:"OVERTIME_INFO",width:130},{field:"OVERTIME",headerName:"OVERTIME",width:130},{field:"REASON_NAME",headerName:"REASON_NAME",width:130},{field:"REMARK",headerName:"REMARK",width:130}];function R(){return t.jsxs(x,{children:[t.jsx(I,{}),t.jsx(b,{}),t.jsx(C,{}),t.jsx("button",{className:"saveexcelbutton",onClick:()=>{F(a,"DiemDanhNhom")},children:"Save Excel"}),t.jsx(j,{})]})}const P=e=>{m(e),c("diemdanhnhom",{team_name_list:e}).then(E=>{r(E.data.data),f(!1),l.fire("Thông báo","Đã load "+E.data.data.length+" dòng","success")}).catch(E=>{})};return _.useEffect(()=>{c("diemdanhnhom",{team_name_list:u}).then(e=>{e.data.tk_status!=="NG"?(r(e.data.data),l.fire("Thông báo","Đã load "+e.data.data.length+" dòng","success")):l.fire("Thông báo","Nội dung: "+e.data.message,"error")}).catch(e=>{})},[]),t.jsxs("div",{className:"diemdanhnhom",children:[t.jsx("h3",{children:"Điểm danh nhóm"}),t.jsx("div",{className:"filterform",children:t.jsxs("label",{children:["Ca làm việc:",t.jsxs("select",{name:"calamviec",value:u,onChange:e=>{P(Number(e.target.value))},children:[t.jsx("option",{value:0,children:"TEAM 1 + Hành chính"}),t.jsx("option",{value:1,children:"TEAM 2+ Hành chính"}),t.jsx("option",{value:2,children:"TEAM 1"}),t.jsx("option",{value:3,children:"TEAM 2"}),t.jsx("option",{value:4,children:"Hành chính"}),t.jsx("option",{value:5,children:"Tất cả"})]})]})}),t.jsx("div",{className:"maindept_table",children:t.jsx(S,{sx:{fontSize:"0.8rem"},components:{Toolbar:R,LoadingOverlay:g},loading:T,rowHeight:35,rows:a,columns:w,rowsPerPageOptions:[5,10,50,100,500],editMode:"row",getRowHeight:()=>"auto"})})]})};export{V as default};
