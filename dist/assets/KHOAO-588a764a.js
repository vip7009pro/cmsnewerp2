import{r as s,k as Z,ai as L,j as t,aT as D,S as d,aj as J,I as ee,ak as te,al as ae,ad as h}from"./index-4ab6dde0.js";import{D as le,G as oe,b as ne}from"./DataGrid-b5e0acb2.js";import"./TextField-db9fe3d0.js";import"./MenuItem-8199bc03.js";import"./Typography-b6d023f3.js";const re=({NEXT_PLAN:m})=>{const[k,A]=s.useState(!0);s.useState([]);const[Y,_]=s.useState(!1),l=Z(e=>e.totalSlice.userData),[E,N]=s.useState(!1),[I,U]=s.useState(L().format("YYYY-MM-DD")),[g,j]=s.useState(L().format("YYYY-MM-DD")),[f,H]=s.useState("ALL");s.useState("ALL"),s.useState([]);const[x,T]=s.useState([]),[p,u]=s.useState([]);s.useState([]);const[o,C]=s.useState([]),[r,w]=s.useState(m===void 0?"":m);s.useState([]),s.useState([]),s.useState([]);const[R,M]=s.useState(""),b=[{field:"IN_KHO_ID",headerName:"IN_KHO_ID",width:100},{field:"FACTORY",headerName:"FACTORY",width:80},{field:"PHANLOAI",headerName:"PHANLOAI",width:80},{field:"M_CODE",headerName:"M_CODE",width:80},{field:"M_NAME",headerName:"M_NAME",width:150},{field:"WIDTH_CD",headerName:"WIDTH_CD",width:80},{field:"M_LOT_NO",headerName:"M_LOT_NO",width:120},{field:"PLAN_ID_INPUT",headerName:"PLAN_ID_INPUT",width:120},{field:"ROLL_QTY",headerName:"ROLL_QTY",width:80},{field:"IN_QTY",headerName:"IN_QTY",width:80},{field:"TOTAL_IN_QTY",headerName:"TOTAL_IN_QTY",width:120},{field:"PLAN_ID_SUDUNG",headerName:"PLAN_ID_SUDUNG",width:120},{field:"USE_YN",headerName:"USE_YN",width:90},{field:"REMARK",headerName:"REMARK",width:90},{field:"INS_DATE",headerName:"INS_DATE",width:150}],Q=[{field:"OUT_KHO_ID",headerName:"OUT_KHO_ID",width:100},{field:"FACTORY",headerName:"FACTORY",width:80},{field:"PHANLOAI",headerName:"PHANLOAI",width:80},{field:"M_CODE",headerName:"M_CODE",width:80},{field:"M_NAME",headerName:"M_NAME",width:150},{field:"WIDTH_CD",headerName:"WIDTH_CD",width:80},{field:"M_LOT_NO",headerName:"M_LOT_NO",width:120},{field:"PLAN_ID_INPUT",headerName:"PLAN_ID_INPUT",width:120},{field:"PLAN_ID_OUTPUT",headerName:"PLAN_ID_OUTPUT",width:120},{field:"ROLL_QTY",headerName:"ROLL_QTY",width:80},{field:"OUT_QTY",headerName:"OUT_QTY",width:80},{field:"TOTAL_OUT_QTY",headerName:"TOTAL_OUT_QTY",width:80},{field:"INS_DATE",headerName:"INS_DATE",width:150}],P=[{field:"IN_KHO_ID",headerName:"IN_KHO_ID",width:100},{field:"FACTORY",headerName:"NM",width:40,editable:!1},{field:"PLAN_ID_INPUT",headerName:"PLAN_ID",width:80,editable:!1},{field:"PHANLOAI",headerName:"PL",width:40,editable:!1},{field:"M_CODE",headerName:"M_CODE",width:80,editable:!1},{field:"M_NAME",headerName:"M_NAME",width:120,editable:!1,renderCell:e=>e.row.LIEUQL_SX===1?t.jsx("span",{style:{color:"red",fontWeight:"bold"},children:e.row.M_NAME}):t.jsx("span",{style:{color:"black"},children:e.row.M_NAME})},{field:"WIDTH_CD",headerName:"SIZE",width:30,editable:!1},{field:"M_LOT_NO",headerName:"M_LOT_NO",width:90,editable:!1},{field:"ROLL_QTY",headerName:"ROLL_QTY",width:70,editable:!1,renderCell:e=>e.row.PHANLOAI!=="F"?t.jsx("span",{style:{color:"blue"},children:e.row.ROLL_QTY.toLocaleString("en","US")}):t.jsx("span",{style:{color:"red",fontWeight:"bold"},children:e.row.ROLL_QTY.toLocaleString("en","US")})},{field:"IN_QTY",headerName:"IN_QTY",width:70,editable:!1,renderCell:e=>e.row.PHANLOAI!=="F"?t.jsx("span",{style:{color:"blue"},children:e.row.IN_QTY.toLocaleString("en","US")}):t.jsx("span",{style:{color:"red",fontWeight:"bold"},children:e.row.IN_QTY.toLocaleString("en","US")})},{field:"TOTAL_IN_QTY",headerName:"TOTAL_IN_QTY",width:120,editable:!1,renderCell:e=>e.row.PHANLOAI!=="F"?t.jsx("span",{style:{color:"green",fontWeight:"bold"},children:e.row.TOTAL_IN_QTY.toLocaleString("en","US")}):t.jsx("span",{style:{color:"red",fontWeight:"bold"},children:e.row.TOTAL_IN_QTY.toLocaleString("en","US")})},{field:"FSC",headerName:"FSC",width:120,editable:!1,renderCell:e=>e.row.PHANLOAI==="Y"?t.jsx("span",{style:{color:"green",fontWeight:"bold"},children:"YES"}):t.jsx("span",{style:{color:"red",fontWeight:"bold"},children:"NO"})}];function v(){return t.jsxs(oe,{children:[t.jsxs(ee,{className:"buttonIcon",onClick:()=>{te(x,"Kho AO DATA Table")},children:[t.jsx(ae,{color:"green",size:25}),"SAVE"]}),t.jsx(ne,{}),t.jsx("div",{className:"div",style:{fontSize:"1rem",fontWeight:"bold"},children:R}),t.jsxs("div",{className:"div",style:{fontSize:"1rem",fontWeight:"bold"},children:["_|_Liệu xuất next sẽ vào chỉ thị: ",r]})]})}const F=()=>{h("lichsunhapkhoao",{FROM_DATE:I,TO_DATE:g,FACTORY:f}).then(e=>{if(e.data.tk_status!=="NG"){let a=e.data.data.map((i,c)=>({...i,INS_DATE:L.utc(i.INS_DATE).format("YYYY-MM-DD HH:mm:ss"),id:c}));T(a),u(b),_(!0),N(!1),M("LỊCH SỬ NHẬP KHO ẢO"),d.fire("Thông báo","Đã load: "+e.data.data.length+" dòng","success")}else T([]),d.fire("Thông báo","Nội dung: "+e.data.message,"error")}).catch(e=>{console.log(e)})},y=()=>{h("lichsuxuatkhoao",{FROM_DATE:I,TO_DATE:g,FACTORY:f}).then(e=>{if(e.data.tk_status!=="NG"){let a=e.data.data.map((i,c)=>({...i,INS_DATE:L.utc(i.INS_DATE).format("YYYY-MM-DD HH:mm:ss"),id:c}));T(a),_(!0),N(!1),M("LỊCH SỬ XUẤT KHO ẢO"),d.fire("Thông báo","Đã load: "+e.data.data.length+" dòng","success")}else T([]),d.fire("Thông báo","Nội dung: "+e.data.message,"error")}).catch(e=>{console.log(e)})},S=()=>{h("checktonlieutrongxuong",{FACTORY:f}).then(e=>{if(e.data.tk_status!=="NG"){const a=e.data.data.map((i,c)=>({...i,id:c}));T(a),u(P),_(!0),N(!1),M("TỒN KHO ẢO"),d.fire("Thông báo","Đã load: "+e.data.data.length+" dòng","success")}else T([])}).catch(e=>{console.log(e)})},K=async e=>{let a="N";return await h("checkFSC_PLAN_ID",{PLAN_ID:e}).then(i=>{console.log(i.data.data),i.data.tk_status!=="NG"&&(a=i.data.data[0].FSC)}).catch(i=>{console.log(i)}),a},G=async()=>{if(r!==""&&r!==void 0)if(o.length>0){let e="0";for(let a=0;a<o.length;a++){let i=!0;await h("checkM_CODE_CHITHI",{PLAN_ID_OUTPUT:r,M_CODE:o[a].M_CODE}).then(n=>{console.log(n.data.data),n.data.tk_status!=="NG"?i=!0:i=!1}).catch(n=>{console.log(n)});let c=await K(r);i===!0&&r!==o[a].PLAN_ID_INPUT&&c===o[a].FSC?await h("xuatkhoao",{FACTORY:o[a].FACTORY,PHANLOAI:"N",PLAN_ID_INPUT:o[a].PLAN_ID_INPUT,PLAN_ID_OUTPUT:r,M_CODE:o[a].M_CODE,M_LOT_NO:o[a].M_LOT_NO,ROLL_QTY:o[a].ROLL_QTY,OUT_QTY:o[a].IN_QTY,TOTAL_OUT_QTY:o[a].TOTAL_IN_QTY,USE_YN:"O"}).then(n=>{console.log(n.data.tk_status),n.data.tk_status!=="NG"?h("setUSE_YN_KHO_AO_INPUT",{FACTORY:o[a].FACTORY,PHANLOAI:o[a].PHANLOAI,PLAN_ID_INPUT:o[a].PLAN_ID_INPUT,PLAN_ID_SUDUNG:r,M_CODE:o[a].M_CODE,M_LOT_NO:o[a].M_LOT_NO,TOTAL_IN_QTY:o[a].TOTAL_IN_QTY,USE_YN:"O",IN_KHO_ID:o[a].IN_KHO_ID}).then(O=>{console.log(O.data),O.data.tk_status}).catch(O=>{console.log(O)}):e+="| "+n.data.message}).catch(n=>{console.log(n)}):e+="| Liệu: "+o[a].M_NAME+` chưa được đăng ký xuất liệu 
 Đã xuất các liệu hợp lệ`}e!=="0"?d.fire("Thông báo","Có lỗi: "+e,"error"):(C([]),S())}else d.fire("Thông báo","Chọn ít nhất 1 liệu để xuất kho","error");else d.fire("Thông báo","Chưa nhập next PLAN","error")},X=async()=>{const{value:e}=await d.fire({title:"Xác nhận xóa rác",input:"password",inputLabel:"Nhập mật mã",inputValue:"",inputPlaceholder:"Mật mã",showCancelButton:!0});e==="quantrisanxuat2023"&&((l==null?void 0:l.EMPL_NO)==="DTL1906"||(l==null?void 0:l.EMPL_NO)==="THU1402"||(l==null?void 0:l.EMPL_NO)==="NHU1903")?B():d.fire("Thông báo","Đã nhập sai mật mã hoặc tài khoản ko đủ quyền hạn!","error")},W=async()=>{const{value:e}=await d.fire({title:"Xác nhận ẩn rác",input:"password",inputLabel:"Nhập mật mã",inputValue:"",inputPlaceholder:"Mật mã",showCancelButton:!0});e==="quantrisanxuat2023"&&((l==null?void 0:l.EMPL_NO)==="DTL1906"||(l==null?void 0:l.EMPL_NO)==="THU1402"||(l==null?void 0:l.EMPL_NO)==="NHU1903")?V():d.fire("Thông báo","Đã nhập sai mật mã hoặc tài khoản ko đủ quyền hạn!","error")},B=()=>{d.fire({title:"Chắc chắn muốn Xóa liệu đã chọn ?",text:"Sẽ bắt đầu Xóa liệu đã chọn",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Vẫn Xóa!"}).then(e=>{e.isConfirmed&&(d.fire("Tiến hành Xóa","Đang xóa hàng loạt","success"),D(l==null?void 0:l.EMPL_NO,l==null?void 0:l.MAINDEPTNAME,["SX"],q))})},V=()=>{d.fire({title:"Chắc chắn muốn Ẩn liệu đã chọn ?",text:"Sẽ bắt đầu Ẩn liệu đã chọn",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Vẫn Ẩn!"}).then(e=>{e.isConfirmed&&(d.fire("Tiến hành Ẩn","Đang Ẩn hàng loạt","success"),D(l==null?void 0:l.EMPL_NO,l==null?void 0:l.MAINDEPTNAME,["SX"],z))})},q=async()=>{if(o.length>0){let e="0";for(let a=0;a<o.length;a++){let i=!1,c=!1;await h("check_2_m_code_in_kho_ao",{PLAN_ID_INPUT:o[a].PLAN_ID_INPUT}).then(n=>{n.data.tk_status!=="NG"&&n.data.data[0].COUNT_M_CODE>1&&(i=!0)}).catch(n=>{console.log(n)}),await h("check_m_lot_exist_p500",{PLAN_ID_INPUT:o[a].PLAN_ID_INPUT,M_LOT_NO:o[a].M_LOT_NO}).then(n=>{n.data.tk_status!=="NG"&&n.data.data.length>0&&(c=!0)}).catch(n=>{console.log(n)}),i&&!c?(console.log("check_2_m_code_in_kho_ao",i),console.log("check_m_lot_exist_p500",c),d.fire("Thông báo","Xóa kho ảo thành công","success"),await h("delete_in_kho_ao",{IN_KHO_ID:o[a].IN_KHO_ID}).then(n=>{n.data.tk_status!=="NG"&&n.data.data.length>0&&(c=!0)}).catch(n=>{console.log(n)}),await h("delete_out_kho_ao",{PLAN_ID_INPUT:o[a].PLAN_ID_INPUT,M_LOT_NO:o[a].M_LOT_NO}).then(n=>{n.data.tk_status!=="NG"&&n.data.data.length>0&&(c=!0)}).catch(n=>{console.log(n)})):i?c&&(e+=` | ${o[a].M_LOT_NO}: Liệu đã input sx ko xóa được`):e+=` | ${o[a].M_LOT_NO}: Liệu chỉ có 1 liệu chính ko xóa được`}e!=="0"&&d.fire("Thông báo","Có lỗi: "+e,"error")}else d.fire("Thông báo","Chọn ít nhất 1 liệu để xóa","error")},z=async()=>{if(o.length>0)for(let e=0;e<o.length;e++)await h("an_lieu_kho_ao",{IN_KHO_ID:o[e].IN_KHO_ID}).then(a=>{a.data.tk_status}).catch(a=>{console.log(a)});else d.fire("Thông báo","Chọn ít nhất 1 liệu để ẩn","error")},$=e=>{const a=new Set(e);let i=x.filter(c=>a.has(c.id));console.log(i),i.length>0?C(i):C([])};return s.useEffect(()=>{m===void 0&&w(""),N(!0),_(!1),u(P),S()},[]),t.jsx("div",{className:"khoao",children:t.jsxs("div",{className:"tracuuDataInspection",children:[t.jsxs("div",{className:"tracuuDataInspectionform",children:[t.jsxs("div",{className:"forminput",children:[t.jsxs("div",{className:"forminputcolumn",children:[t.jsxs("label",{children:[t.jsx("b",{children:"FROM DATE"}),t.jsx("input",{type:"date",value:I.slice(0,10),onChange:e=>U(e.target.value)})]}),t.jsxs("label",{children:[t.jsx("b",{children:"TO DATE"}),t.jsx("input",{type:"date",value:g.slice(0,10),onChange:e=>j(e.target.value)})]})]}),t.jsxs("div",{className:"forminputcolumn",children:[t.jsxs("label",{children:[t.jsx("b",{children:"FACTORY:"}),t.jsxs("select",{name:"phanloai",value:f,onChange:e=>{H(e.target.value)},children:[t.jsx("option",{value:"ALL",children:"ALL"}),t.jsx("option",{value:"NM1",children:"NM1"}),t.jsx("option",{value:"NM2",children:"NM2"})]})]}),t.jsxs("label",{children:[t.jsx("b",{children:"NEXT PLAN"}),t.jsx("input",{type:"text",value:r,onChange:e=>w(e.target.value)})]})]}),t.jsxs("div",{className:"forminputcolumn",children:[t.jsx("button",{className:"tranhatky",onClick:()=>{N(!0),_(!1),u(P),A(!0),S()},children:"TỒN KHO ẢO"}),t.jsx("button",{className:"tranhatky",onClick:()=>{N(!0),_(!1),u(b),A(!1),F()},children:"LS IN"})]}),t.jsxs("div",{className:"forminputcolumn",children:[t.jsx("button",{className:"xuatnext",onClick:()=>{k?D(l==null?void 0:l.EMPL_NO,l==null?void 0:l.MAINDEPTNAME,["QLSX"],G):d.fire("Thông báo","Đang không ở tab tồn kho ảo","error")},children:"XUẤT NEXT"}),t.jsx("button",{className:"tranhatky",onClick:()=>{N(!0),_(!1),u(Q),A(!1),y()},children:"LS OUT"})]}),t.jsxs("div",{className:"forminputcolumn",children:[t.jsx("button",{className:"xoakhoao",onClick:()=>{X()},children:"Xóa rác"}),t.jsx("button",{className:"xoakhoao",onClick:()=>{W()},children:"Ẩn rác"})]})]}),t.jsx("div",{className:"formbutton"})]}),t.jsx("div",{className:"tracuuYCSXTable",children:Y&&t.jsx(le,{sx:{fontSize:"0.7rem",flex:1},components:{Toolbar:v,LoadingOverlay:J},loading:E,rowHeight:30,rows:x,columns:p,rowsPerPageOptions:[5,10,50,100,500,1e3,5e3,1e4,5e5],checkboxSelection:!0,disableSelectionOnClick:!0,editMode:"cell",getRowId:e=>e.id,onSelectionModelChange:e=>{$(e)}})})]})})};export{re as default};
